diff --git a/INSTALL.md b/INSTALL.md
index 1e397d8f7..66e21d0fa 100644
--- a/INSTALL.md
+++ b/INSTALL.md
@@ -9,7 +9,7 @@ make
 sudo make install
 ```
 
-is enough. This installs Dovecot under /usr/local.
+is enough. This installs Dovecot under /usr/local. If installing from git, user `./autogen.sh` first.
 
 If you have installed some libraries into locations which require special include or library paths, you can give them in CPPFLAGS and LDFLAGS environment variables. For example:
 
diff --git a/README.md b/README.md
index 0a72fb1f7..4a63a3bec 100644
--- a/README.md
+++ b/README.md
@@ -1,3 +1,53 @@
+HIN extensions
+==============
+(by Oetiker+Partner AG, Olten, www.oetiker.ch)
+
+Added Ceritificate and Certificate Checks to Dovecot 2.3.x
+
+- ssl_verify_depth:      will check the maximal certificate chain depth
+- ssl_cert_md_algorithm: will check the corresponding certificate fingerprint algorithm (md5/sha1/...)
+- cert_loginname:        will handle the loginname included in special client certificates (x509 fields)
+- cert_fingerprint:      allows to access the fingerprint of a certificate inbound of the dovecot
+                         (used for select and  compare with LDAP backend where the fingerprint of a user is stored)
+
+These patches were ported to dovecot-2.2.x and then 2.3.x from a patch serie done on Dovecot 2.0.16 in 2011/2012
+
+Notes for setup and testing:
+
+- Either install your CA certificates with matching CRL files
+  (see https://wiki.dovecot.org/SSL/DovecotConfiguration#Client_certificate_verification.2Fauthentication)
+  or add    ssl_require_crl = no    in your dovecot.conf file (default is true).
+
+  Otherwise your client certificates will not be considered valid.
+
+- For testing (assuming configured for IMAP) you can use
+
+  openssl s_client -servername yourhost.yourdomain -connect yourserver:443 -cert client-certificate.pem
+
+  and then enter
+
+  a001 login user secret
+
+  (see https://gist.github.com/mtigas/952344 for certificate creation
+   and https://en.wikipedia.org/wiki/Internet_Message_Access_Protocol#Dialog_example for IMAP).
+
+  and watching your dovecot log file.
+
+- Expired client certificates are detected and treated as invalid.
+
+  This will prevent the extraction of peer_name and fingerprint from the certificate.
+  This SHOULD prevent authentication (e.g. towards IMAP), but this has not yet been verified).
+
+  Use  ssl_cert_info = yes  and  ssl_cert_debug = yes  to verify peername and fingerprint of your
+  client certificates.
+
+  Fritz Zaucker <fritz.zaucker@oetiker.ch>   2019-11-28
+
+#######################################################
+
+ORIGINAL Dovecot README follows
+
+
 Installation
 ============
 
diff --git a/doc/example-config/conf.d/10-logging.conf b/doc/example-config/conf.d/10-logging.conf
index bcd6dea31..61fa429e6 100644
--- a/doc/example-config/conf.d/10-logging.conf
+++ b/doc/example-config/conf.d/10-logging.conf
@@ -64,6 +64,12 @@
 # Show protocol level SSL errors.
 #verbose_ssl = no
 
+# Show additonal SSL client certificate information.
+#ssl_cert_info = no
+
+# Show additional SSL client certificate debug information.
+#ssl_cert_debug = no
+
 # mail_log plugin provides more event logging for mail processes.
 plugin {
   # Events to log. Also available: flag_change append
diff --git a/doc/example-config/conf.d/10-ssl.conf b/doc/example-config/conf.d/10-ssl.conf
index 984758bb3..cad56f381 100644
--- a/doc/example-config/conf.d/10-ssl.conf
+++ b/doc/example-config/conf.d/10-ssl.conf
@@ -46,6 +46,13 @@ ssl_key = </etc/ssl/private/dovecot.pem
 # auth_ssl_username_from_cert=yes.
 #ssl_cert_username_field = commonName
 
+# Which fingerprint algorithm form a client certificate is used for verifing
+#ssl_cert_md_algorithm = sha1
+
+# Check the depth of a SSL certificate chain. The given value is the maximum
+# allowed depth. Default is 9.
+#ssl_verify_depth = 9
+
 # SSL DH parameters
 # Generate new params with `openssl dhparam -out /etc/dovecot/dh.pem 4096`
 # Or migrate from old ssl-parameters.dat file with the command dovecot
diff --git a/hin-patch-2.2.36_dovecot_2.2.36.skipped b/hin-patch-2.2.36_dovecot_2.2.36.skipped
new file mode 100644
index 000000000..2292b8ccf
--- /dev/null
+++ b/hin-patch-2.2.36_dovecot_2.2.36.skipped
@@ -0,0 +1,130 @@
+### These patches from 2.2.x couldn't be applied to 2.3.8 as the respective files
+### don't exist and now similar code was found.
+###
+### Fritz Zaucker, 2019-11-28
+
+diff --git a/src/login-common/ssl-proxy-gnutls.c b/src/login-common/ssl-proxy-gnutls.c
+index d1b308a6a9..ee270c3190 100644
+--- a/src/login-common/ssl-proxy-gnutls.c
++++ b/src/login-common/ssl-proxy-gnutls.c
+@@ -60,6 +60,16 @@ static const char *get_alert_text(struct ssl_proxy *proxy)
+ 	return gnutls_alert_get_name(gnutls_alert_get(proxy->session));
+ }
+ 
++const char *ssl_proxy_get_fingerprint(struct ssl_proxy *proxy __attr_unused__)
++{
++	return NULL;
++}
++
++const char *ssl_proxy_get_fingerprint_base64(struct ssl_proxy *proxy __attr_unused__)
++{
++	return NULL;
++}
++
+ static int handle_ssl_error(struct ssl_proxy *proxy, int error)
+ {
+ 	if (!gnutls_error_is_fatal(error)) {
+
+
+diff --git a/src/login-common/ssl-proxy-openssl.c b/src/login-common/ssl-proxy-openssl.c
+index 424ef70703..a26818ae69 100644
+--- a/src/login-common/ssl-proxy-openssl.c
++++ b/src/login-common/ssl-proxy-openssl.c
+@@ -105,6 +107,7 @@ struct ssl_server_context {
+ 	const char *ca;
+ 	const char *cipher_list;
+ 	const char *protocols;
++	unsigned int verify_depth;
+ 	bool verify_client_cert;
+ 	bool prefer_server_ciphers;
+ 	bool compression;
+@@ -186,10 +189,17 @@ static int ssl_server_context_cmp(const struct ssl_server_context *ctx1,
+ 		return 1;
+ 	if (null_strcmp(ctx1->protocols, ctx2->protocols) != 0)
+ 		return 1;
++	if (ctx1->verify_depth != ctx2->verify_depth)
++		return 1;
++	if (ctx1->verify_client_cert != ctx2->verify_client_cert)
++		return 1;
++
++    return 0;
+ 
+-	return ctx1->verify_client_cert == ctx2->verify_client_cert ? 0 : 1;
+ }
+ 
++
++
+ static void ssl_params_corrupted(const char *reason)
+ {
+ 	i_fatal("Corrupted SSL ssl-parameters.dat in state_dir: %s", reason);
+@@ -630,6 +640,7 @@ ssl_server_context_get(const struct login_settings *login_set,
+ 	lookup_ctx.alt.key = set->ssl_alt_key;
+ 	lookup_ctx.ca = set->ssl_ca;
+ 	lookup_ctx.cipher_list = set->ssl_cipher_list;
++	lookup_ctx.verify_depth = set->ssl_verify_depth;
+ 	lookup_ctx.protocols = set->ssl_protocols;
+ 	lookup_ctx.verify_client_cert = set->ssl_verify_client_cert ||
+ 		login_set->auth_ssl_require_client_cert ||
+@@ -732,7 +743,10 @@ const char *ssl_proxy_get_peer_name(struct ssl_proxy *proxy)
+ 		}
+ 	}
+ 	X509_free(x509);
+-	
++
++	if (proxy->ssl_set->ssl_cert_info)
++		i_info("x509 name found in certificate \"%s\" ...", name);
++
+ 	return *name == '\0' ? NULL : name;
+ }
+ 
+@@ -1214,7 +1228,7 @@ ssl_proxy_ctx_use_certificate_chain(SSL_CTX *ctx, const char *cert)
+ 		X509 *ca;
+ 		int r;
+ 		unsigned long err;
+-		
++
+ 		while ((ca = PEM_read_bio_X509(in,NULL,NULL,NULL)) != NULL) {
+ 			r = SSL_CTX_add_extra_chain_cert(ctx, ca);
+ 			if (!r) {
+@@ -1227,7 +1241,7 @@ ssl_proxy_ctx_use_certificate_chain(SSL_CTX *ctx, const char *cert)
+ 		err = ERR_peek_last_error();
+ 		if (ERR_GET_LIB(err) == ERR_LIB_PEM && ERR_GET_REASON(err) == PEM_R_NO_START_LINE)
+ 			ERR_clear_error();
+-		else 
++		else
+ 			ret = 0; /* some real error */
+ 		}
+ 
+@@ -1283,6 +1297,7 @@ ssl_server_context_init(const struct login_settings *login_set,
+ 	ctx->alt.key = p_strdup(pool, ssl_set->ssl_alt_key);
+ 	ctx->ca = p_strdup(pool, ssl_set->ssl_ca);
+ 	ctx->cipher_list = p_strdup(pool, ssl_set->ssl_cipher_list);
++	ctx->verify_depth = ssl_set->ssl_verify_depth;
+ 	ctx->protocols = p_strdup(pool, ssl_set->ssl_protocols);
+ 	ctx->verify_client_cert = ssl_set->ssl_verify_client_cert ||
+ 		login_set->auth_ssl_require_client_cert ||
+@@ -1296,6 +1311,20 @@ ssl_server_context_init(const struct login_settings *login_set,
+ 		i_fatal("SSL_CTX_new() failed");
+ 	xnames = ssl_proxy_ctx_init(ssl_ctx, ssl_set, ctx->verify_client_cert);
+ 
++	/* 	Note: we add one to the configured depth purposefully.  As noted
++		in the OpenSSL man pages, the verification process will silently
++		stop at the configured depth, and the error messages ensuing will
++		be that of an incomplete certificate chain, rather than the
++		"chain too long" error that might be expected. To log the "chain
++		too long" condition, we add one to the configured depth, and catch,
++		in the verify callback, the exceeding of the actual depth.
++	*/
++
++        SSL_CTX_set_verify_depth(ssl_ctx, ctx->verify_depth + 1);
++
++        /* session cache fails quite often ... disable it */
++        SSL_CTX_set_session_cache_mode(ssl_ctx, SSL_SESS_CACHE_OFF);
++
+ 	if (SSL_CTX_set_cipher_list(ssl_ctx, ctx->cipher_list) != 1) {
+ 		i_fatal("Can't set cipher list to '%s': %s",
+ 			ctx->cipher_list, openssl_iostream_error());
+@@ -1470,4 +1499,134 @@ void ssl_proxy_deinit(void)
+ 	ERR_free_strings();
+ }
+ 
diff --git a/rpmbuild/.gitignore b/rpmbuild/.gitignore
new file mode 100644
index 000000000..49c65eb48
--- /dev/null
+++ b/rpmbuild/.gitignore
@@ -0,0 +1,5 @@
+BUILD/*
+BUILDROOT/*
+RPMS/*
+SRPMS/*
+SOURCES/dovecot-2.2.36*gz
diff --git a/rpmbuild/Dockerfile b/rpmbuild/Dockerfile
new file mode 100644
index 000000000..822281d44
--- /dev/null
+++ b/rpmbuild/Dockerfile
@@ -0,0 +1,13 @@
+ARG image=centos:6.10
+FROM ${image}
+
+RUN yum --assumeyes update && \
+    yum --assumeyes install pam-devel bzip2-devel libcap-devel \
+       libtool mysql-devel quota-devel xz-devel tcp_wrappers-devel \
+       gettext-devel libcurl-devel postgresql-devel sqlite-devel clucene-core-devel \
+       expat-devel openldap-devel rpm-build redhat-rpm-config make gcc gcc-c++
+
+
+WORKDIR /dovecot/rpmbuild
+
+ENTRYPOINT ./entrypoint.sh
diff --git a/rpmbuild/README.md b/rpmbuild/README.md
new file mode 100644
index 000000000..975b16764
--- /dev/null
+++ b/rpmbuild/README.md
@@ -0,0 +1,23 @@
+HOWTO Build RPMS
+==========================
+Author: Tobi Oetiker 
+Date:   19.09.2019, Version 1
+
+Rebase the source
+=================
+
+git fetch upstream
+git rebase upstream/release-2.3.8
+
+Build RPMS
+==========
+
+./autogen.sh
+./configure
+make dist
+cp dovecot-2.3.8.tar.gz rpmbuild/SOURCES
+cd rpmbuild
+docker-compose run rpmbuild
+
+
+The rpms are in the folders RPMS and SRPMS
diff --git a/rpmbuild/SOURCES/dovecot-1.0.beta2-mkcert-permissions.patch b/rpmbuild/SOURCES/dovecot-1.0.beta2-mkcert-permissions.patch
new file mode 100644
index 000000000..68ac01b5d
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot-1.0.beta2-mkcert-permissions.patch
@@ -0,0 +1,11 @@
+--- dovecot-1.0.beta2/doc/mkcert.sh.configfile	2006-01-16 21:14:54.000000000 +0100
++++ dovecot-1.0.beta2/doc/mkcert.sh	2006-01-26 14:28:38.000000000 +0100
+@@ -29,6 +29,7 @@
+ fi
+ 
+ $OPENSSL req -new -x509 -nodes -config $OPENSSLCONFIG -out $CERTFILE -keyout $KEYFILE -days 365 || exit 2
+-chmod 0600 $KEYFILE
++chown root:root $CERTFILE $KEYFILE
++chmod 0600 $CERTFILE $KEYFILE
+ echo 
+ $OPENSSL x509 -subject -fingerprint -noout -in $CERTFILE || exit 2
diff --git a/rpmbuild/SOURCES/dovecot-1.0.rc7-mkcert-paths.patch b/rpmbuild/SOURCES/dovecot-1.0.rc7-mkcert-paths.patch
new file mode 100644
index 000000000..e8354e55e
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot-1.0.rc7-mkcert-paths.patch
@@ -0,0 +1,14 @@
+diff -up dovecot-2.2.27/doc/mkcert.sh.mkcert-paths dovecot-2.2.27/doc/mkcert.sh
+--- dovecot-2.2.27/doc/mkcert.sh.mkcert-paths	2016-12-05 10:26:07.913515286 +0100
++++ dovecot-2.2.27/doc/mkcert.sh	2016-12-05 10:28:25.439634417 +0100
+@@ -5,8 +5,8 @@
+ 
+ umask 077
+ OPENSSL=${OPENSSL-openssl}
+-SSLDIR=${SSLDIR-/etc/ssl}
+-OPENSSLCONFIG=${OPENSSLCONFIG-dovecot-openssl.cnf}
++SSLDIR=${SSLDIR-/etc/pki/dovecot}
++OPENSSLCONFIG=${OPENSSLCONFIG-/etc/pki/dovecot/dovecot-openssl.cnf}
+ 
+ CERTDIR=$SSLDIR/certs
+ KEYDIR=$SSLDIR/private
diff --git a/rpmbuild/SOURCES/dovecot-2.0-defaultconfig.patch b/rpmbuild/SOURCES/dovecot-2.0-defaultconfig.patch
new file mode 100644
index 000000000..c18dd47fb
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot-2.0-defaultconfig.patch
@@ -0,0 +1,33 @@
+diff -up dovecot-2.3.0.1/doc/example-config/conf.d/10-mail.conf.default-settings dovecot-2.3.0.1/doc/example-config/conf.d/10-mail.conf
+--- dovecot-2.3.0.1/doc/example-config/conf.d/10-mail.conf.default-settings	2018-02-28 15:28:57.000000000 +0100
++++ dovecot-2.3.0.1/doc/example-config/conf.d/10-mail.conf	2018-03-01 10:29:38.208368555 +0100
+@@ -322,6 +322,7 @@ protocol !indexer-worker {
+ # them simultaneously.
+ #mbox_read_locks = fcntl
+ #mbox_write_locks = dotlock fcntl
++mbox_write_locks = fcntl
+ 
+ # Maximum time to wait for lock (all of them) before aborting.
+ #mbox_lock_timeout = 5 mins
+diff -up dovecot-2.3.0.1/doc/example-config/conf.d/10-ssl.conf.default-settings dovecot-2.3.0.1/doc/example-config/conf.d/10-ssl.conf
+--- dovecot-2.3.0.1/doc/example-config/conf.d/10-ssl.conf.default-settings	2018-02-28 15:28:57.000000000 +0100
++++ dovecot-2.3.0.1/doc/example-config/conf.d/10-ssl.conf	2018-03-01 10:33:54.779499044 +0100
+@@ -3,7 +3,9 @@
+ ##
+ 
+ # SSL/TLS support: yes, no, required. <doc/wiki/SSL.txt>
+-#ssl = yes
++# disable plain pop3 and imap, allowed are only pop3+TLS, pop3s, imap+TLS and imaps
++# plain imap and pop3 are still allowed for local connections
++ssl = required
+ 
+ # PEM encoded X.509 SSL/TLS certificate and private key. They're opened before
+ # dropping root privileges, so keep the key file unreadable by anyone but
+@@ -57,6 +59,7 @@ ssl_key = </etc/ssl/private/dovecot.pem
+ #ssl_cipher_list = ALL:!kRSA:!SRP:!kDHd:!DSS:!aNULL:!eNULL:!EXPORT:!DES:!3DES:!MD5:!PSK:!RC4:!ADH:!LOW@STRENGTH
+ # To disable non-EC DH, use:
+ #ssl_cipher_list = ALL:!DH:!kRSA:!SRP:!kDHd:!DSS:!aNULL:!eNULL:!EXPORT:!DES:!3DES:!MD5:!PSK:!RC4:!ADH:!LOW@STRENGTH
++ssl_cipher_list = PROFILE=SYSTEM
+ 
+ # Colon separated list of elliptic curves to use. Empty value (the default)
+ # means use the defaults from the SSL library. P-521:P-384:P-256 would be an
diff --git a/rpmbuild/SOURCES/dovecot-2.1-privatetmp.patch b/rpmbuild/SOURCES/dovecot-2.1-privatetmp.patch
new file mode 100644
index 000000000..d9b21ecac
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot-2.1-privatetmp.patch
@@ -0,0 +1,11 @@
+diff -up dovecot-2.2.19/dovecot.service.in.privatetmp dovecot-2.2.19/dovecot.service.in
+--- dovecot-2.2.19/dovecot.service.in.privatetmp	2015-10-05 12:50:24.273780394 +0200
++++ dovecot-2.2.19/dovecot.service.in	2015-10-05 12:50:56.281621589 +0200
+@@ -26,6 +26,7 @@ After=local-fs.target network.target
+ Type=simple
+ ExecStart=@sbindir@/dovecot -F $OPTIONS
+ ExecReload=@sbindir@/dovecot reload
++PrivateTmp=true
+ NonBlocking=yes
+ 
+ [Install]
diff --git a/rpmbuild/SOURCES/dovecot-2.1.10-waitonline.patch b/rpmbuild/SOURCES/dovecot-2.1.10-waitonline.patch
new file mode 100644
index 000000000..2b1cd420d
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot-2.1.10-waitonline.patch
@@ -0,0 +1,11 @@
+diff -up dovecot-2.3.0.1/dovecot.service.in.waitonline dovecot-2.3.0.1/dovecot.service.in
+--- dovecot-2.3.0.1/dovecot.service.in.waitonline	2018-03-01 10:35:39.888371078 +0100
++++ dovecot-2.3.0.1/dovecot.service.in	2018-03-01 10:36:29.738784661 +0100
+@@ -12,6 +12,7 @@ After=local-fs.target network-online.tar
+ 
+ [Service]
+ Type=simple
++ExecStartPre=/usr/libexec/dovecot/prestartscript
+ ExecStart=@sbindir@/dovecot -F
+ PIDFile=@rundir@/master.pid
+ ExecReload=@bindir@/doveadm reload
diff --git a/rpmbuild/SOURCES/dovecot-2.1.4-postreleasefix.patch b/rpmbuild/SOURCES/dovecot-2.1.4-postreleasefix.patch
new file mode 100644
index 000000000..c1f83e66f
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot-2.1.4-postreleasefix.patch
@@ -0,0 +1,27 @@
+# HG changeset patch
+# User Timo Sirainen <tss@iki.fi>
+# Date 1334041779 -10800
+# Node ID 20e1aa322b1e3b7d47c7cb1b6ff68a8d07fe6c9d
+# Parent  0b59dbb1a288153d2eb26d47cd9f7a953335c66f
+lib-storage: mail_user_try_home_expand() now looks up home only when needed.
+Before a recent code cleanup the lookup was always done, but if the home
+didn't exist it still just happened to return success. The cleanup changed
+it to return failure, which broke the original behavior.
+
+diff -r 0b59dbb1a288 -r 20e1aa322b1e src/lib-storage/mail-user.c
+--- a/src/lib-storage/mail-user.c	Tue Apr 10 09:52:35 2012 +0300
++++ b/src/lib-storage/mail-user.c	Tue Apr 10 10:09:39 2012 +0300
+@@ -343,6 +343,11 @@
+ {
+ 	const char *home, *path = *pathp;
+ 
++	if (strncmp(path, "~/", 2) != 0) {
++		/* no need to expand home */
++		return 0;
++	}
++
+ 	if (mail_user_get_home(user, &home) <= 0)
+ 		return -1;
+ 
+
+
diff --git a/rpmbuild/SOURCES/dovecot-2.2-80ed82a93c1a.patch b/rpmbuild/SOURCES/dovecot-2.2-80ed82a93c1a.patch
new file mode 100644
index 000000000..7aa01acc7
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot-2.2-80ed82a93c1a.patch
@@ -0,0 +1,450 @@
+
+# HG changeset patch
+# User Timo Sirainen <tss@iki.fi>
+# Date 1416386277 -32400
+# Node ID 80ed82a93c1af5f6885e75a34007eb52d0692a8d
+# Parent  31262a892ba7302bfea6e70e17d3acd468736d70
+mbox: Added more (and earlier) detection for errors in mbox istreams.
+
+diff -r 31262a892ba7 -r 80ed82a93c1a src/lib-storage/index/mbox/istream-raw-mbox.c
+--- a/src/lib-storage/index/mbox/istream-raw-mbox.c	Wed Nov 19 17:37:18 2014 +0900
++++ b/src/lib-storage/index/mbox/istream-raw-mbox.c	Wed Nov 19 17:37:57 2014 +0900
+@@ -506,7 +506,8 @@
+ 	return rstream->from_offset;
+ }
+ 
+-uoff_t istream_raw_mbox_get_header_offset(struct istream *stream)
++int istream_raw_mbox_get_header_offset(struct istream *stream,
++				       uoff_t *hdr_offset_r)
+ {
+ 	struct raw_mbox_istream *rstream =
+ 		(struct raw_mbox_istream *)stream->real_stream;
+@@ -520,13 +521,17 @@
+ 		i_error("Unexpectedly lost From-line from mbox file %s at "
+ 			"%"PRIuUOFF_T, i_stream_get_name(stream),
+ 			rstream->from_offset);
+-		return (uoff_t)-1;
++		return -1;
+ 	}
++	if (stream->stream_errno != 0)
++		return -1;
+ 
+-	return rstream->hdr_offset;
++	*hdr_offset_r = rstream->hdr_offset;
++	return 0;
+ }
+ 
+-uoff_t istream_raw_mbox_get_body_offset(struct istream *stream)
++int istream_raw_mbox_get_body_offset(struct istream *stream,
++				     uoff_t *body_offset_r)
+ {
+ 	struct raw_mbox_istream *rstream =
+ 		(struct raw_mbox_istream *)stream->real_stream;
+@@ -534,8 +539,10 @@
+ 
+ 	i_assert(rstream->seeked);
+ 
+-	if (rstream->body_offset != (uoff_t)-1)
+-		return rstream->body_offset;
++	if (rstream->body_offset != (uoff_t)-1) {
++		*body_offset_r = rstream->body_offset;
++		return 0;
++	}
+ 
+ 	offset = stream->v_offset;
+ 	i_stream_seek(stream, rstream->hdr_offset);
+@@ -551,27 +558,30 @@
+ 			} else {
+ 				i_assert(rstream->body_offset != (uoff_t)-1);
+ 			}
+-			break;
++			return -1;
+ 		}
+ 	}
+ 
+ 	i_stream_seek(stream, offset);
+-	return rstream->body_offset;
++	*body_offset_r = rstream->body_offset;
++	return 0;
+ }
+ 
+-uoff_t istream_raw_mbox_get_body_size(struct istream *stream,
+-				      uoff_t expected_body_size)
++int istream_raw_mbox_get_body_size(struct istream *stream,
++				   uoff_t expected_body_size,
++				   uoff_t *body_size_r)
+ {
+ 	struct raw_mbox_istream *rstream =
+ 		(struct raw_mbox_istream *)stream->real_stream;
+ 	const unsigned char *data;
+ 	size_t size;
+-	uoff_t old_offset, body_size, next_body_offset;
++	uoff_t old_offset, body_offset, body_size, next_body_offset;
+ 
+ 	i_assert(rstream->seeked);
+ 	i_assert(rstream->hdr_offset != (uoff_t)-1);
+ 
+-	(void)istream_raw_mbox_get_body_offset(stream);
++	if (istream_raw_mbox_get_body_offset(stream, &body_offset) < 0)
++		return -1;
+ 	body_size = rstream->mail_size == (uoff_t)-1 ? (uoff_t)-1 :
+ 		rstream->mail_size - (rstream->body_offset -
+ 				      rstream->hdr_offset);
+@@ -580,8 +590,10 @@
+ 		/* if we already have the existing body size, use it as long as
+ 		   it's >= expected body_size. otherwise the previous parsing
+ 		   may have stopped at a From_-line that belongs to the body. */
+-		if (body_size != (uoff_t)-1 && body_size >= expected_body_size)
+-			return body_size;
++		if (body_size != (uoff_t)-1 && body_size >= expected_body_size) {
++			*body_size_r = body_size;
++			return 0;
++		}
+ 
+ 		next_body_offset = rstream->body_offset + expected_body_size;
+ 		/* If header_missing_eoh is set, the message body begins with
+@@ -600,21 +612,27 @@
+ 			rstream->mail_size =
+ 				next_body_offset - rstream->hdr_offset;
+ 			i_stream_seek(stream, old_offset);
+-			return expected_body_size;
++			*body_size_r = expected_body_size;
++			return 0;
+ 		}
+ 		/* invalid expected_body_size */
+ 	}
+-	if (body_size != (uoff_t)-1)
+-		return body_size;
++	if (body_size != (uoff_t)-1) {
++		*body_size_r = body_size;
++		return 0;
++	}
+ 
+ 	/* have to read through the message body */
+ 	while (i_stream_read_data(stream, &data, &size, 0) > 0)
+ 		i_stream_skip(stream, size);
+ 	i_stream_seek(stream, old_offset);
++	if (stream->stream_errno != 0)
++		return -1;
+ 
+ 	i_assert(rstream->mail_size != (uoff_t)-1);
+-	return rstream->mail_size -
++	*body_size_r = rstream->mail_size -
+ 		(rstream->body_offset - rstream->hdr_offset);
++	return 0;
+ }
+ 
+ time_t istream_raw_mbox_get_received_time(struct istream *stream)
+@@ -651,13 +669,15 @@
+ 	return rstream->crlf_ending;
+ }
+ 
+-void istream_raw_mbox_next(struct istream *stream, uoff_t expected_body_size)
++int istream_raw_mbox_next(struct istream *stream, uoff_t expected_body_size)
+ {
+ 	struct raw_mbox_istream *rstream =
+ 		(struct raw_mbox_istream *)stream->real_stream;
+ 	uoff_t body_size;
+ 
+-	body_size = istream_raw_mbox_get_body_size(stream, expected_body_size);
++	if (istream_raw_mbox_get_body_size(stream, expected_body_size,
++					   &body_size) < 0)
++		return -1;
+ 	rstream->mail_size = (uoff_t)-1;
+ 
+ 	rstream->received_time = rstream->next_received_time;
+@@ -678,6 +698,7 @@
+ 
+ 	rstream->eof = FALSE;
+ 	rstream->istream.istream.eof = FALSE;
++	return 0;
+ }
+ 
+ int istream_raw_mbox_seek(struct istream *stream, uoff_t offset)
+@@ -698,10 +719,8 @@
+ 	/* if seeked is FALSE, we unlocked in the middle. don't try to use
+ 	   any cached state then. */
+ 	if (rstream->mail_size != (uoff_t)-1 && rstream->seeked &&
+-	    rstream->hdr_offset + rstream->mail_size == offset) {
+-		istream_raw_mbox_next(stream, (uoff_t)-1);
+-		return 0;
+-	}
++	    rstream->hdr_offset + rstream->mail_size == offset)
++		return istream_raw_mbox_next(stream, (uoff_t)-1);
+ 
+ 	if (offset == rstream->from_offset && rstream->seeked) {
+ 		/* back to beginning of current message */
+diff -r 31262a892ba7 -r 80ed82a93c1a src/lib-storage/index/mbox/istream-raw-mbox.h
+--- a/src/lib-storage/index/mbox/istream-raw-mbox.h	Wed Nov 19 17:37:18 2014 +0900
++++ b/src/lib-storage/index/mbox/istream-raw-mbox.h	Wed Nov 19 17:37:57 2014 +0900
+@@ -9,15 +9,18 @@
+ /* Return offset to beginning of the "\nFrom"-line. */
+ uoff_t istream_raw_mbox_get_start_offset(struct istream *stream);
+ /* Return offset to beginning of the headers. */
+-uoff_t istream_raw_mbox_get_header_offset(struct istream *stream);
++int istream_raw_mbox_get_header_offset(struct istream *stream,
++				       uoff_t *hdr_offset_r);
+ /* Return offset to beginning of the body. */
+-uoff_t istream_raw_mbox_get_body_offset(struct istream *stream);
++int istream_raw_mbox_get_body_offset(struct istream *stream,
++				     uoff_t *body_offset_r);
+ 
+ /* Return the number of bytes in the body of this message. If
+    expected_body_size isn't (uoff_t)-1, we'll use it as potentially valid body
+    size to avoid actually reading through the whole message. */
+-uoff_t istream_raw_mbox_get_body_size(struct istream *stream,
+-				      uoff_t expected_body_size);
++int istream_raw_mbox_get_body_size(struct istream *stream,
++				   uoff_t expected_body_size,
++				   uoff_t *body_size_r);
+ 
+ /* Return received time of current message, or (time_t)-1 if the timestamp is
+    broken. */
+@@ -30,7 +33,7 @@
+ 
+ /* Jump to next message. If expected_body_size isn't (uoff_t)-1, we'll use it
+    as potentially valid body size. */
+-void istream_raw_mbox_next(struct istream *stream, uoff_t expected_body_size);
++int istream_raw_mbox_next(struct istream *stream, uoff_t expected_body_size);
+ 
+ /* Seek to message at given offset. offset must point to beginning of
+    "\nFrom ", or 0 for beginning of file. Returns -1 if it offset doesn't
+diff -r 31262a892ba7 -r 80ed82a93c1a src/lib-storage/index/mbox/mbox-mail.c
+--- a/src/lib-storage/index/mbox/mbox-mail.c	Wed Nov 19 17:37:18 2014 +0900
++++ b/src/lib-storage/index/mbox/mbox-mail.c	Wed Nov 19 17:37:57 2014 +0900
+@@ -304,10 +304,10 @@
+ 		return -1;
+ 
+ 	/* our header size varies, so don't do any caching */
+-	body_offset = istream_raw_mbox_get_body_offset(mbox->mbox_stream);
+-	if (body_offset == (uoff_t)-1) {
++	if (istream_raw_mbox_get_body_offset(mbox->mbox_stream, &body_offset) < 0) {
+ 		mail_storage_set_critical(_mail->box->storage,
+-					  "Couldn't get mbox size");
++			"mbox %s: Couldn't get body offset for uid=%u",
++			mailbox_get_path(&mbox->box), mail->mail.mail.uid);
+ 		return -1;
+ 	}
+ 
+@@ -319,8 +319,13 @@
+ 		body_size = (uoff_t)-1;
+ 
+ 	/* verify that the calculated body size is correct */
+-	body_size = istream_raw_mbox_get_body_size(mbox->mbox_stream,
+-						   body_size);
++	if (istream_raw_mbox_get_body_size(mbox->mbox_stream,
++					   body_size, &body_size) < 0) {
++		mail_storage_set_critical(_mail->box->storage,
++			"mbox %s: Couldn't get body size for uid=%u",
++			mailbox_get_path(&mbox->box), mail->mail.mail.uid);
++		return -1;
++	}
+ 
+ 	data->physical_size = hdr_size.physical_size + body_size;
+ 	*size_r = data->physical_size;
+@@ -352,7 +357,12 @@
+ 	}
+ 
+ 	raw_stream = mbox->mbox_stream;
+-	hdr_offset = istream_raw_mbox_get_header_offset(raw_stream);
++	if (istream_raw_mbox_get_header_offset(raw_stream, &hdr_offset) < 0) {
++		mail_storage_set_critical(mbox->box.storage,
++			"mbox %s: Couldn't get header offset for uid=%u",
++			mailbox_get_path(&mbox->box), mail->mail.mail.uid);
++		return -1;
++	}
+ 	i_stream_seek(raw_stream, hdr_offset);
+ 
+ 	if (next_offset != (uoff_t)-1)
+diff -r 31262a892ba7 -r 80ed82a93c1a src/lib-storage/index/mbox/mbox-sync-parse.c
+--- a/src/lib-storage/index/mbox/mbox-sync-parse.c	Wed Nov 19 17:37:18 2014 +0900
++++ b/src/lib-storage/index/mbox/mbox-sync-parse.c	Wed Nov 19 17:37:57 2014 +0900
+@@ -453,8 +453,8 @@
+ 	return strcasecmp(key, func->header);
+ }
+ 
+-void mbox_sync_parse_next_mail(struct istream *input,
+-			       struct mbox_sync_mail_context *ctx)
++int mbox_sync_parse_next_mail(struct istream *input,
++			      struct mbox_sync_mail_context *ctx)
+ {
+ 	struct mbox_sync_context *sync_ctx = ctx->sync_ctx;
+ 	struct message_header_parser_ctx *hdr_ctx;
+@@ -545,6 +545,12 @@
+ 	}
+ 
+ 	ctx->body_offset = input->v_offset;
++	if (input->stream_errno != 0) {
++		mbox_sync_set_critical(ctx->sync_ctx, "read(%s) failed: %s",
++			i_stream_get_name(input), i_stream_get_error(input));
++		return -1;
++	}
++	return 0;
+ }
+ 
+ bool mbox_sync_parse_match_mail(struct mbox_mailbox *mbox,
+diff -r 31262a892ba7 -r 80ed82a93c1a src/lib-storage/index/mbox/mbox-sync-private.h
+--- a/src/lib-storage/index/mbox/mbox-sync-private.h	Wed Nov 19 17:37:18 2014 +0900
++++ b/src/lib-storage/index/mbox/mbox-sync-private.h	Wed Nov 19 17:37:57 2014 +0900
+@@ -158,8 +158,8 @@
+ void mbox_sync_set_critical(struct mbox_sync_context *sync_ctx,
+ 			    const char *fmt, ...) ATTR_FORMAT(2, 3);
+ 
+-void mbox_sync_parse_next_mail(struct istream *input,
+-			       struct mbox_sync_mail_context *ctx);
++int mbox_sync_parse_next_mail(struct istream *input,
++			      struct mbox_sync_mail_context *ctx);
+ bool mbox_sync_parse_match_mail(struct mbox_mailbox *mbox,
+ 				struct mail_index_view *view, uint32_t seq);
+ 
+diff -r 31262a892ba7 -r 80ed82a93c1a src/lib-storage/index/mbox/mbox-sync-rewrite.c
+--- a/src/lib-storage/index/mbox/mbox-sync-rewrite.c	Wed Nov 19 17:37:18 2014 +0900
++++ b/src/lib-storage/index/mbox/mbox-sync-rewrite.c	Wed Nov 19 17:37:57 2014 +0900
+@@ -318,11 +318,11 @@
+ 	return 1;
+ }
+ 
+-static void mbox_sync_read_next(struct mbox_sync_context *sync_ctx,
+-				struct mbox_sync_mail_context *mail_ctx,
+-				struct mbox_sync_mail *mails,
+-				uint32_t seq, uint32_t idx,
+-				uoff_t expunged_space)
++static int mbox_sync_read_next(struct mbox_sync_context *sync_ctx,
++			       struct mbox_sync_mail_context *mail_ctx,
++			       struct mbox_sync_mail *mails,
++			       uint32_t seq, uint32_t idx,
++			       uoff_t expunged_space)
+ {
+ 	unsigned int first_mail_expunge_extra;
+ 	uint32_t orig_next_uid;
+@@ -332,8 +332,12 @@
+ 	mail_ctx->seq = seq;
+ 	mail_ctx->header = sync_ctx->header;
+ 
+-	mail_ctx->mail.offset =
+-		istream_raw_mbox_get_header_offset(sync_ctx->input);
++	if (istream_raw_mbox_get_header_offset(sync_ctx->input,
++					       &mail_ctx->mail.offset) < 0) {
++		mbox_sync_set_critical(sync_ctx,
++			"Couldn't get header offset for seq=%u", seq);
++		return -1;
++	}
+ 	mail_ctx->mail.body_size = mails[idx].body_size;
+ 
+ 	orig_next_uid = sync_ctx->next_uid;
+@@ -361,7 +365,8 @@
+ 		mails[idx].from_offset += first_mail_expunge_extra;
+ 	}
+ 
+-	mbox_sync_parse_next_mail(sync_ctx->input, mail_ctx);
++	if (mbox_sync_parse_next_mail(sync_ctx->input, mail_ctx) < 0)
++		return -1;
+ 	i_assert(mail_ctx->mail.pseudo == mails[idx].pseudo);
+ 
+ 	/* set next_uid back before updating the headers. this is important
+@@ -381,6 +386,7 @@
+ 		if (mail_ctx->have_eoh)
+ 			str_append_c(mail_ctx->header, '\n');
+ 	}
++	return 0;
+ }
+ 
+ static int mbox_sync_read_and_move(struct mbox_sync_context *sync_ctx,
+@@ -398,8 +404,9 @@
+ 		if (mbox_sync_seek(sync_ctx, mails[idx].from_offset) < 0)
+ 			return -1;
+ 
+-		mbox_sync_read_next(sync_ctx, &new_mail_ctx, mails, seq, idx,
+-				    expunged_space);
++		if (mbox_sync_read_next(sync_ctx, &new_mail_ctx, mails, seq, idx,
++					expunged_space) < 0)
++			return -1;
+ 		mail_ctx = &new_mail_ctx;
+ 	} else {
+ 		i_assert(seq == mail_ctx->seq);
+diff -r 31262a892ba7 -r 80ed82a93c1a src/lib-storage/index/mbox/mbox-sync.c
+--- a/src/lib-storage/index/mbox/mbox-sync.c	Wed Nov 19 17:37:18 2014 +0900
++++ b/src/lib-storage/index/mbox/mbox-sync.c	Wed Nov 19 17:37:57 2014 +0900
+@@ -131,8 +131,10 @@
+ mbox_sync_read_next_mail(struct mbox_sync_context *sync_ctx,
+ 			 struct mbox_sync_mail_context *mail_ctx)
+ {
++	uoff_t offset;
++
+ 	/* get EOF */
+-	(void)istream_raw_mbox_get_header_offset(sync_ctx->input);
++	(void)istream_raw_mbox_get_header_offset(sync_ctx->input, &offset);
+ 	if (istream_raw_mbox_is_eof(sync_ctx->input))
+ 		return 0;
+ 
+@@ -144,19 +146,27 @@
+ 
+ 	mail_ctx->mail.from_offset =
+ 		istream_raw_mbox_get_start_offset(sync_ctx->input);
+-	mail_ctx->mail.offset =
+-		istream_raw_mbox_get_header_offset(sync_ctx->input);
++	if (istream_raw_mbox_get_header_offset(sync_ctx->input, &mail_ctx->mail.offset) < 0) {
++		mbox_sync_set_critical(sync_ctx,
++			"Couldn't get header offset for seq=%u", mail_ctx->seq);
++		return -1;
++	}
+ 
+-	mbox_sync_parse_next_mail(sync_ctx->input, mail_ctx);
++	if (mbox_sync_parse_next_mail(sync_ctx->input, mail_ctx) < 0)
++		return -1;
++	if (istream_raw_mbox_is_corrupted(sync_ctx->input))
++		return -1;
++
+ 	i_assert(sync_ctx->input->v_offset != mail_ctx->mail.from_offset ||
+ 		 sync_ctx->input->eof);
+ 
+-	if (istream_raw_mbox_is_corrupted(sync_ctx->input))
++	if (istream_raw_mbox_get_body_size(sync_ctx->input,
++					   mail_ctx->content_length,
++					   &mail_ctx->mail.body_size) < 0) {
++		mbox_sync_set_critical(sync_ctx,
++			"Couldn't get body size for seq=%u", mail_ctx->seq);
+ 		return -1;
+-
+-	mail_ctx->mail.body_size =
+-		istream_raw_mbox_get_body_size(sync_ctx->input,
+-					       mail_ctx->content_length);
++	}
+ 	i_assert(mail_ctx->mail.body_size < OFF_T_MAX);
+ 
+ 	if ((mail_ctx->mail.flags & MAIL_RECENT) != 0 &&
+@@ -810,7 +820,7 @@
+ mbox_sync_seek_to_seq(struct mbox_sync_context *sync_ctx, uint32_t seq)
+ {
+ 	struct mbox_mailbox *mbox = sync_ctx->mbox;
+-	uoff_t old_offset;
++	uoff_t old_offset, offset;
+ 	uint32_t uid;
+ 	int ret;
+         bool deleted;
+@@ -864,7 +874,11 @@
+ 
+         sync_ctx->idx_seq = seq;
+ 	sync_ctx->dest_first_mail = sync_ctx->seq == 0;
+-        (void)istream_raw_mbox_get_body_offset(sync_ctx->input);
++	if (istream_raw_mbox_get_body_offset(sync_ctx->input, &offset) < 0) {
++		mbox_sync_set_critical(sync_ctx,
++			"Message body offset lookup failed");
++		return -1;
++	}
+ 	return 1;
+ }
+ 
+@@ -1149,8 +1163,9 @@
+ 			sync_ctx->idx_seq++;
+ 		}
+ 
+-		istream_raw_mbox_next(sync_ctx->input,
+-				      mail_ctx->mail.body_size);
++		if (istream_raw_mbox_next(sync_ctx->input,
++					  mail_ctx->mail.body_size) < 0)
++			return -1;
+ 		offset = istream_raw_mbox_get_start_offset(sync_ctx->input);
+ 
+ 		if (sync_ctx->need_space_seq != 0) {
+
diff --git a/rpmbuild/SOURCES/dovecot-2.2.20-initbysystemd.patch b/rpmbuild/SOURCES/dovecot-2.2.20-initbysystemd.patch
new file mode 100644
index 000000000..7e3d94ca0
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot-2.2.20-initbysystemd.patch
@@ -0,0 +1,46 @@
+diff -up dovecot-2.3.0.1/dovecot-init.service.initbysystemd dovecot-2.3.0.1/dovecot-init.service
+--- dovecot-2.3.0.1/dovecot-init.service.initbysystemd	2018-03-01 10:38:22.059716008 +0100
++++ dovecot-2.3.0.1/dovecot-init.service	2018-03-01 10:38:22.059716008 +0100
+@@ -0,0 +1,13 @@
++[Unit]
++Description=One-time Dovecot init service
++ConditionPathExists=|!/etc/pki/dovecot/certs/dovecot.pem
++
++[Service]
++Type=oneshot
++RemainAfterExit=no
++ExecStart=/bin/sh -c '\
++if [ ! -f /etc/pki/dovecot/certs/dovecot.pem ]; \
++then\
++  SSLDIR=/etc/pki/dovecot/ OPENSSLCONFIG=/etc/pki/dovecot/dovecot-openssl.cnf /usr/libexec/dovecot/mkcert.sh /dev/null 2>&1;\
++fi'
++
+diff -up dovecot-2.3.0.1/dovecot.service.in.initbysystemd dovecot-2.3.0.1/dovecot.service.in
+--- dovecot-2.3.0.1/dovecot.service.in.initbysystemd	2018-03-01 10:38:22.060716016 +0100
++++ dovecot-2.3.0.1/dovecot.service.in	2018-03-01 10:40:45.524901319 +0100
+@@ -8,7 +8,8 @@
+ Description=Dovecot IMAP/POP3 email server
+ Documentation=man:dovecot(1)
+ Documentation=http://wiki2.dovecot.org/
+-After=local-fs.target network-online.target
++After=local-fs.target network-online.target dovecot-init.service
++Requires=dovecot-init.service
+ 
+ [Service]
+ Type=simple
+diff -up dovecot-2.3.0.1/Makefile.am.initbysystemd dovecot-2.3.0.1/Makefile.am
+--- dovecot-2.3.0.1/Makefile.am.initbysystemd	2018-02-28 15:28:57.000000000 +0100
++++ dovecot-2.3.0.1/Makefile.am	2018-03-01 10:38:22.060716016 +0100
+@@ -63,9 +63,10 @@ if HAVE_SYSTEMD
+ 
+ systemdsystemunit_DATA = \
+         dovecot.socket \
+-        dovecot.service
++        dovecot.service \
++        dovecot-init.service
+ else
+-EXTRA_DIST += dovecot.socket dovecot.service.in
++EXTRA_DIST += dovecot.socket dovecot.service.in dovecot-init.service
+ endif
+ 
+ install-exec-hook:
diff --git a/rpmbuild/SOURCES/dovecot-2.2.22-systemd_w_protectsystem.patch b/rpmbuild/SOURCES/dovecot-2.2.22-systemd_w_protectsystem.patch
new file mode 100644
index 000000000..d00a9b9dc
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot-2.2.22-systemd_w_protectsystem.patch
@@ -0,0 +1,11 @@
+diff -up dovecot-2.3.2/dovecot.service.in.systemd_w_protectsystem dovecot-2.3.2/dovecot.service.in
+--- dovecot-2.3.2/dovecot.service.in.systemd_w_protectsystem	2018-07-09 12:00:13.359193526 +0200
++++ dovecot-2.3.2/dovecot.service.in	2018-07-09 12:00:46.387716884 +0200
+@@ -23,6 +23,7 @@ ExecReload=@bindir@/doveadm reload
+ ExecStop=@bindir@/doveadm stop
+ PrivateTmp=true
+ NonBlocking=yes
++# this will make /usr /boot /etc read only for dovecot
+ ProtectSystem=full
+ ProtectHome=no
+ PrivateDevices=true
diff --git a/rpmbuild/SOURCES/dovecot-2.3.0.1-libxcrypt.patch b/rpmbuild/SOURCES/dovecot-2.3.0.1-libxcrypt.patch
new file mode 100644
index 000000000..a8c33bf7a
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot-2.3.0.1-libxcrypt.patch
@@ -0,0 +1,11 @@
+diff -up dovecot-2.3.0.1/src/auth/mycrypt.c.libxcrypt dovecot-2.3.0.1/src/auth/mycrypt.c
+--- dovecot-2.3.0.1/src/auth/mycrypt.c.libxcrypt       2018-02-28 15:28:58.000000000 +0100
++++ dovecot-2.3.0.1/src/auth/mycrypt.c 2018-03-27 10:57:38.447769201 +0200
+@@ -14,6 +14,7 @@
+ #  define _XPG6 /* Some Solaris versions require this, some break with this */
+ #endif
+ #include <unistd.h>
++#include <crypt.h>
+ 
+ #include "mycrypt.h"
+ 
diff --git a/rpmbuild/SOURCES/dovecot.conf.5 b/rpmbuild/SOURCES/dovecot.conf.5
new file mode 100644
index 000000000..a15f1f6dd
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot.conf.5
@@ -0,0 +1,19 @@
+.TH DOVECOT.CONF 5 2010/06/27 "dovecot" "File Formats and Conventions"
+.SH NAME
+\fBdovecot.conf\fP \- The configuration file for dovecot imap and pop3 server
+
+.SH FULL PATH
+.B /etc/dovecot.conf
+
+.SH DESCRIPTION
+The dovecot.conf file is a configuration file for the
+.BR dovecot (1)
+imap and pop3 server. The dovecot.conf configuration file contains description to all available options. Some of these options are described also in offline wiki documentation placed in /usr/share/doc/dovecot*/wiki/.
+
+For backup purposes unmodified version of dovecot.conf can be found in /usr/share/doc/dovecot-<version>/example-config/dovecot.conf.default
+
+.SH "SEE ALSO"
+.BR doveadm (1),
+.BR dovecot (1),
+.I /usr/share/doc/dovecot*/wiki/
+.I /usr/share/doc/dovecot*/dovecot.conf.default
diff --git a/rpmbuild/SOURCES/dovecot.init b/rpmbuild/SOURCES/dovecot.init
new file mode 100755
index 000000000..49206f0ab
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot.init
@@ -0,0 +1,108 @@
+#!/bin/bash
+#
+#	/etc/rc.d/init.d/dovecot
+#
+# Starts the dovecot daemon
+#
+# chkconfig: - 65 35
+# description: Dovecot Imap Server
+# processname: dovecot
+# config: /etc/dovecot.conf
+# config: /etc/sysconfig/dovecot
+# pidfile: /var/run/dovecot/master.pid
+
+### BEGIN INIT INFO
+# Provides: dovecot
+# Required-Start: $local_fs $network
+# Required-Stop: $local_fs $network
+# Should-Start: $remote_fs
+# Should-Stop: $remote_fs
+# Default-Start: 
+# Default-Stop: 0 1 2 3 4 5 6
+# Short-Description: start and stop Dovecot Imap server
+# Description: Dovecot is an IMAP server for Linux/UNIX-like systems,
+#              written with security primarily in mind.  It also contains
+#              a small POP3 server.
+### END INIT INFO
+
+# Source function library.
+. /etc/init.d/functions
+
+if [ -f /etc/sysconfig/dovecot -a $UID -eq 0 ]; then
+    . /etc/sysconfig/dovecot
+fi
+
+RETVAL=0
+prog="Dovecot Imap"
+exec="/usr/sbin/dovecot"
+config="/etc/dovecot/dovecot.conf"
+pidfile="/var/run/dovecot/master.pid"
+lockfile="/var/lock/subsys/dovecot"
+
+start() {
+	[ $UID -eq 0 ] || exit 4
+	[ -x $exec ] || exit 5
+	[ -f $config ] || exit 6
+
+        echo -n $"Starting $prog: "
+	daemon --pidfile $pidfile $exec $OPTIONS
+	RETVAL=$?
+	[ $RETVAL -eq 0 ] && touch  $lockfile
+	echo
+}
+
+stop() {
+	[ $UID -eq 0 ] || exit 4
+	echo -n $"Stopping $prog: "
+	killproc -p $pidfile $exec
+	RETVAL=$?
+	[ $RETVAL -eq 0 ] && rm -f $lockfile
+	echo
+}
+
+reload() {
+	[ $UID -eq 0 ] || exit 4
+	echo -n $"Reloading $prog: "
+	killproc -p $pidfile $exec -HUP
+	RETVAL=$?
+	echo
+}
+
+#
+#	See how we were called.
+#
+case "$1" in
+  start)
+	start
+	;;
+  stop)
+	stop
+	;;
+  reload)
+	reload
+	;;
+  force-reload|restart)
+	stop
+	sleep 1
+	start
+	RETVAL=$?
+	;;
+  condrestart|try-restart)
+	if [ -f $lockfile ]; then
+	    stop
+	    sleep 3
+	    start
+	fi
+	;;
+  status)
+	status -p $pidfile $exec
+	RETVAL=$?
+	;;
+  *)
+	echo $"Usage: $0 {condrestart|try-restart|start|stop|restart|reload|force-reload|status}"
+	RETVAL=2
+	[ "$1" = 'usage' ] && RETVAL=0
+esac
+
+exit $RETVAL
+
diff --git a/rpmbuild/SOURCES/dovecot.pam b/rpmbuild/SOURCES/dovecot.pam
new file mode 100644
index 000000000..5b9f05ff9
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot.pam
@@ -0,0 +1,5 @@
+#%PAM-1.0
+auth       required     pam_nologin.so
+auth       include      password-auth
+account    include      password-auth
+session    include      password-auth
diff --git a/rpmbuild/SOURCES/dovecot.spec b/rpmbuild/SOURCES/dovecot.spec
new file mode 100644
index 000000000..863d7364a
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot.spec
@@ -0,0 +1,2489 @@
+%global __provides_exclude_from %{_docdir}
+%global __requires_exclude_from %{_docdir}
+Summary: Secure imap and pop3 server
+Name: dovecot
+# Epoch must be 2 for O+P patched version
+Epoch: 2
+Version: 2.3.8
+%global prever %{nil}
+Release: op1%{?dist}
+#dovecot itself is MIT, a few sources are PD, pigeonhole is LGPLv2
+License: MIT and LGPLv2
+
+URL: http://www.dovecot.org/
+Source: http://www.dovecot.org/releases/2.3/%{name}-%{version}%{?prever}.tar.gz
+Source1: dovecot.init
+Source2: dovecot.pam
+%global pigeonholever 0.5.8
+Source8: http://pigeonhole.dovecot.org/releases/2.3/dovecot-2.3-pigeonhole-%{pigeonholever}.tar.gz
+Source9: dovecot.sysconfig
+Source10: dovecot.tmpfilesd
+
+#our own
+Source14: dovecot.conf.5
+
+# 3x Fedora/RHEL specific
+Patch1: dovecot-2.0-defaultconfig.patch
+Patch2: dovecot-1.0.beta2-mkcert-permissions.patch
+Patch3: dovecot-1.0.rc7-mkcert-paths.patch
+
+#wait for network
+Patch6: dovecot-2.1.10-waitonline.patch
+
+Patch8: dovecot-2.2.20-initbysystemd.patch
+Patch9: dovecot-2.2.22-systemd_w_protectsystem.patch
+Patch10: dovecot-2.3.0.1-libxcrypt.patch
+
+# HIN patch
+Patch11: 
+
+Source15: prestartscript
+
+BuildRequires: gcc, gcc-c++, openssl-devel, pam-devel, zlib-devel, bzip2-devel, libcap-devel
+BuildRequires: libtool, autoconf, automake, pkgconfig
+BuildRequires: sqlite-devel
+BuildRequires: libpq-devel
+%if %{?fedora}0 < 280
+BuildRequires: mysql-devel
+BuildRequires: tcp_wrappers-devel
+%else
+BuildRequires: mariadb-connector-c-devel
+BuildRequires: libxcrypt-devel
+%endif
+BuildRequires: openldap-devel
+BuildRequires: krb5-devel
+BuildRequires: quota-devel
+BuildRequires: xz-devel
+BuildRequires: lz4-devel
+BuildRequires: libsodium-devel
+BuildRequires: libexttextcat-devel
+BuildRequires: libstemmer-devel
+
+# gettext-devel is needed for running autoconf because of the
+# presence of AM_ICONV
+BuildRequires: gettext-devel
+
+# Explicit Runtime Requirements for executalbe
+Requires: openssl >= 0.9.7f-4
+
+# Package includes an initscript service file, needs to require initscripts package
+Requires(pre): shadow-utils
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+Requires: systemd
+Requires(post): systemd-units
+Requires(preun): systemd-units
+Requires(postun): systemd-units
+%else
+Requires: initscripts
+Requires(post): chkconfig
+Requires(preun): chkconfig initscripts
+Requires(postun): initscripts
+%endif
+
+%if %{?fedora}0 > 150 || %{?rhel}0 >60
+#clucene in fedora <=15 and rhel<=6 is too old
+BuildRequires: clucene-core-devel
+%endif
+
+%global ssldir %{_sysconfdir}/pki/%{name}
+
+%if %{?fedora}00%{?rhel} < 6
+%global _initddir %{_initrddir}
+BuildRequires: curl-devel expat-devel
+%else
+BuildRequires: libcurl-devel expat-devel
+%endif
+
+%global restart_flag /run/%{name}/%{name}-restart-after-rpm-install
+
+%description
+Dovecot is an IMAP server for Linux/UNIX-like systems, written with security 
+primarily in mind.  It also contains a small POP3 server.  It supports mail 
+in either of maildir or mbox formats.
+
+The SQL drivers and authentication plug-ins are in their subpackages.
+
+%package pigeonhole
+Requires: %{name} = %{epoch}:%{version}-%{release}
+Summary: Sieve and managesieve plug-in for dovecot
+License: MIT and LGPLv2
+
+%description pigeonhole
+This package provides sieve and managesieve plug-in for dovecot LDA.
+
+%package pgsql
+Requires: %{name} = %{epoch}:%{version}-%{release}
+Summary: Postgres SQL back end for dovecot
+%description pgsql
+This package provides the Postgres SQL back end for dovecot-auth etc.
+
+%package mysql
+Requires: %{name} = %{epoch}:%{version}-%{release}
+Summary: MySQL back end for dovecot
+%description mysql
+This package provides the MySQL back end for dovecot-auth etc.
+
+%package devel
+Requires: %{name} = %{epoch}:%{version}-%{release}
+Summary: Development files for dovecot
+%description devel
+This package provides the development files for dovecot.
+
+%prep
+%setup -q -n %{name}-%{version}%{?prever} -a 8
+%patch1 -p1 -b .default-settings
+%patch2 -p1 -b .mkcert-permissions
+%patch3 -p1 -b .mkcert-paths
+%patch6 -p1 -b .waitonline
+%patch8 -p1 -b .initbysystemd
+%patch9 -p1 -b .systemd_w_protectsystem
+#%patch10 -p1 -b .libxcrypt
+
+#pushd dovecot-2*3-pigeonhole-%{pigeonholever}
+#popd
+sed -i '/DEFAULT_INCLUDES *=/s|$| '"$(pkg-config --cflags libclucene-core)|" src/plugins/fts-lucene/Makefile.in
+
+%build
+#required for fdpass.c line 125,190: dereferencing type-punned pointer will break strict-aliasing rules
+%global _hardened_build 1
+export CFLAGS="%{__global_cflags} -fno-strict-aliasing -fstack-reuse=none"
+export LDFLAGS="-Wl,-z,now -Wl,-z,relro %{?__global_ldflags}"
+# el6 autoconf too old to regen; use packaged files (#1082384)
+%if %{?fedora}00%{?rhel} > 6
+mkdir -p m4
+autoreconf -I . -fiv #required for aarch64 support
+%endif
+%configure                       \
+    INSTALL_DATA="install -c -p -m644" \
+    --docdir=%{_docdir}/%{name}  \
+    --disable-static             \
+    --disable-rpath              \
+    --with-nss                   \
+    --with-shadow                \
+    --with-pam                   \
+    --with-gssapi=plugin         \
+    --with-ldap=plugin           \
+    --with-sql=plugin            \
+    --with-pgsql                 \
+    --with-mysql                 \
+    --with-sqlite                \
+    --with-zlib                  \
+    --with-libcap                \
+%if %{?fedora}0 < 280
+    --with-libwrap               \
+%endif
+%if %{?fedora}0 > 150 || %{?rhel}0 >60
+    --with-lucene                \
+%endif
+    --with-ssl=openssl           \
+    --with-ssldir=%{ssldir}      \
+    --with-solr                  \
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+    --with-systemdsystemunitdir=%{_unitdir}  \
+%endif
+    --with-docs
+
+sed -i 's|/etc/ssl|/etc/pki/dovecot|' doc/mkcert.sh doc/example-config/conf.d/10-ssl.conf
+
+make %{?_smp_mflags}
+
+#pigeonhole
+pushd dovecot-2*3-pigeonhole-%{pigeonholever}
+
+# required for snapshot
+[ -f configure ] || autoreconf -fiv
+[ -f ChangeLog ] || echo "Pigeonhole ChangeLog is not available, yet" >ChangeLog
+
+%configure                             \
+    INSTALL_DATA="install -c -p -m644" \
+    --disable-static                   \
+    --with-dovecot=../                 \
+    --without-unfinished-features
+
+make %{?_smp_mflags}
+popd
+
+%install
+rm -rf $RPM_BUILD_ROOT
+
+make install DESTDIR=$RPM_BUILD_ROOT
+
+#move doc dir back to build dir so doc macro in files section can use it
+mv $RPM_BUILD_ROOT/%{_docdir}/%{name} %{_builddir}/%{name}-%{version}%{?prever}/docinstall
+
+
+pushd dovecot-2*3-pigeonhole-%{pigeonholever}
+make install DESTDIR=$RPM_BUILD_ROOT
+
+mv $RPM_BUILD_ROOT/%{_docdir}/%{name} $RPM_BUILD_ROOT/%{_docdir}/%{name}-pigeonhole
+
+install -m 644 AUTHORS ChangeLog COPYING COPYING.LGPL INSTALL NEWS README $RPM_BUILD_ROOT/%{_docdir}/%{name}-pigeonhole
+popd
+
+
+%if %{?fedora}00%{?rhel} < 6
+sed -i 's|password-auth|system-auth|' %{SOURCE2}
+%endif
+
+install -p -D -m 644 %{SOURCE2} $RPM_BUILD_ROOT%{_sysconfdir}/pam.d/dovecot
+
+#install man pages
+install -p -D -m 644 %{SOURCE14} $RPM_BUILD_ROOT%{_mandir}/man5/dovecot.conf.5
+
+#install waitonline script
+install -p -D -m 755 %{SOURCE15} $RPM_BUILD_ROOT%{_libexecdir}/dovecot/prestartscript
+
+# generate ghost .pem files
+mkdir -p $RPM_BUILD_ROOT%{ssldir}/certs
+mkdir -p $RPM_BUILD_ROOT%{ssldir}/private
+touch $RPM_BUILD_ROOT%{ssldir}/certs/dovecot.pem
+chmod 600 $RPM_BUILD_ROOT%{ssldir}/certs/dovecot.pem
+touch $RPM_BUILD_ROOT%{ssldir}/private/dovecot.pem
+chmod 600 $RPM_BUILD_ROOT%{ssldir}/private/dovecot.pem
+
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+install -p -D -m 644 %{SOURCE10} $RPM_BUILD_ROOT%{_tmpfilesdir}/dovecot.conf
+%else
+install -p -D -m 755 %{SOURCE1} $RPM_BUILD_ROOT%{_initddir}/dovecot
+install -p -D -m 600 %{SOURCE9} $RPM_BUILD_ROOT%{_sysconfdir}/sysconfig/dovecot
+%endif
+
+mkdir -p $RPM_BUILD_ROOT/run/dovecot/{login,empty,token-login}
+
+# Install dovecot configuration and dovecot-openssl.cnf
+mkdir -p $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/conf.d
+install -p -m 644 docinstall/example-config/dovecot.conf $RPM_BUILD_ROOT%{_sysconfdir}/dovecot
+install -p -m 644 docinstall/example-config/conf.d/*.conf $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/conf.d
+install -p -m 644 $RPM_BUILD_ROOT/%{_docdir}/%{name}-pigeonhole/example-config/conf.d/*.conf $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/conf.d
+install -p -m 644 docinstall/example-config/conf.d/*.conf.ext $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/conf.d
+install -p -m 644 $RPM_BUILD_ROOT/%{_docdir}/%{name}-pigeonhole/example-config/conf.d/*.conf.ext $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/conf.d ||:
+install -p -m 644 doc/dovecot-openssl.cnf $RPM_BUILD_ROOT%{ssldir}/dovecot-openssl.cnf
+
+install -p -m755 doc/mkcert.sh $RPM_BUILD_ROOT%{_libexecdir}/%{name}/mkcert.sh
+
+mkdir -p $RPM_BUILD_ROOT/var/lib/dovecot
+
+#remove the libtool archives
+find $RPM_BUILD_ROOT%{_libdir}/%{name}/ -name '*.la' | xargs rm -f
+
+#remove what we don't want
+rm -f $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/README
+pushd docinstall
+rm -f securecoding.txt thread-refs.txt
+popd
+
+
+%pre
+#dovecot uid and gid are reserved, see /usr/share/doc/setup-*/uidgid 
+getent group dovecot >/dev/null || groupadd -r --gid 97 dovecot
+getent passwd dovecot >/dev/null || \
+useradd -r --uid 97 -g dovecot -d /usr/libexec/dovecot -s /sbin/nologin -c "Dovecot IMAP server" dovecot
+
+getent group dovenull >/dev/null || groupadd -r dovenull
+getent passwd dovenull >/dev/null || \
+useradd -r -g dovenull -d /usr/libexec/dovecot -s /sbin/nologin -c "Dovecot's unauthorized user" dovenull
+
+# do not let dovecot run during upgrade rhbz#134325
+if [ "$1" = "2" ]; then
+  rm -f %restart_flag
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+  /bin/systemctl is-active %{name}.service >/dev/null 2>&1 && touch %restart_flag ||:
+  /bin/systemctl stop %{name}.service >/dev/null 2>&1
+%else
+  /sbin/service %{name} status >/dev/null 2>&1 && touch %restart_flag ||:
+  /sbin/service %{name} stop >/dev/null 2>&1
+%endif
+fi
+
+%post
+if [ $1 -eq 1 ]
+then
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+  %systemd_post dovecot.service
+%else
+  /sbin/chkconfig --add %{name}
+%endif
+fi
+
+install -d -m 0755 -g dovecot -d /run/dovecot
+install -d -m 0755 -d /run/dovecot/empty
+install -d -m 0750 -g dovenull -d /run/dovecot/login
+install -d -m 0755 -g dovenull -d /run/dovecot/token-login
+[ -x /sbin/restorecon ] && /sbin/restorecon -R /run/dovecot
+
+%preun
+if [ $1 = 0 ]; then
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+        /bin/systemctl disable dovecot.service dovecot.socket >/dev/null 2>&1 || :
+        /bin/systemctl stop dovecot.service dovecot.socket >/dev/null 2>&1 || :
+%else
+    /sbin/service %{name} stop > /dev/null 2>&1
+    /sbin/chkconfig --del %{name}
+%endif
+    rm -rf /run/dovecot
+fi
+
+%postun
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+/bin/systemctl daemon-reload >/dev/null 2>&1 || :
+%endif
+
+if [ "$1" -ge "1" -a -e %restart_flag ]; then
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+    /bin/systemctl start dovecot.service >/dev/null 2>&1 || :
+%else
+    /sbin/service %{name} start >/dev/null 2>&1 || :
+%endif
+rm -f %restart_flag
+fi
+
+%posttrans
+# dovecot should be started again in %%postun, but it's not executed on reinstall
+# if it was already started, restart_flag won't be here, so it's ok to test it again
+if [ -e %restart_flag ]; then
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+    /bin/systemctl start dovecot.service >/dev/null 2>&1 || :
+%else
+    /sbin/service %{name} start >/dev/null 2>&1 || :
+%endif
+rm -f %restart_flag
+fi
+
+%check
+make check
+cd dovecot-2*3-pigeonhole-%{pigeonholever}
+make check
+
+%files
+%doc docinstall/* AUTHORS ChangeLog COPYING COPYING.LGPL COPYING.MIT NEWS README
+%{_sbindir}/dovecot
+
+%{_bindir}/doveadm
+%{_bindir}/doveconf
+%{_bindir}/dsync
+
+
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+%_tmpfilesdir/dovecot.conf
+%{_unitdir}/dovecot.service
+%{_unitdir}/dovecot-init.service
+%{_unitdir}/dovecot.socket
+%else
+%{_initddir}/dovecot
+%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/dovecot
+%endif
+
+%dir %{_sysconfdir}/dovecot
+%dir %{_sysconfdir}/dovecot/conf.d
+%config(noreplace) %{_sysconfdir}/dovecot/dovecot.conf
+#list all so we'll be noticed if upstream changes anything
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-auth.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-director.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-logging.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-mail.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-master.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-ssl.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/15-lda.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/15-mailboxes.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/20-imap.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/20-lmtp.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/20-pop3.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/20-submission.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/90-acl.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/90-quota.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/90-plugin.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-checkpassword.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-deny.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-dict.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-ldap.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-master.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-passwdfile.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-sql.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-static.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-system.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-vpopmail.conf.ext
+
+%config(noreplace) %{_sysconfdir}/pam.d/dovecot
+%config(noreplace) %{ssldir}/dovecot-openssl.cnf
+
+%dir %{ssldir}
+%dir %{ssldir}/certs
+%dir %{ssldir}/private
+%attr(0600,root,root) %ghost %config(missingok,noreplace) %verify(not md5 size mtime) %{ssldir}/certs/dovecot.pem
+%attr(0600,root,root) %ghost %config(missingok,noreplace) %verify(not md5 size mtime) %{ssldir}/private/dovecot.pem
+
+%dir %{_libdir}/dovecot
+%dir %{_libdir}/dovecot/auth
+%dir %{_libdir}/dovecot/dict
+%{_libdir}/dovecot/doveadm
+%exclude %{_libdir}/dovecot/doveadm/*sieve*
+%{_libdir}/dovecot/*.so.*
+#these (*.so files) are plugins, not devel files
+%{_libdir}/dovecot/*_plugin.so
+%exclude %{_libdir}/dovecot/*_sieve_plugin.so
+%{_libdir}/dovecot/auth/lib20_auth_var_expand_crypt.so
+%{_libdir}/dovecot/auth/libauthdb_imap.so
+%{_libdir}/dovecot/auth/libauthdb_ldap.so
+%{_libdir}/dovecot/auth/libmech_gssapi.so
+%{_libdir}/dovecot/auth/libdriver_sqlite.so
+%{_libdir}/dovecot/dict/libdriver_sqlite.so
+%{_libdir}/dovecot/dict/libdict_ldap.so
+%{_libdir}/dovecot/libdriver_sqlite.so
+%{_libdir}/dovecot/libssl_iostream_openssl.so
+%{_libdir}/dovecot/libfs_compress.so
+%{_libdir}/dovecot/libfs_crypt.so
+%{_libdir}/dovecot/libfs_mail_crypt.so
+%{_libdir}/dovecot/libdcrypt_openssl.so
+%{_libdir}/dovecot/lib20_var_expand_crypt.so
+%{_libdir}/dovecot/old-stats/libold_stats_mail.so
+%{_libdir}/dovecot/old-stats/libstats_auth.so
+
+%dir %{_libdir}/dovecot/settings
+
+%{_libexecdir}/%{name}
+%exclude %{_libexecdir}/%{name}/managesieve*
+
+%ghost /run/dovecot
+%attr(0750,dovecot,dovecot) /var/lib/dovecot
+
+%{_datadir}/%{name}
+
+%{_mandir}/man1/deliver.1*
+%{_mandir}/man1/doveadm*.1*
+%{_mandir}/man1/doveconf.1*
+%{_mandir}/man1/dovecot*.1*
+%{_mandir}/man1/dsync.1*
+%{_mandir}/man5/dovecot.conf.5*
+%{_mandir}/man7/doveadm-search-query.7*
+
+%files devel
+%{_includedir}/dovecot
+%{_datadir}/aclocal/dovecot*.m4
+%{_libdir}/dovecot/libdovecot*.so
+%{_libdir}/dovecot/dovecot-config
+
+%files pigeonhole
+%{_bindir}/sieve-dump
+%{_bindir}/sieve-filter
+%{_bindir}/sieve-test
+%{_bindir}/sievec
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/20-managesieve.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/90-sieve.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/90-sieve-extprograms.conf
+
+%{_docdir}/%{name}-pigeonhole
+
+%{_libexecdir}/%{name}/managesieve
+%{_libexecdir}/%{name}/managesieve-login
+
+%{_libdir}/dovecot/doveadm/*sieve*
+%{_libdir}/dovecot/*_sieve_plugin.so
+%{_libdir}/dovecot/settings/libmanagesieve_*.so
+%{_libdir}/dovecot/settings/libpigeonhole_*.so
+%{_libdir}/dovecot/sieve/
+
+%{_mandir}/man1/sieve-dump.1*
+%{_mandir}/man1/sieve-filter.1*
+%{_mandir}/man1/sieve-test.1*
+%{_mandir}/man1/sievec.1*
+%{_mandir}/man1/sieved.1*
+%{_mandir}/man7/pigeonhole.7*
+
+%files mysql
+%{_libdir}/%{name}/libdriver_mysql.so
+%{_libdir}/%{name}/auth/libdriver_mysql.so
+%{_libdir}/%{name}/dict/libdriver_mysql.so
+
+%files pgsql
+%{_libdir}/%{name}/libdriver_pgsql.so
+%{_libdir}/%{name}/auth/libdriver_pgsql.so
+%{_libdir}/%{name}/dict/libdriver_pgsql.so
+
+%changelog
+* Thu Oct 10 2019 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.8-1
+- dovecot updated to 2.3.8, pigeonhole 0.5.8
+
+* Thu Aug 29 2019 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.7.2-1
+- dovecot updated to 2.3.7.2, pigeonhole 0.5.7.2
+- fixes CVE-2019-11500: IMAP protocol parser does not properly handle NUL byte
+  when scanning data in quoted strings, leading to out of bounds heap
+  memory writes
+
+* Mon Aug 19 2019 Michal Hlavinka <mhlavink@redhat.com> - 1:1-2.3.7.1
+- dovecot updated to 2.3.7.1, pigeonhole updated to 0.5.7.1
+
+* Wed Jul 24 2019 Fedora Release Engineering <releng@fedoraproject.org> - 1:2.3.6-4
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_31_Mass_Rebuild
+
+* Fri May 31 2019 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.6-3
+- disable gcc 9 stack reuse temporarily
+
+* Mon May 13 2019 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.6-2
+- use /run instead of /var/run (#1706372)
+
+* Thu May 02 2019 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.6-1
+- dovecot updated to 2.3.6, pigeonhole updated to 0.5.6
+
+* Thu Apr 18 2019 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.5.2-1
+- dovecot updated to 2.3.5.2
+- fixes CVE-2019-10691: Trying to login with 8bit username containing
+  invalid UTF8 input causes auth process to crash if auth policy is enabled.
+
+* Thu Mar 28 2019 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.5.1-1
+- dovecot updated to 2.3.5.1
+- CVE-2019-7524: Missing input buffer size validation leads into
+  arbitrary buffer overflow when reading fts or pop3 uidl header
+  from Dovecot index.
+
+* Wed Mar 06 2019 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.5-1
+- dovecot updated to 2.3.5, pigeonhole updated to 0.5.5
+
+* Thu Jan 31 2019 Fedora Release Engineering <releng@fedoraproject.org> - 1:2.3.4-3
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_30_Mass_Rebuild
+
+* Mon Jan 14 2019 Bjrn Esser <besser82@fedoraproject.org> - 1:2.3.4-2
+- Rebuilt for libcrypt.so.2 (#1666033)
+
+* Wed Jan 09 2019 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.4-1
+- dovecot updated to 2.3.4, pigeonhole updated to 0.5.4
+
+* Tue Oct 02 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.3-1
+- dovecot updated to 2.3.3, pigeonhole pdated to 0.5.3
+- doveconf hides more secrets now in the default output
+- NUL bytes in mail headers can cause truncated replies when fetched. 
+- virtual plugin: Some searches used 100% CPU for many seconds 
+- dsync assert-crashed with acl plugin in some situations. 
+- imapc: Fixed various assert-crashes when reconnecting to server. 
+
+
+* Tue Oct 02 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.2.1-4
+- fix dovecot-init service syntax error (#1635017)
+
+* Mon Aug 13 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.2.1-3
+- do not try to generate ssl-params as its obsolete (#1614640)
+
+* Thu Jul 12 2018 Fedora Release Engineering <releng@fedoraproject.org> - 1:2.3.2.1-2
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_29_Mass_Rebuild
+
+* Tue Jul 10 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.2.1-1
+- SSL/TLS servers may have crashed during client disconnection
+
+* Mon Jul 09 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.2-1
+- dovecot updated to 2.3.2, pigeonhole to 0.5.2
+
+* Wed Mar 28 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.1-2
+- fix ftbfs - murmurhash3 check fail
+
+* Wed Mar 28 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.1-1
+- dovecot updated to 2.3.1, pigeonhole updated to 0.5.1
+
+* Tue Mar 27 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.0.1-3
+- use libxcrypt for Fedora >= 28, part of ftbfs fix (#1548520)
+
+* Wed Mar 07 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.0.1-2
+- add gcc buildrequire
+
+* Thu Mar 01 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.3.0.1-1
+- dovecot updated to 2.3.0.1, pigeonhole updated to 0.5.0.1
+
+* Fri Feb 09 2018 Igor Gnatenko <ignatenkobrain@fedoraproject.org> - 1:2.2.33.2-5
+- Escape macros in %%changelog
+
+* Wed Feb 07 2018 Fedora Release Engineering <releng@fedoraproject.org> - 1:2.2.33.2-4
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_28_Mass_Rebuild
+
+* Sat Jan 20 2018 Bjrn Esser <besser82@fedoraproject.org> - 1:2.2.33.2-3
+- Rebuilt for switch to libxcrypt
+
+* Mon Jan 08 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.33.2-2
+- remove tcp_wrappers on Fedora 28 and later (#1518761)
+- use use mariadb-connector-c-devel instead of mysql-devel on Fedora 28 and later (#1493624)
+
+* Tue Oct 24 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.33.2-1
+- dovecot updated to 2.2.33.2
+- doveadm: Fix crash in proxying (or dsync replication) if remote is
+  running older than v2.2.33
+- auth: Fix memory leak in %%{ldap_dn}
+- dict-sql: Fix data types to work correctly with Cassandra
+
+* Wed Oct 18 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.33.1-1
+- dovecot updated to 2.2.33.1, pigeonhole updated to 
+- Added %%{if}, see https://wiki2.dovecot.org/Variables#Conditionals
+- sdbox: Mails were always opened when expunging, unless
+  mail_attachment_fs was explicitly set to empty.
+- lmtp/doveadm proxy: hostip passdb field was ignored, which caused
+  unnecessary DNS lookups if host field wasn't an IP
+- lmtp proxy: Fix crash when receiving unexpected reply in RCPT TO
+- quota_clone: Update also when quota is unlimited (broken in v2.2.31)
+- mbox, zlib: Fix assert-crash when accessing compressed mbox
+- doveadm director kick -f parameter didn't work
+- doveadm director flush <host> resulted flushing all hosts, if <host>
+  wasn't an IP address.
+- director: Various fixes to handling backend/director changes at
+   abnormal times, especially while ring was unsynced.
+- director: Use less CPU in imap-login processes when moving/kicking
+  many users.
+- lmtp: Session IDs were duplicated/confusing with multiple RCPT TOs
+  when lmtp_rcpt_check_quota=yes
+- LDA Sieve plugin: Fixed sequential execution of LDAP-based scripts. A
+  missing LDAP-based script could cause the script sequence to exit earlier.
+- sieve-filter: Removed the (now) duplicate utf8 to mutf7 mailbox name
+  conversion. This caused problems with mailbox names containing UTF-8
+  characters. 
+
+* Mon Aug 28 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.32-2
+- pigeonhole updated to 0.4.20
+- Made the retention period for redirect duplicate identifiers
+  configurable. Changed the default retention period from 24 to 12 hours.
+- sieve-filter: Fixed memory leak: forgot to clean up script binary at
+  end of execution
+- managesieve-login: Fixed handling of AUTHENTICATE command. A second
+  authenticate command would be parsed wrong.
+
+* Fri Aug 25 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.32-1
+- dovecot updated to 2.2.32
+- Modseq tracking didn't always work correctly. This could have caused
+  imap unhibernation to fail or IMAP QRESYNC/CONDSTORE extensions to
+  not work perfectly.
+- mdbox: "Inconsistency in map index" wasn't fixed automatically
+- dict-ldap: %%variable values used in the LDAP filter weren't escaped.
+- quota=count: quota_warning = -storage=.. was never executed (try #2).
+- imapc: >= 32 kB mail bodies were supposed to be cached for subsequent
+  FETCHes, but weren't.
+- quota-status service didn't support recipient_delimiter
+- acl: Don't access dovecot-acl-list files with acl_globals_only=yes
+- mail_location: If INDEX dir is set, mailbox deletion deletes its
+  childrens' indexes. 
+- director: v2.2.31 caused rapid reconnection loops to directors
+  that were down.
+
+* Wed Aug 02 2017 Fedora Release Engineering <releng@fedoraproject.org> - 1:2.2.31-5
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_27_Binutils_Mass_Rebuild
+
+* Wed Jul 26 2017 Fedora Release Engineering <releng@fedoraproject.org> - 1:2.2.31-4
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_27_Mass_Rebuild
+
+* Tue Jul 11 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.31-3
+- enable tcpwrap support (#1450587)
+
+* Tue Jul 04 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.31-2
+- revert commit breaking NOTIFY support
+
+* Tue Jun 27 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.31-1
+- dovecot updated to 2.2.31
+- Various fixes to handling mailbox listing. Especially related to
+  handling nonexistent autocreated/autosubscribed mailboxes and ACLs.
+- Global ACL file was parsed as if it was local ACL file. This caused
+  some of the ACL rule interactions to not work exactly as intended.
+- Using mail_sort_max_read_count may have caused very high CPU usage.
+- Message address parsing could have crashed on invalid input.
+- imapc_features=fetch-headers wasn't always working correctly and
+  caused the full header to be fetched.
+- imapc: Various bugfixes related to connection failure handling.
+- quota=count: quota_warning = -storage=.. was never executed
+- quota=count: Add support for "ns" parameter
+- dsync: Fix incremental syncing for mails that don't have Date or
+  Message-ID headers.
+- imap: Fix hang when client sends pipelined SEARCH +
+  EXPUNGE/CLOSE/LOGOUT.
+- oauth2: Token validation didn't accept empty server responses.
+- imap: NOTIFY command has been almost completely broken since the
+  beginning.
+- pigeonhole updated to 0.4.19
+- Fixed bug in handling of implicit keep in some cases.
+- include extension: Fixed segfault that (sometimes) occurred when the
+  global script location was left unconfigured.
+
+* Wed Jun 07 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.30.2-1
+- dovecot updated to 2.2.30.2
+- auth: Multiple failed authentications within short time caused crashes
+- push-notification: OX driver crashed at deinit
+
+* Thu Jun 01 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.30.1-1
+- dovecot updated to 2.2.30.1
+- More fixes to automatically fix corruption in dovecot.list.index
+- dsync-server: Fix support for dsync_features=empty-header-workaround
+- imapc: Various bugfixes, including infinite loops on some errors
+- IMAP NOTIFY wasn't working for non-INBOX if IMAP client hadn't
+  enabled modseq tracking via CONDSTORE/QRESYNC.
+- fts-lucene: Fix it to work again with mbox format
+- Some internal error messages may have contained garbage in v2.2.29
+- mail-crypt: Re-encrypt when copying/moving mails and per-mailbox keys
+  are used. Otherwise the copied mails can't be opened.
+
+* Wed Apr 12 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.29.1-1
+- dovecot updated to 2.2.29.1
+- dict-sql: Merging multiple UPDATEs to a single statement wasn't
+  actually working.
+- pigeonhole updated to 0.4.18
+- imapsieve plugin: Implemented the copy_source_after rule action. When this
+  is enabled for a mailbox rule, the specified Sieve script is executed for
+  the message in the source mailbox during a "COPY" event. This happens only
+  after the Sieve script that is executed for the corresponding message in the
+  destination mailbox finishes running successfully.
+- imapsieve plugin: Added non-standard Sieve environment items for the source
+  and destination mailbox.
+- multiscript: The execution of the discard script had an implicit "keep",
+  rather than an implicit "discard". 
+
+* Tue Apr 11 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.29-1
+- dovecot updated to 2.2.29
+- fts-tika: Fixed crash when parsing attachment without
+  Content-Disposition header. Broken by 2.2.28.
+- trash plugin was broken in 2.2.28
+- auth: When passdb/userdb lookups were done via auth-workers, too much
+  data was added to auth cache. This could have resulted in wrong
+  replies when using multiple passdbs/userdbs.
+- auth: passdb { skip & mechanisms } were ignored for the first passdb
+- oauth2: Various fixes, including fixes to crashes
+- dsync: Large Sieve scripts (or other large metadata) weren't always
+  synced.
+- Index rebuild (e.g. doveadm force-resync) set all mails as \Recent
+- imap-hibernate: %%{userdb:*} wasn't expanded in mail_log_prefix
+- doveadm: Exit codes weren't preserved when proxying commands via
+  doveadm-server. Almost all errors used exit code 75 (tempfail).
+- ACLs weren't applied to not-yet-existing autocreated mailboxes.
+- Fixed a potential crash when parsing a broken message header.
+- cassandra: Fallback consistency settings weren't working correctly.
+- doveadm director status <user>: "Initial config" was always empty
+- imapc: Various reconnection fixes.
+
+* Mon Feb 27 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.28-1
+- dovecot updated to 2.2.28, pigeonhole to 0.4.17
+- auth: Support OAUTHBEARER and XOAUTH2 mechanisms. Also support them
+  in lib-dsasl for client side.
+- imap: SEARCH/SORT may have assert-crashed in
+  client_check_command_hangs
+- imap: FETCH X-MAILBOX may have assert-crashed in virtual mailboxes.
+- search: Using NOT n:* or NOT UID n:* wasn't handled correctly
+- fts: fts_autoindex_exclude = \Special-use caused crashes
+- doveadm-server: Fix leaks and other problems when process is reused
+  for multiple requests (service_count != 1)
+- sdbox: Fix assert-crash on mailbox create race
+- lda/lmtp: deliver_log_format values weren't entirely correct if Sieve
+  was used. especially %%{storage_id} was broken.
+- imapsieve plugin: Fixed assert failure occurring when used with virtual
+  mailboxes.
+- doveadm sieve plugin: Fixed crash when setting Sieve script via attribute's
+  string value.
+
+* Fri Feb 10 2017 Fedora Release Engineering <releng@fedoraproject.org> - 1:2.2.27-3
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_26_Mass_Rebuild
+
+* Wed Dec 14 2016 Than Ngo <than@redhat.com> - 1:2.2.27-2
+- fixed bz#1403760, big endian issue
+
+* Mon Dec 05 2016 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.27-1
+- Fixed crash in auth process when auth-policy was configured and
+  authentication was aborted/failed without a username set.
+- director: If two users had different tags but the same hash,
+  the users may have been redirected to the wrong tag's hosts.
+- Index files may have been thought incorrectly lost, causing
+  "Missing middle file seq=.." to be logged and index rebuild.
+  This happened more easily with IMAP hibernation enabled.
+- Various fixes to restoring state correctly in un-hibernation.
+- dovecot.index files were commonly 4 bytes per email too large. This
+  is because 3 bytes per email were being wasted that could have been
+  used for IMAP keywords.
+- Various fixes to handle dovecot.list.index corruption better.
+- lib-fts: Fixed assert-crash in address tokenizer with specific input.
+- Fixed assert-crash in HTML to text parsing with specific input
+  (e.g. for FTS indexing or snippet generation)
+- doveadm sync -1: Fixed handling mailbox GUID conflicts.
+- sdbox, mdbox: Perform full index rebuild if corruption is detected
+  inside lib-index, which runs index fsck.
+- quota: Don't skip quota checks when moving mails between different
+  quota roots.
+- search: Multiple sequence sets or UID sets in search parameters
+  weren't handled correctly. They were incorrectly merged together.
+
+* Fri Dec 02 2016 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.26.0-2
+- fix remote crash when auth-policy component is activated (CVE-2016-8652,#1401025)
+
+* Mon Oct 31 2016 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.26.0-1
+- dovecot updated to 2.2.26.0, pigeonhole updated to 0.4.16
+- master process's listener socket was leaked to all child processes.
+  This might have allowed untrusted processes to capture and prevent
+  "doveadm service stop" comands from working.
+- login proxy: Fixed crash when outgoing SSL connections were hanging.
+- auth: userdb fields weren't passed to auth-workers, so %%{userdb:*}
+  from previous userdbs didn't work there.
+- auth: Fixed auth_bind=yes + sasl_bind=yes to work together
+- lmtp: %%{userdb:*} variables didn't work in mail_log_prefix
+- Fixed writing >2GB to iostream-temp files (used by fs-compress,
+  fs-metawrap, doveadm-http)
+- fts-solr: Fixed searching multiple mailboxes
+- and more...
+
+* Mon Jul 04 2016 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.25-1
+- dovecot updated to 2.2.25
+- doveadm backup was sometimes deleting entire mailboxes unnecessarily.
+- doveadm: Command -parameters weren't being sent to doveadm-server.
+- if dovecot.index read failed e.g. because mmap() reached VSZ limit,
+  an empty index could have been opened instead, corrupting the
+  mailbox state.
+- lazy-expunge: Fixed a crash when copying failed. Various other fixes.
+- fts-lucene: Fixed crash on index rescan.
+- dict-ldap: Various fixes
+- dict-sql: NULL values crashed. Now they're treated as "not found".
+
+
+* Wed Apr 27 2016 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.24-1
+- dovecot updated to 2.2.24
+- Huge header lines could have caused Dovecot to use too much memory
+- dsync: Detect and handle invalid/stale -s state string better.
+- dsync: Fixed crash caused by specific mailbox renames
+- auth: Auth cache is now disabled passwd-file. 
+- fts-tika: Don't crash if it returns 500 error
+- dict-redis: Fixed timeout handling
+- SEARCH INTHREAD was crashing
+- stats: Only a single fifo_listeners was supported, making it impossible to
+  use both auth_stats=yes and mail stats plugin.
+- SSL errors were logged in separate "Stacked error" log lines instead of as
+  part of the disconnection reason.
+- MIME body parser didn't handle properly when a child MIME part's --boundary
+  had the same prefix as the parent.
+- pigeonhole updated to 0.4.14
+- extprograms plugin: Fixed epoll() panic caused by closing the output
+  FD before the output stream.
+- Made sure that the local part of a mail address is encoded properly
+  using quoted string syntax when it is not a dot-atom.
+
+* Thu Mar 31 2016 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.23-1
+- dovecot updated to 2.2.23, pigeonhole updated to 0.4.13
+- Various fixes to doveadm. Especially running commands via
+  doveadm-server was broken.
+- director: Fixed user weakness getting stuck in some situations
+- director: Fixed a situation where directors keep re-sending
+  different states to each others and never becoming synced.
+- director: Fixed assert-crash related to a slow "user killed" reply
+- Fixed assert-crash related to istream-concat, which could have
+  been triggered at least by a Sieve script.
+
+* Wed Mar 16 2016 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.22-1
+- dovecot updated to 2.2.22
+- auth: Auth caching was done too aggressively when %%variables were
+  used in default_fields, override_fields or LDAP pass/user_attrs.
+  userdb result_* were also ignored when user was found from cache.
+- imap: Fixed various assert-crashes caused v2.2.20+. Some of them
+  caught actual hangs or otherwise unwanted behavior towards IMAP
+  clients.
+- Expunges were forgotten in some situations, for example when
+  pipelining multiple IMAP MOVE commands.
+- quota: Per-namespaces quota were broken for dict and count backends
+  in v2.2.20+
+- fts-solr: Search queries were using OR instead of AND as the
+  separator for multi-token search queries in v2.2.20+.
+- Single instance storage support wasn't really working in v2.2.16+
+- dbox: POP3 message ordering wasn't working correctly.
+- virtual plugin: Fixed crashes related to backend mailbox deletions.
+
+* Mon Feb 08 2016 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.21-4
+- pigeonhole updated to 0.4.12
+- multiscript: Fixed bug in handling of (implicit) keep; final keep action was
+  always executed as though there was a failure. 
+- managesieve-login: Fixed proxy to allow SASL mechanisms other than PLAIN.
+- ldap storage: Prevent segfault occurring when assigning certain (global)
+  configuration options.
+
+* Wed Feb 03 2016 Fedora Release Engineering <releng@fedoraproject.org> - 1:2.2.21-3
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_24_Mass_Rebuild
+
+* Thu Jan 28 2016 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.21-2
+- pigeonhole updated to 0.4.11
+- Sieve mime extension: Fixed the header :mime :anychild test to work properly
+  outside a foreverypart loop.
+- Fixed assert failure occurring when text extraction is attempted on a
+  empty or broken text part.
+- Fixed assert failure in handling of body parts that are converted to text.
+- Fixed header unfolding for (mime) headers parsed from any mime part.
+- Fixed trimming for (mime) headers parsed from any mime part.
+- Fixed erroneous changes to the message part tree structure performed when
+  re-parsing the message.
+- LDA Sieve plugin: Fixed bug in error handling of script storage initialization
+- Fixed duplication of discard actions in the script result.
+- Made sure that quota errors never get logged as errors in syslog.
+
+* Wed Dec 16 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.21-1
+- dovecot updated to 2.2.21
+- doveadm mailbox list (and some others) were broken in v2.2.20
+- director: Fixed making backend changes when running with only a
+  single director server.
+- virtual plugin: Fixed crash when trying to open nonexistent
+  autocreated backend mailbox.
+- pigeonhole updated to 0.4.10
+- implemented the Sieve mime and foreverypart extensions (RFC 5703).
++ sieve body extension: Properly implemented the `:text' body
+  transform. It now extracts text for HTML message parts.
+- variables extension: Fixed handling of empty string by the `:length'
+  set modifier. An empty string yielded an empty string rather than "0".
+- Fixed memory leak in the Sieve script byte code dumping facility.
+  Extension contexts were never actually freed.
+- doveadm sieve plugin: Fixed crashes caused by incorrect context
+  allocation in the sieve command implementations.
+
+* Tue Dec 08 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.20-2
+- move ssl initialization from %%post to dovecot-init.service
+
+* Tue Dec 08 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.20-1
+- dovecot updated to 2.2.20
+- director: Backend tags weren't working correctly.
+- ldap: tls_* settings weren't used for ldaps URIs.
+- ldap, mysql: Fixed setting connect timeout.
+- auth: userdb lookups via auth-worker couldn't change username
+- dsync: Fixed handling deleted directories. Make sure we don't go to
+  infinite mailbox renaming loop.
+- imap: Fixed crash in NOTIFY when there were watched namespaces that
+  didn't support NOTIFY.
+- imap: After SETMETADATA was used, various commands (especially FETCH)
+  could have started hanging when their output was large.
+- stats: Idle sessions weren't refreshed often enough, causing stats
+  process to forget them and log errors about unknown sessions when
+  they were updated later.
+- stats: Fixed "Duplicate session ID" errors when LMTP delivered to
+  multiple recipients and fts_autoindex=yes.
+- zlib plugin: Fixed copying causing cache corruption when zlib_save
+  wasn't set, but the source message was compressed.
+- fts-solr: Fixed escaping Solr query parameters.
+- lmtp: quota_full_tempfail=yes was ignored with
+  lmtp_rcpt_check_quota=yes
+
+* Mon Oct 05 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.19-1
+- dovecot updated to 2.2.19
+- mdbox: Rebuilding could have caused message's reference count to
+  overflow the 16bit number in some situations, causing problems when
+  trying to expunge the duplicates.
+- Various search fixes (fts, solr, tika, lib-charset, indexer)
+- Various virtual plugin fixes
+- Various fixes and optimizations to dsync, imapc and pop3-migration
+- imap: Various RFC compliancy and crash fixes to NOTIFY
+- pigeonhole updated to 0.4.9
+- ManageSieve: Fixed an assert failure occurring when a client
+  disconnects during the GETSCRIPT command.
+- doveadm sieve plugin: Fixed incorrect initialization (mem leaks) of mail user.
+- sieve-filter command line tool: Fixed handling of failure-related
+  implicit keep when there is an explicit default destination folder.
+- lib-sieve: Fixed bug in RFC5322 header folding.
+
+* Mon Aug 24 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.18-5
+- use the system crypto policy (#1109114)
+
+* Fri Jun 19 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.18-4
+- fix build for s390x and ppc64 (#1232650)
+
+* Wed Jun 17 2015 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1:2.2.18-3
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_23_Mass_Rebuild
+
+* Mon May 18 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.18-2
+- update pigeonhole to 0.4.8
+- Fixed problem in address test: erroneously decoded mime-encoded words in
+  address headers.
+- extprograms plugin: Fixed failure occurring when connecting to script
+  service without the need to read back the output from the external program.
+- Fixed bug in script storage path normalization occurring with relative
+  symbolic links below root.
+
+* Fri May 15 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.18-1
+- director: Login UNIX sockets were normally detected as doveadm or
+  director ring sockets, causing it to break in existing installations.
+- sdbox: When copying a mail in alt storage, place the destination to
+  alt storage as well.
+
+* Thu May 14 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.17-1
+- dovecot updated to 2.2.17
+- pigeonhole updated to 0.4.7
+- auth: If auth_master_user_separator was set, auth process could be
+  crashed by trying to log in with empty master username.
+- imap-login, pop3-login: Fixed crash on handshake failures with new
+  OpenSSL versions (v1.0.2) when SSLv3 was disabled.
+- auth: If one passdb fails allow_nets check, it shouldn't have failed
+  all the other passdb checks later on.
+- imap: Server METADATA couldn't be accessed
+- imapc: Fixed \Muted label handling in gmail-migration.
+- imapc: Various bugfixes and improvements.
+- Trash plugin fixes by Alexei Gradinari
+- mbox: Fixed crash/corruption in some situations
+
+* Tue Apr 28 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.16-2
+- fix CVE-2015-3420: SSL/TLS handshake failures leading to a crash of the login process
+
+* Mon Mar 16 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.16-1
+- dovecot updated to 2.2.16
+- auth: Don't crash if master user login is attempted without
+  any configured master=yes passdbs
+- Parsing UTF-8 text for mails could have caused broken results
+  sometimes if buffering was split in the middle of a UTF-8 character.
+  This affected at least searching messages.
+- String sanitization for some logged output wasn't done properly:
+  UTF-8 text could have been truncated wrongly or the truncation may
+  not have happened at all.
+- fts-lucene: Lookups from virtual mailbox consisting of over 32
+  physical mailboxes could have caused crashes.
+
+* Thu Feb 05 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.15-3
+- fix mbox istream crashes (#1189198, #1186504)
+
+* Mon Jan 05 2015 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.15-2
+- fix crash related to logging BYE notifications (#1176282)
+- update pigeonhole to 0.4.6
+
+* Thu Oct 30 2014 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.15-1
+- dovecot updated to 2.2.15
+- various race condition fixes to LAYOUT=index
+- v2.2.14 virtual plugin crashed in some situations
+
+* Fri Oct 17 2014 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.14-1
+- dovecot updated to 2.2.14, pigeonhole updated to 0.4.3
+- fixed several race conditions with dovecot.index.cache handling that
+  may have caused unnecessary "cache is corrupted" errors.
+- auth: If auth client listed userdb and disconnected before finishing,
+  the auth worker process got stuck
+- imap-login, pop3-login: Fixed potential crashes when client
+  disconnected unexpectedly.
+- imap proxy: The connection was hanging in some usage patterns.
+
+* Thu Aug 21 2014 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.13-4
+- use network-online target instead of just network (#1119814)
+
+* Sat Aug 16 2014 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1:2.2.13-3
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_21_22_Mass_Rebuild
+
+* Sat Jun 07 2014 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1:2.2.13-2
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_21_Mass_Rebuild
+
+* Mon May 12 2014 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.13-1
+- dovecot updated to 2.2.13
+- fixes CVE-2014-3430: denial of service through maxxing out SSL connections
+- pop3 server was still crashing in v2.2.12 
+- maildir: Various fixes and improvements to handling compressed mails
+- fts-lucene, fts-solr: Fixed crash on search when the index contained
+  duplicate entries.
+- mail_attachment_dir: Attachments with the last base64-encoded line
+  longer than the rest wasn't handled correctly.
+- IMAP: SEARCH/SORT PARTIAL was handled completely wrong in v2.2.11+
+- acl: Global ACL file handling was broken when multiple entries
+  matched the mailbox name
+
+* Sun Mar 30 2014 John Morris <john@zultron.com> - 1:2.2.12-2
+- el6 build fixes (#1082384):
+- el6 autoconf too old to regen; use packaged files
+- fix compile error when __global_ldflags macro undefined
+
+* Fri Feb 14 2014 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.12-1
+- dovecot updated to 2.2.12
+- fixes pop3 crash
+
+* Thu Feb 13 2014 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.11-1
+- dovecot updated to 2.2.11
+- imap: SEARCH/SORT PARTIAL reponses may have been too large.
+- doveadm backup: Fixed assert-crash when syncing mailbox deletion.
+
+* Thu Jan 02 2014 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.10-1
+- dovecot updated to 2.2.10
+- quota-status: quota_grace was ignored
+- ldap: Fixed memory leak with auth_bind=yes and without
+  auth_bind_userdn.
+- imap: Don't send HIGHESTMODSEQ anymore on SELECT/EXAMINE when
+  CONDSTORE/QRESYNC has never before been enabled for the mailbox.
+- imap: Fixes to handling mailboxes without permanent modseqs.
+  (When [NOMODSEQ] is returned by SELECT, mainly with in-memory
+  indexes.)
+- imap: Various fixes to METADATA support.
+- stats plugin: Processes that only temporarily dropped privileges
+  (e.g. indexer-worker) may have been logging errors about not being
+  able to open /proc/self/io.
+
+* Mon Nov 25 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.9-1
+- improved cache file handling exposed several old bugs related to fetching 
+  mail headers.
+- iostream handling changes were causing some connections to be disconnected
+  before flushing their output
+
+* Wed Nov 20 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.8-1
+- Fixed infinite loop in message parsing if message ends with
+  "--boundary" and CR (without LF). Messages saved via SMTP/LMTP can't
+  trigger this, because messages must end with an "LF.". A user could
+  trigger this for him/herself though.
+- lmtp: Client was sometimes disconnected before all the output was
+  sent to it.
+- replicator: Database wasn't being exported to disk every 15 minutes
+  as it should have. Instead it was being imported, causing "doveadm
+  replicator remove" commands to not work very well.
+
+* Thu Nov 14 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.7-2
+- fix ostream infinite loop (#1029906)
+
+* Mon Nov 04 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.7-1
+- dovecot updated to 2.2.7
+- master process was doing a hostname.domain lookup for each created
+  process, which may have caused a lot of unnecessary DNS lookups.
+- dsync: Syncing over 100 messages at once caused problems in some
+  situations, causing messages to get new UIDs.
+- fts-solr: Different Solr hosts for different users didn't work.
+
+* Tue Oct 01 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.6-1
+- dovecot updated to 2.2.6, pigeonhole updated to 0.4.2
+- director: v2.2.5 changes caused "SYNC lost" errors
+- dsync: Many fixes and error handling improvements
+- doveadm -A: Don't waste CPU by doing a separate config lookup
+  for each user
+- Long-running ssl-params process no longer prevents Dovecot restart
+- mbox: Fixed mailbox_list_index=yes to work correctly
+
+* Thu Aug 08 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.5-2
+- use unversioned doc dir (#993731)
+
+* Wed Aug 07 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.5-1
+- dovecot updated to 2.2.5
+- added some missing man pages (by Pascal Volk)
+- director: Users near expiration could have been redirected to
+  different servers at the same time.
+- pop3: Avoid assert-crash if client disconnects during LIST.
+- mdbox: Corrupted index header still wasn't automatically fixed.
+- dsync: Various fixes to work better with imapc and pop3c storages.
+- ldap: sasl_bind=yes caused crashes, because Dovecot's lib-sasl
+  symbols conflicted with Cyrus SASL library.
+
+* Tue Jul 30 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.4-3
+- dovecot pigeonhole updated to 0.4.1
+
+* Wed Jul 10 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.4-2
+- fix name conflict with cyrus-sasl (#975869)
+
+* Tue Jun 25 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.4-1
+- dovecot updated to 2.2.4
+- imap/pop3 proxy: Master user logins were broken in v2.2.3
+- sdbox/mdbox: A corrupted index header with wrong size was never
+  automatically fixed in v2.2.3.
+- mbox: Fixed assert-crashes related to locking.
+
+* Mon Jun 17 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.3-1
+- dovecot updated to 2.2.3
+- IMAP: If subject contained only whitespace, Dovecot returned an
+  ENVELOPE reply with a huge literal value, effectively causing the
+  IMAP client to wait for more data forever.
+- IMAP: Various URLAUTH fixes.
+- imapc: Various bugfixes and improvements
+- pop3c: Various fixes to make it work in dsync (without imapc)
+- dsync: Fixes to syncing subscriptions. Fixes to syncing mailbox
+  renames.
+
+* Tue May 21 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.2-2
+- fix location of tmpfiles configuration (#964448)
+
+* Mon May 20 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.2-1
+- dovecot updated to 2.2.2
+- IMAP: Various URLAUTH fixes.
+- IMAP: Fixed a hang with invalid APPEND parameters.
+- IMAP LIST-EXTENDED: INBOX was never listed with \Subscribed flag.
+- mailbox_list_index=yes still caused crashes.
+- maildir: Fixed a crash after dovecot-keywords file was re-read.
+- maildir: If files had reappeared unexpectedly to a Maildir, they
+  were ignored until index files were deleted.
+- Maildir: Fixed handling over 26 keywords in a mailbox. 
+- imap/pop3-login proxying: Fixed a crash if TCP connection succeeded,
+  but the remote login timed out.
+
+* Thu May 16 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.1-4
+- update pigeonhole to 0.4.0
+
+* Mon Apr 29 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.1-3
+- revert last change and use different fix
+
+* Wed Apr 24 2013 Kalev Lember <kalevlember@gmail.com> - 1:2.2.1-2
+- Filter out autogenerated perl deps (#956194)
+
+* Fri Apr 19 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.1-1
+- dovecot updated to 2.2.1
+- mailbox_list_index=yes was broken.
+- LAYOUT=index didn't list subscriptions.
+- auth: Multiple master passdbs didn't work.
+- Message parsing (e.g. during search) crashed when multipart message
+  didn't actually contain any parts.
+- dovecot updated to 2.2.1
+
+* Mon Apr 15 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.0-1
+- dovecot updated to 2.2.0
+- Mailbox list indexes weren't using proper file permissions based
+  on the root directory.
+- replicator: doveadm commands and user list export may have skipped
+  some users.
+- Various fixes to mailbox_list_index=yes
+
+* Fri Apr 05 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2-0.4
+- dovecot updated to 2.2 RC4
+- various bugfixes to LDAP changes in rc3
+
+* Wed Mar 27 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2-0.3
+- dovecot updated to 2.2 RC3
+- Fixed a crash when decoding quoted-printable content.
+- dsync: Various bugfixes
+
+* Thu Feb 28 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2-0.2
+- do not print error when NetworkManager is not installed (#916456)
+
+* Wed Feb 27 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2-0.1
+- major update to dovecot 2.2 RC2
+
+* Mon Feb 11 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.15-1
+- dovecot updated to 2.1.15
+- v2.1.14's dovecot.index.cache fixes caused Dovecot to use more disk I/O
+  and memory than was necessary.
+
+* Tue Feb 05 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.14-2
+- spec clean up
+
+* Thu Jan 31 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.14-1
+- dovecot updated to 2.1.14
+- v2.1.11+ had a race condition where it sometimes overwrote data in
+  dovecot.index.cache file. This could have caused Dovecot to return
+  the same cached data to two different messages.
+- mdbox: Fixes to handling duplicate GUIDs during index rebuild
+
+* Tue Jan 15 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.13-1
+- dovecot updated to 2.1.13
+- Some fixes to cache file changes in v2.1.11.
+- virtual storage: Sorting mailbox by from/to/cc/bcc didn't work.
+
+* Mon Dec 03 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.12-1
+- dovecot updated to 2.1.12
+- lmtp proxy: Fixed hanging if remote server was down.
+- doveadm: Various fixes to handling doveadm-server connections.
+- auth: passdb imap was broken in v2.1.10.
+
+* Thu Nov 08 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.10-3
+- fix network still not ready race condition (#871623)
+
+* Fri Nov 02 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.10-2
+- add reload command to service file
+
+* Wed Sep 19 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.10-1
+- dovecot updated to 2.1.10, pigeonhole updated to 0.3.3
+- director: In some conditions director may have disconnected from
+  another director (without logging about it), thinking it was sending
+  invalid data.
+- imap: Various fixes to listing mailboxes.
+- login processes crashed if there were a lot of local {} or remote {}
+  settings blocks.
+
+* Fri Aug 24 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.9-2
+- use new systemd rpm macros (#851238)
+
+* Thu Aug 02 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.9-1
+- dovecot updated to 2.1.9
+- Full text search indexing might have failed for some messages,
+  always causing indexer-worker process to run out of memory.
+- fts-lucene: Fixed handling SEARCH HEADER FROM/TO/SUBJECT/CC/BCC when
+  the header wasn't lowercased.
+- fts-squat: Fixed crash when searching a virtual mailbox.
+- pop3: Fixed assert crash when doing UIDL on empty mailbox on some
+  setups. 
+- auth: GSSAPI RFC compliancy and error handling fixes.
+- Various fixes related to handling shared namespaces
+
+* Wed Jul 18 2012 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1:2.1.8-3
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_18_Mass_Rebuild
+
+* Tue Jul 03 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.8-2
+- pigeonhole updated to 0.3.1
+- Fixed several small issues, including a few potential segfault bugs, based
+  on static source code analysis.
+
+* Tue Jul 03 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.8-1
+- dovecot updated to 2.1.8
+- imap: Mailbox names were accidentally sent as UTF-8 instead of mUTF-7
+  in previous v2.1.x releases for STATUS, MYRIGHTS and GETQUOTAROOT commands.
+- lmtp proxy: Don't timeout connections too early when mail has a lot of RCPT TOs.
+- director: Don't crash if the director is working alone.
+- shared mailboxes: Avoid doing "@domain" userdb lookups.
+- doveadm: Fixed crash with proxying some commands.
+- fts-squat: Fixed handling multiple SEARCH parameters.
+- imapc: Fixed a crash when message had more than 8 keywords.
+- imapc: Don't crash on APPEND/COPY if server doesn't support UIDPLUS.
+
+
+* Mon Jul 02 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.7-5
+- make quota work with NFS mounted mailboxes
+
+* Fri Jun 22 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.7-4
+- posttrans argument is always zero
+
+* Fri Jun 15 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.7-3
+- do not let dovecot run during upgrade (#134325)
+
+* Wed May 30 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.7-2
+- fix changelog, 2.1.7-1 had copy-pasted upstream changelog, which was wrong
+- director: Don't crash with quickly disconnecting incoming director
+  connections.
+- mdbox: If mail was originally saved to non-INBOX, and namespace
+  prefix is non-empty, don't assert-crash when rebuilding indexes.
+- sdbox: Don't use more fds than necessary when copying mails.
+- auth: Fixed crash with DIGEST-MD5 when attempting to do master user
+  login without master passdbs. 
+- Several fixes to mail_shared_explicit_inbox=no
+- imapc: Use imapc_list_prefix also for listing subscriptions.
+
+* Wed May 30 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.7-1
+- updated to 2.1.7
+- v2.1.5: Using "~/" as mail_location or elsewhere failed to actually
+  expand it to home directory.
+- dbox: Fixed potential assert-crash when reading dbox files.
+- trash plugin: Fixed behavior when quota is already over limit.
+- mail_log plugin: Logging "copy" event didn't work.
+- Proxying to backend server with SSL: Verifying server certificate
+  name always failed, because it was compared to an IP address.
+
+* Wed May 09 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.6-2
+- fix socket activation again, fix in 2.1.6 is incomplete
+
+* Wed May 09 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.6-1
+- v2.1.5: Using "~/" as mail_location or elsewhere failed to actually
+  expand it to home directory.
+- dbox: Fixed potential assert-crash when reading dbox files.
+- trash plugin: Fixed behavior when quota is already over limit.
+- Proxying to backend server with SSL: Verifying server certificate
+  name always failed, because it was compared to an IP address.
+
+* Tue Apr 24 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.5-1
+- IMAP: Several fixes related to mailbox listing in some configs
+- director: A lot of fixes and performance improvements
+- mbox: Deleting a mailbox didn't delete its index files.
+- pop3c: TOP command was sent incorrectly
+- trash plugin didn't work properly
+- LMTP: Don't add a duplicate Return-Path: header when proxying.
+- listescape: Don't unescape namespace prefixes.
+
+* Tue Apr 24 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.4-2
+- close systemd extra sockets that are not configured
+
+* Tue Apr 10 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.4-1
+- dovecot updated to 2.1.4
+- Proxying SSL connections crashed in v2.1.[23]
+- fts-solr: Indexing mail bodies was broken.
+- director: Several changes to significantly improve error handling
+- doveadm import didn't import messages' flags
+- mail_full_filesystem_access=yes was broken
+- Make sure IMAP clients can't create directories when accessing
+  nonexistent users' mailboxes via shared namespace.
+- Dovecot auth clients authenticating via TCP socket could have failed
+  with bogus "PID already in use" errors.
+
+* Mon Mar 19 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.3-1
+- dovecot updated to 2.1.3
+- multi-dbox format in dovecot 2.1.2 was broken
+- temporarily disable check phase until bug #798968 is fixed
+
+* Fri Mar 16 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.2-1
+- dovecot updated to 2.1.2
+- doveadm sync: If mailbox was expunged empty, messages may have
+  become back instead of also being expunged in the other side.
+- imap_id_* settings were ignored before login.
+- Several fixes to mailbox_list_index=yes
+- Previous v2.1.x didn't log all messages at shutdown.
+
+* Thu Mar 01 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.1-2
+- enable fts_lucene plugin (#798661)
+
+* Fri Feb 24 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.1-1
+- dovecot updated to 2.1.1
+- acl plugin + autocreated mailboxes crashed when listing mailboxes
+- doveadm force-resync: Don't skip autocreated mailboxes (especially
+  INBOX). 
+- If process runs out of fds, stop listening for new connections only
+  temporarily, not permanently (avoids hangs with process_limit=1
+  services)
+- auth: passdb imap crashed for non-login authentication (e.g. smtp).
+
+
+* Mon Feb 20 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.0-1
+- updated to 2.1.0 (no major changes since .rc6)
+- include pigeonhole doc files (NEWS, README, ...)
+
+* Tue Feb 14 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.7.rc6
+- updated to 2.1.rc6
+- dbox: Fixed error handling when saving failed or was aborted
+- IMAP: Using COMPRESS extension may have caused assert-crashes
+- IMAP: THREAD REFS sometimes returned invalid (0) nodes.
+- dsync: Fixed handling non-ASCII characters in mailbox names.
+
+* Tue Feb 07 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.6.rc5
+- use PrivateTmp in systemd unit file
+
+* Tue Feb 07 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.5.rc5
+- updated to 2.1.rc5
+- director: With >2 directors ring syncing might have stalled during
+  director connect/disconnect, causing logins to fail.
+- LMTP client/proxy: Fixed potential hanging when sending (big) mails
+- Compressed mails with external attachments (dbox + SIS + zlib) failed
+  sometimes with bogus "cached message size wrong" errors.
+
+* Mon Jan 09 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.4.rc3
+- updated to 2.1.rc3
+- dsync was merged into doveadm
+- added pop3c (= POP3 client) storage backend
+
+* Wed Dec 14 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.3.rc1
+- allow imap+TLS and pop3+TLS by default
+
+* Fri Dec 02 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.2.rc1
+- call systemd reload in postun
+
+* Wed Nov 30 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.1.rc1
+- updated to 2.1.rc1
+- major changes since 2.0.x:
+- plugins now use UTF-8 mailbox names rather than mUTF-7
+- auth_username_format default changed to %%Lu
+- solr full text search backend changed to use mailbox GUIDs instead of
+  mailbox names, requiring reindexing everything
+
+* Mon Nov 21 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.16-1
+- dovecot updated to 2.0.16
+
+* Mon Oct 24 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.15-2
+- do not use obsolete settings in default configuration (#743444)
+
+* Mon Sep 19 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.15-1
+- dovecot updated to 2.0.15
+- v2.0.14: Index reading could have eaten a lot of memory in some
+  situations
+- mbox: Fixed crash during mail delivery when mailbox didn't yet have
+  GUID assigned to it.
+- zlib+mbox: Fetching last message from compressed mailboxes crashed.
+
+* Tue Sep 13 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.14-2
+- do not enable insecure connections by default
+
+* Mon Aug 29 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.14-1
+- dovecot updated to 2.0.14
+- userdb extra fields can now return name+=value to append to an
+  existing name
+- script-login attempted an unnecessary config lookup, which usually
+  failed with "Permission denied".
+- lmtp: Fixed parsing quoted strings with spaces as local-part for
+  MAIL FROM and RCPT TO.
+- imap: FETCH BODY[HEADER.FIELDS (..)] may have crashed or not
+  returned all data sometimes.
+- ldap: Fixed random assert-crashing with with sasl_bind=yes.
+- Fixes to handling mail chroots
+- Fixed renaming mailboxes under different parent with FS layout when
+  using separate ALT, INDEX or CONTROL paths.
+- zlib: Fixed reading concatenated .gz files.
+
+* Fri Jul 15 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.13-2
+- do not include sysv init script
+
+* Thu May 12 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.13-1
+- dovecot updated to 2.0.13
+- mdbox purge: Fixed wrong warning about corrupted extrefs.
+- script-login binary wasn't actually dropping privileges to the
+  user/group/chroot specified by its service settings.
+- Fixed potential crashes and other problems when parsing header names
+  that contained NUL characters.
+
+* Fri Apr 15 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.12-2
+- pigeonhole updated to 0.2.3, which includes:
+- managesieve: fixed bug in UTF-8 checking of string values
+- sieve command line tools now avoid initializing the mail store unless necessary
+- removed header MIME-decoding to fix erroneous address parsing
+- fixed segfault bug in extension configuration, triggered when unknown
+  extension is mentioned in sieve_extensions setting.
+
+* Wed Apr 13 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.12-1
+- dbox: Fixes to handling external attachments
+- dsync: More fixes to avoid hanging with remote syncs
+- dsync: Many other syncing/correctness fixes
+- doveconf: v2.0.10 and v2.0.11 didn't output plugin {} section right
+
+* Mon Mar 28 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.11-5
+- rebuild with new patch
+
+* Mon Mar 28 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.11-4
+- fix regression in config file parsing (#690401)
+
+* Wed Mar 23 2011 Dan Hork <dan@danny.cz> - 1:2.0.11-3
+- rebuilt for mysql 5.5.10 (soname bump in libmysqlclient)
+
+* Wed Mar 23 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.11-2
+- rebuild because of updated dependencies
+
+* Mon Mar 07 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.11-1
+- IMAP: Fixed hangs with COMPRESS extension
+- IMAP: Fixed a hang when trying to COPY to a nonexistent mailbox. 
+- IMAP: Fixed hang/crash with SEARCHRES + pipelining $.
+- IMAP: Fixed assert-crash if IDLE+DONE is sent in same TCP packet.
+
+* Thu Feb 17 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.9-3
+- add missing section to dovecot's systemd service file
+
+* Tue Feb 08 2011 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1:2.0.9-2
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_15_Mass_Rebuild
+
+* Thu Jan 13 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.9-1
+- dovecot updated to 2.0.9
+- fixed a high system CPU usage / high context switch count performance problem
+- lda: Fixed a crash when trying to send "out of quota" reply
+
+* Mon Dec 20 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.8-3
+- add full path and check to restorecon in post
+
+* Tue Dec 07 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.8-2
+- fix s/foobar/dovecot/ typo in post script
+
+* Tue Dec 07 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.8-1
+- dovecot updated to 2.0.8, pigeonhole updated to 0.2.2
+- services' default vsz_limits weren't being enforced correctly
+- added systemd support
+- dbox: Fixes to handling external mail attachments
+- imap, pop3: When service { client_count } was larger than 1, the
+  log messages didn't use the correct prefix
+- MySQL: Only the first specified host was ever used
+
+* Mon Nov 29 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.7-3
+- make it work with /var/run on tmpfs (#656577)
+
+* Tue Nov 23 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.7-2
+- fix regression with  valid_chroot_dirs being ignored (#654083)
+
+* Tue Nov 09 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.7-1
+- dovecot updated to 2.0.7
+- IMAP: Fixed LIST-STATUS when listing subscriptions with subscriptions=no namespaces.
+- IMAP: Fixed SELECT QRESYNC not to crash on mailbox close if a lot of changes were being sent. 
+- quota: Don't count virtual mailboxes in quota
+- doveadm expunge didn't always actually do the physical expunging
+- Fixed some index reading optimizations introduced by v2.0.5.
+- LMTP proxying fixes
+
+* Fri Oct 22 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.6-1
+- dovecot updated to 2.0.6
+- Pre-login CAPABILITY includes IDLE again. Mainly to make Blackberry
+  servers happy.
+- auth: auth_cache_negative_ttl default was 0 in earlier v2.0.x, but it
+  was supposed to be 1 hour as in v1.x. Changed it back to 1h.
+- doveadm: Added import command for importing mails from other storages.
+- Reduced NFS I/O operations for index file accesses
+- dbox, Maildir: When copying messages, copy also already cached fields
+  from dovecot.index.cache
+- Maildir: LDA/LMTP assert-crashed sometimes when saving a mail.
+- Fixed leaking fds when writing to dovecot.mailbox.log.
+- Fixed rare dovecot.index.cache corruption
+- IMAP: SEARCH YOUNGER/OLDER wasn't working correctly
+
+* Mon Oct 04 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.5-1
+- dovecot updated to 2.0.5
+- acl: Fixed the logic of merging multiple ACL entries
+- sdbox: Fixed memory leak when copying messages with hard links. 
+- zlib: Fixed several crashes, which mainly showed up with mbox.
+- quota: Don't crash if user has quota disabled, but plugin loaded.
+- acl: Fixed crashing when sometimes listing shared mailboxes via dict proxy.
+
+* Tue Sep 28 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.4-1
+- dovecot updated to 2.0.4
+- multi-dbox: If :INDEX=path is specified, keep storage/dovecot.map.index* 
+  files also in the index path rather than in the main storage directory.
+- dsync: POP3 UIDLs weren't copied with Maildir
+- dict file: Fixed fd leak (showed up easily with LMTP + quota)
+
+* Mon Sep 20 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.3-1
+- dovecot updated to 2.0.3
+- dovecot-lda: Removed use of non-standard Envelope-To: header as 
+  a default for -a
+- dsync: Fixed handling \Noselect mailboxes
+- Fixed an infinite loop introduced by v2.0.2's message parser changes.
+- Fixed a crash introduced by v2.0.2's istream-crlf changes.
+
+* Thu Sep 16 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.2-1
+- dovecot updated
+- vpopmail support is disabled for now, since it's broken. You can use
+  it via checkpassword support or its sql/ldap database directly.
+- maildir: Fixed "duplicate uidlist entry" errors that happened at
+  least with LMTP when mail was delivered to multiple recipients
+- Deleting ACLs didn't cause entries to be removed from acl_shared_dict
+- mail_max_lock_timeout setting wasn't working with all locks
+
+* Wed Aug 25 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.1-1
+- dovecot and pigeonhole updated
+- sieve: sieved renamed to sieve-dump
+- when dsync is started as root, remote dsync command is now also executed 
+  as root instead of with dropped privileges.
+- IMAP: QRESYNC parameters for SELECT weren't handled correctly.
+- UTF-8 string validity checking wasn't done correctly
+- dsync: Fixed a random assert-crash with remote dsyncing
+
+* Tue Aug 17 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-1
+- dovecot and pigeonhole updated
+- dict quota didn't always decrease quota when messages were expunged
+- Shared INBOX wasn't always listed with FS layout
+
+* Wed Aug 11 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.21.rc5
+- dovecot and pigeonhole updated
+- Using more than 2 plugins could have caused broken behavior
+- Listescape plugin fixes
+- mbox: Fixed a couple of assert-crashes
+- mdbox: Fixed potential assert-crash when saving multiple messages 
+  in one transaction
+
+* Thu Aug 05 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.20.rc4
+- dovecot and pigeonhole updated
+- doveadm mailbox status: Fixed listing non-ASCII mailbox names. 
+- doveadm fetch: Fixed output when fetching message header or body
+- doveadm director map/add/remove: Fixed handling IP address as parameter. 
+- dsync: A few more fixes
+
+* Wed Jul 21 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.19.rc3
+- dovecot and pigeonhole updated
+- fixed lda + sieve crash
+- added mail_temp_dir setting, used by deliver and lmtp for creating
+  temporary mail files. Default is /tmp.
+- imap: Fixed checking if list=children namespace has children.
+- mdbox: Race condition fixes related to copying and purging
+
+* Fri Jul 16 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.18.rc2.20100716
+- dovecot and pigeonhole updated
+- enabled pigeonhole's build time test suite
+- acl: Fixed crashon FS layout with non-default hierarchy separator
+- dbox renamed to sdbox
+- dsync fixes and improvements
+
+* Mon Jul 12 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.17.rc2.20100712
+- dovecot and pigeonhole updated
+- fixed a crash with empty mail_plugins
+- fixed sharing INBOX to other users
+- director+LMTP proxy wasn't working correctly
+- v1.x config parser failed with some settings if pigeonhole wasn't installed.
+- virtual: If non-matching messages weren't expunged within same session,
+  they never got expunged.
+
+* Wed Jul 07 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.16.rc1.20100707
+- updated dovecot and pigeonhole
+- a lot of dsync fixes
+- improved (m)dbox recovery
+
+* Mon Jun 28 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.15.beta6.20100626
+- updated dovecot, pigeonhole and man pages
+- moved disable_plaintext_auth to 10-auth.conf
+- mdbox: Fixed assert-crash on storage rebuild if file got lost
+- lib-charset: Don't assert-crash when iconv() skips lots of invalid input
+- master: Fixed crash on deinit (maybe also on reload)
+
+* Thu Jun 10 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.14.beta5.20100610
+- dovecot updated 
+- lib-storage: Fixed accessing uncommitted saved mails with dsync
+- example-config: Moved ACL and quota settings to a separate .conf files
+- dbox, mdbox: Fixed race conditions when creating mailboxes
+
+* Mon May 31 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.13.beta5.20100529
+- dovecot and pigeonhole updated
+- enable solr fulltext search
+- master: Fixed crash on config reload
+- lib-storage: Don't assert-crash when copying a mail fails
+
+* Tue May 18 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.12.beta5.20100515
+- dovenull is unauthorized user, needs own dovenull group
+
+* Tue May 18 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.11.beta5.20100515
+- fix typo in dovenull username
+
+* Mon May 17 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.9.beta5.20100515
+- pigeonhole and dovecot updated to snapshot 20100515
+- fix crash for THREAD command
+
+* Wed May 05 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.8.beta4.20100505
+- pigeonhole and dovecot updated to snapshot 20100505
+- mdbox: Avoid rebuilding storage if another process already did it
+- lib-storage: Fixed () sublists in IMAP SEARCH parser
+- example-config: auth-checkpassword include wasn't listed in 10-auth.conf
+- doveadm: Added search command
+- lib-master: Don't crash after timeouting an auth-master request
+- master: If inet listener uses DNS name, which returns multiple IPs, 
+  listen in all of them
+
+* Wed Apr 28 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.7.beta4.20100427
+- updated to snapshot 20100427
+- doveconf <setting name> now prints only the one setting's value
+- mdbox: Automatically delete old temp.* files from storage/ directory
+- mdbox: use flock locking by default
+
+* Wed Apr 21 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.6.beta4.20100421
+- updated to snapshot 20100421
+- mdbox: Purge crashed if it purged all messages from a file
+- lib-storage: Shared namespace's prefix_len wasn't updated after prefix was truncated
+- imap-quota: Iterate quota roots only once when replying to GETQUOTAROOT
+- idle: Do cork/uncork when sending "OK Still here" notification
+- login: If proxy returns ssl=yes and no port, switch port to imaps/pop3s
+
+* Wed Apr 14 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.5.beta4.20100414
+- add make check
+- updated to snapshot 20100414
+- config: Added nn- prefix to *.conf files so the sort ordering makes more sense
+- lib-master: Log an error if login client disconnects too early
+- mdbox: If purging found corrupted files, it didn't auto-rebuild storage
+- lib-storage: Added support for searching save date
+- and more...
+- pigeonhole updated:
+- Mailbox extension: fixed memory leak in the mailboxexists test
+- added login failure handler
+
+* Tue Apr 06 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.4.beta4.20100406
+- updated to snapshot 20100406
+- auth: If userdb lookup fails internally, don't cache the result.
+- Added support for userdb lookup to fail with a reason
+- sdbox: mailbox_update() could have changed UIDVALIDITY incorrectly
+- layout=maildir++: Fixed deleting mailboxes with mailbox=file storages
+- Fixed potential problems with parsing invalid address groups.
+- dsync: Don't repeatedly try to keep opening the same failing mailbox
+- lib-storage: Don't crash if root mail directory isn't given.
+
+* Tue Mar 30 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.3.beta4.20100330
+- fix certs location in ssl.conf
+
+* Mon Mar 29 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.2.beta4.aefa279e2c70
+- update to snapshot aefa279e2c70 from 2010-03-27
+- fixes complains about missing tcpwrap (#577426)
+
+* Thu Mar 25 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.1.beta4
+- dovecot updated to 2.0 beta 4
+
+* Fri Mar 12 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.11-2
+- fix missing bzip2 support in zlib plugin (#572797)
+
+* Tue Mar 09 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.11-1
+- updated to 1.2.11
+- mbox: Message header reading was unnecessarily slow. Fetching a
+  huge header could have resulted in Dovecot eating a lot of CPU.
+  Also searching messages was much slower than necessary.
+- maildir: Reading uidlist could have ended up in an infinite loop.
+- IMAP IDLE: v1.2.7+ caused extra load by checking changes every
+  0.5 seconds after a change had occurred in mailbox
+
+* Tue Feb 23 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.10-4
+- move libs to correct package
+
+* Fri Feb 19 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.10-3
+- merged dovecot-sieve and dovecot-managesieve into dovecot-pigeonhole
+- merged dovecot-sqlite, dovecot-gssapi and dovecot-ldap into dovecot
+
+* Mon Jan 25 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.10-2
+- updated sive and managesieve
+- Added preliminary support for Sieve plugins and added support for
+  installing Sieve development headers
+- Variables extension: added support for variable namespaces.
+- Added configurable script size limit. Compiler will refuse to
+  compile files larger than sieve_max_script_size.
+- Fixed a bug in the i;ascii-numeric comparator. If one of the
+  strings started with a non-digit character, the comparator would
+  always yield less-than.
+- Imap4flags extension: fixed bug in removeflag: removing a single
+  flag failed due to off-by-one error (bug report by Julian Cowley).
+- Fixed parser recovery. In particular cases it would trigger spurious
+  errors after an initial valid error and sometimes additional errors
+  were inappropriately ignored.
+- Implemented ManageSieve QUOTA enforcement.
+- Added MAXREDIRECTS capability after login.
+- Implemented new script name rules specified in most recent
+  ManageSieve draft.
+- Fixed assertion failure occuring with challenge-response SASL
+  mechanisms.
+
+* Mon Jan 25 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.10-1
+- updated to 1.2.10
+- %%variables now support %%{host}, %%{pid} and %%{env:ENVIRONMENT_NAME}
+  everywhere.
+- LIST-STATUS capability is now advertised
+- maildir: Fixed several assert-crashes.
+- imap: LIST "" inbox shouldn't crash when using namespace with
+  "INBOX." prefix.
+- lazy_expunge now ignores non-private namespaces.
+
+* Tue Dec 22 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.9-2
+- sieve updated to 0.1.14
+- managesieve updated to 0.11.10 
+
+* Fri Dec 18 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.9-1
+- updated to 1.2.9
+- maildir: When saving, filenames now always contain ,S=<size>.
+  Previously this was done only when quota plugin was loaded. It's
+  required for zlib plugin and may be useful for other things too.
+- maildir: v1.2.7 and v1.2.8 caused assert-crashes in
+  maildir_uidlist_records_drop_expunges()
+- maildir_copy_preserve_filename=yes could have caused crashes.
+- Maildir++ quota: % limits weren't updated when limits were read
+  from maildirsize.
+- virtual: v1.2.8 didn't fully fix the "lots of mailboxes" bug
+- virtual: Fixed updating virtual mailbox based on flag changes.
+- fts-squat: Fixed searching multi-byte characters.
+
+* Wed Nov 25 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.8-4
+- spec cleanup
+
+* Tue Nov 24 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.8-3
+- fix dovecot's restart after update (#518753)
+
+* Tue Nov 24 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.8-2
+- fix initdddir typo (for rhel rebuilds)
+
+* Fri Nov 20 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.8-1
+- update to dovecot 1.2.8
+
+* Mon Nov 16 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.7-2
+- use originall managesieve to dovecot diff
+- EPEL-ize spec for rhel5 rebuilds (#537666)
+
+* Fri Nov 13 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.7-1
+- updated to dovecot 1.2.7
+- add man pages
+- IMAP: IDLE now sends "Still here" notifications to same user's
+  connections at the same time. This hopefully reduces power usage
+  of some mobile clients that use multiple IDLEing connections.
+- IMAP: If imap_capability is set, show it in the login banner.
+- IMAP: Implemented SORT=DISPLAY extension.
+- Login process creation could have sometimes failed with epoll_ctl()
+  errors or without epoll probably some other strange things could
+  have happened.
+- Maildir: Fixed some performance issues
+- Maildir: Fixed crash when using a lot of keywords.
+- Several fixes to QRESYNC extension and modseq handling
+- mbox: Make sure failed saves get rolled back with NFS.
+- dbox: Several fixes.
+
+* Mon Nov 02 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.6-5
+- spec cleanup
+
+* Wed Oct 21 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.6-4
+- imap-login: If imap_capability is set, show it in the banner 
+  instead of the default (#524485)
+
+* Mon Oct 19 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.6-3
+- sieve updated to 0.1.13 which brings these changes:
+- Body extension: implemented proper handling of the :raw transform
+  and added various new tests to the test suite. However, :content
+  "multipart" and :content "message/rfc822" are still not working.
+- Fixed race condition occuring when multiple instances are saving the
+  same binary (patch by Timo Sirainen).
+- Body extension: don't give SKIP_BODY_BLOCK flag to message parser,
+  we want the body!
+- Fixed bugs in multiscript support; subsequent keep actions were not
+  always merged correctly and implicit side effects were not always
+  handled correctly.
+- Fixed a segfault bug in the sieve-test tool occuring when compile
+  fails.
+- Fixed segfault bug in action procesing. It was triggered while
+  merging side effects in duplicate actions.
+- Fixed bug in the Sieve plugin that caused it to try to stat() a NULL
+  path, yielding a 'Bad address' error.
+
+* Fri Oct 09 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.6-2
+- fix init script for case when no action was specified
+
+* Tue Oct 06 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.6-1
+- dovecot updated to 1.2.6
+- Added authtest utility for doing passdb and userdb lookups.
+- login: ssl_security string now also shows the used compression.
+- quota: Don't crash with non-Maildir++ quota backend.
+- imap proxy: Fixed crashing with some specific password characters.
+- fixed broken dovecot --exec-mail.
+- Avoid assert-crashing when two processes try to create index at the
+  same time.
+
+* Tue Sep 29 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.5-2
+- build with libcap enabled
+
+* Thu Sep 17 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.5-1
+- updated to dovecot 1.2.5
+- Authentication: DIGEST-MD5 and RPA mechanisms no longer require
+  user's login realm to be listed in auth_realms. It only made
+  configuration more difficult without really providing extra security.
+- zlib plugin: Don't allow clients to save compressed data directly.
+  This prevents users from exploiting (most of the) potential security
+  holes in zlib/bzlib.
+- fix index file handling that could have caused an assert-crash
+- IMAP: Fixes to QRESYNC extension.
+- deliver: Don't send rejects to any messages that have Auto-Submitted
+  header. This avoids emails loops.
+
+* Wed Sep 16 2009 Tomas Mraz <tmraz@redhat.com> - 1:1.2.4-3
+- use password-auth common PAM configuration instead of system-auth
+
+* Fri Aug 21 2009 Tomas Mraz <tmraz@redhat.com> - 1:1.2.4-2
+- rebuilt with new openssl
+
+* Fri Aug 21 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.4-1
+- updated: dovecot 1.2.4, managesieve 0.11.9, sieve 0.1.12
+- fixed a crash in index file handling
+- fixed a crash in saving messages where message contained a CR
+  character that wasn't followed by LF
+- fixed a crash when listing shared namespace prefix
+- sieve: implemented the new date extension. This allows matching
+  against date values in header fields and the current date at
+  the time of script evaluation
+- managesieve: reintroduced ability to abort SASL with "*" response
+
+* Mon Aug 10 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.3-1
+- updated: dovecot 1.2.3, managesieve 0.11.8, sieve 0.1.11
+- Mailbox names with control characters can't be created anymore.
+  Existing mailboxes can still be accessed though.
+- Allow namespace prefix to be opened as mailbox, if a mailbox
+  already exists in the root dir.
+- Maildir: dovecot-uidlist was being recreated every time a mailbox
+  was accessed, even if nothing changed.
+- listescape plugin was somewhat broken
+- ldap: Fixed hang when >128 requests were sent at once.
+- fts_squat: Fixed crashing when searching virtual mailbox.
+- imap: Fixed THREAD .. INTHREAD crashing.
+
+* Tue Jul 28 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.2-1.20090728snap
+- updated to post 1.2.2 snapshot (including post release GSSAPI fix)
+- Fixed "corrupted index cache file" errors
+- IMAP: FETCH X-* parameters weren't working.
+- Maildir++ quota: Quota was sometimes updated wrong
+- Dovecot master process could hang if it received signals too rapidly
+
+* Fri Jul 24 2009 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1:1.2.1-3
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_12_Mass_Rebuild
+
+* Thu Jul 23 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.1-2
+- updated sieve plugin to 0.1.9
+
+* Mon Jul 13 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.1-1
+- updated to 1.2.1
+- GSSAPI authentication is fixed (#506782)
+- logins now fail if home directory path is relative, because it was 
+  not working correctly and never was expected to work
+- sieve and managesieve update
+
+* Mon Apr 20 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2-0.rc3.1
+- updated to 1.2.rc3
+
+* Mon Apr 06 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2-0.rc2.1
+- updated to 1.2.rc2
+
+* Mon Mar 30 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2-0.beta4.2
+- fix typo and rebuild
+
+* Mon Mar 30 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2-0.beta4.1
+- spec clean-up
+- updated to 1.2.beta4
+
+* Tue Feb 24 2009 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1:1.1.11-2
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_11_Mass_Rebuild
+
+* Wed Feb 11 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.11-1
+- updated to 1.1.11
+- IMAP: PERMANENTFLAGS list didn't contain \*, causing some clients
+  not to save keywords.
+- auth: Using "username" or "domain" passdb fields caused problems
+  with cache and blocking passdbs in v1.1.8 .. v1.1.10.   
+- userdb prefetch + blocking passdbs was broken with non-plaintext
+  auth in v1.1.8 .. v1.1.10.
+
+* Tue Jan 27 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.10-1
+- updated to 1.1.10
+
+* Sat Jan 24 2009 Dan Horak <dan[at]danny.cz> - 1:1.1.8-3
+- rebuild with new mysql
+
+* Tue Jan 13 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.8-2
+- added managesieve support (thanks Helmut K. C. Tessarek)
+
+* Thu Jan 8 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.8-1
+- dovecot updated to 1.1.8
+- sieve-plugin updated to 1.1.6
+
+* Tue Dec 2 2008 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.7-2
+- revert changes from 1:1.1.6-2 and 1:1.1.6-1
+- password can be stored in different file readable only for root 
+  via !include_try directive
+
+* Tue Dec 2 2008 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.7-1
+- update to upstream version 1.1.7
+
+* Mon Nov 3 2008 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.6-2
+- changed comment in sysconfig to match actual state
+
+* Mon Nov 3 2008 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.6-1
+- update to upstream version 1.1.6
+- change permissions of deliver and dovecot.conf to prevent possible password exposure
+
+* Wed Oct 29 2008 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.5-1
+- update to upstream version 1.1.5 (Resolves: CVE-2008-4577, CVE-2008-4578)
+
+* Tue Sep  2 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.3-1
+- update to upstream version 1.1.3
+
+* Tue Jul 29 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.2-2
+- really ask for the password during start-up
+
+* Tue Jul 29 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.2-1
+- update to upstream version 1.1.2
+- final solution for #445200 (add /etc/sysconfig/dovecot for start-up options)
+
+* Fri Jun 27 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.1-2
+- update default settings to listen on both IPv4 and IPv6 instead of IPv6 only
+
+* Sun Jun 22 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.1-1
+- update to upstream version 1.1.1
+
+* Sat Jun 21 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.0-1
+- update to upstream version 1.1.0
+- update sieve plugin to 1.1.5
+- remove unnecessary patches
+- enable ldap and gssapi plugins
+- change ownership of dovecot.conf (Resolves: #452088)
+
+* Wed Jun 18 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.14-4
+- update init script (Resolves: #451838)
+
+* Fri Jun  6 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.14-3
+- build devel subpackage (Resolves: #306881)
+
+* Thu Jun  5 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.14-2
+- install convert-tool (Resolves: #450010)
+
+* Tue Jun  3 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.14-1
+- update to upstream version 1.0.14
+- remove setcred patch (use of setcred must be explictly enabled in config)
+
+* Thu May 29 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.13-8
+- update scriptlets to follow UsersAndGroups guideline
+- remove support for upgrading from version < 1.0 from scriptlets
+- Resolves: #448095
+
+* Tue May 20 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.13-7
+- spec file cleanup
+- update sieve plugin to 1.0.3
+- Resolves: #445200, #238018
+
+* Sun Mar 09 2008 Tomas Janousek <tjanouse@redhat.com> - 1:1.0.13-6
+- update to latest upstream stable (1.0.13)
+
+* Wed Feb 20 2008 Fedora Release Engineering <rel-eng@fedoraproject.org> - 1:1.0.10-5
+- Autorebuild for GCC 4.3
+
+* Mon Jan 07 2008 Tomas Janousek <tjanouse@redhat.com> - 1:1.0.10-4
+- update to latest upstream stable (1.0.10)
+
+* Wed Dec 05 2007 Jesse Keating <jkeating@redhat.com> - 1:1.0.7-3
+- Bump for deps
+
+* Mon Nov 05 2007 Tomas Janousek <tjanouse@redhat.com> - 1:1.0.7-2
+- update to latest upstream stable (1.0.7)
+- added the winbind patch (#286351)
+
+* Tue Sep 25 2007 Tomas Janousek <tjanouse@redhat.com> - 1:1.0.5-1
+- downgraded to lastest upstream stable (1.0.5)
+
+* Wed Aug 22 2007 Tomas Janousek <tjanouse@redhat.com> - 1.1-16.1.alpha3
+- updated license tags
+
+* Mon Aug 13 2007 Tomas Janousek <tjanouse@redhat.com> - 1.1-16.alpha3
+- updated to latest upstream alpha
+- update dovecot-sieve to 0367450c9382 from hg
+
+* Fri Aug 10 2007 Tomas Janousek <tjanouse@redhat.com> - 1.1-15.alpha2
+- updated to latest upstream alpha
+- split ldap and gssapi plugins to subpackages
+
+* Wed Jul 25 2007 Tomas Janousek <tjanouse@redhat.com> - 1.1-14.6.hg.a744ae38a9e1
+- update to a744ae38a9e1 from hg
+- update dovecot-sieve to 131e25f6862b from hg and enable it again
+
+* Thu Jul 19 2007 Tomas Janousek <tjanouse@redhat.com> - 1.1-14.5.alpha1
+- update to latest upstream alpha
+- don't build dovecot-sieve, it's only for 1.0
+
+* Sun Jul 15 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0.2-13.5
+- update to latest upstream
+
+* Mon Jun 18 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0.1-12.5
+- update to latest upstream
+
+* Fri Jun 08 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0.0-11.7
+- specfile merge from 145241 branch
+    - new sql split patch
+    - support for not building all sql modules
+    - split sql libraries to separate packages
+
+* Sat Apr 14 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0.0-11.1
+- dovecot-1.0.beta2-pam-tty.patch is no longer needed
+
+* Fri Apr 13 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0.0-11
+- update to latest upstream
+
+* Tue Apr 10 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-10.rc31
+- update to latest upstream
+
+* Fri Apr 06 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-9.rc30
+- update to latest upstream
+
+* Fri Mar 30 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-8.1.rc28
+- spec file cleanup (fixes docs path)
+
+* Fri Mar 23 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-8.rc28
+- update to latest upstream
+
+* Mon Mar 19 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-7.rc27
+- use dovecot-sieve's version for the package
+
+* Mon Mar 19 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-6.rc27
+- update to latest upstream
+- added dovecot-sieve
+
+* Fri Mar 02 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-5.rc25
+- update to latest upstream
+
+* Sun Feb 25 2007 Jef Spaleta <jspaleta@gmail.com> - 1.0-4.rc22
+- Merge review changes
+
+* Thu Feb 08 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-3.rc22
+- update to latest upstream, fixes a few bugs
+
+* Mon Jan 08 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-2.rc17
+- update to latest upstream, fixes a few bugs
+
+* Thu Dec 21 2006 Tomas Janousek <tjanouse@redhat.com> - 1.0-1.1.rc15
+- reenabled GSSAPI (#220377)
+
+* Tue Dec 05 2006 Tomas Janousek <tjanouse@redhat.com> - 1.0-1.rc15
+- update to latest upstream, fixes a few bugs, plus a security
+  vulnerability (#216508, CVE-2006-5973)
+
+* Tue Oct 10 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.3.rc7
+- fix few inconsistencies in specfile, fixes #198940
+
+* Wed Oct 04 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.2.rc7
+- fix default paths in the example mkcert.sh to match configuration
+  defaults (fixes #183151)
+
+* Sun Oct 01 2006 Jesse Keating <jkeating@redhat.com> - 1.0-0.1.rc7
+- rebuilt for unwind info generation, broken in gcc-4.1.1-21
+
+* Fri Sep 22 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.rc7
+- update to latest upstream release candidate, should fix occasional
+  hangs and mbox issues... INBOX. namespace is still broken though
+- do not run over symlinked certificates in new locations on upgrade
+
+* Tue Aug 15 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.rc2.2
+- include /var/lib/dovecot in the package, prevents startup failure
+  on new installs
+
+* Mon Jul 17 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.rc2.1
+- reenable inotify and see what happens
+
+* Thu Jul 13 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.rc2
+- update to latest upstream release candidate
+- disable inotify for now, doesn't build -- this needs fixing though
+
+* Wed Jul 12 2006 Jesse Keating <jkeating@redhat.com> - 1.0-0.beta8.2.1
+- rebuild
+
+* Thu Jun 08 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta8.2
+- put back pop3_uidl_format default that got lost
+  in the beta2->beta7 upgrade (would cause pop3 to not work
+  at all in many situations)
+
+* Thu May 04 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta8.1
+- upgrade to latest upstream beta release (beta8)
+- contains a security fix in mbox handling
+
+* Thu May 04 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta7.1
+- upgrade to latest upstream beta release
+- fixed BR 173048
+
+* Fri Mar 17 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.8
+- fix sqlite detection in upstream configure checks, second part
+  of #182240
+
+* Wed Mar  8 2006 Bill Nottingham <notting@redhat.com> - 1.0-0.beta2.7
+- fix scriplet noise some more
+
+* Mon Mar  6 2006 Jeremy Katz <katzj@redhat.com> - 1.0-0.beta2.6
+- fix scriptlet error (mitr, #184151)
+
+* Mon Feb 27 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.5
+- fix #182240 by looking in lib64 for libs first and then lib
+- fix comment #1 in #182240 by copying over the example config files
+  to documentation directory
+
+* Fri Feb 10 2006 Jesse Keating <jkeating@redhat.com> - 1.0-0.beta2.4.1
+- bump again for double-long bug on ppc(64)
+
+* Thu Feb 09 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.4
+- enable inotify as it should work now (#179431)
+
+* Tue Feb 07 2006 Jesse Keating <jkeating@redhat.com> - 1.0-0.beta2.3.1
+- rebuilt for new gcc4.1 snapshot and glibc changes
+
+* Thu Feb 02 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.3
+- change the compiled-in defaults and adjust the default's configfile
+  commented-out example settings to match compiled-in defaults,
+  instead of changing the defaults only in the configfile, as per #179432
+- fix #179574 by providing a default uidl_format for pop3
+- half-fix #179620 by having plaintext auth enabled by default... this
+  needs more thinking (which one we really want) and documentation
+  either way
+
+* Tue Jan 31 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.2
+- update URL in description
+- call dovecot --build-ssl-parameters in postinst as per #179430
+
+* Mon Jan 30 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.1
+- fix spec to work with BUILD_DIR != SOURCE_DIR
+- forward-port and split pam-nocred patch
+
+* Mon Jan 23 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2
+- new upstream version, hopefully fixes #173928, #163550
+- fix #168866, use install -p to install documentation
+
+* Fri Dec 09 2005 Jesse Keating <jkeating@redhat.com>
+- rebuilt
+
+* Sat Nov 12 2005 Tom Lane <tgl@redhat.com> - 0.99.14-10.fc5
+- Rebuild due to mysql update.
+
+* Wed Nov  9 2005 Tomas Mraz <tmraz@redhat.com> - 0.99.14-9.fc5
+- rebuilt with new openssl
+
+* Fri Sep 30 2005 Tomas Mraz <tmraz@redhat.com> - 0.99.14-8.fc5
+- use include instead of pam_stack in pam config
+
+* Wed Jul 27 2005 John Dennis <jdennis@redhat.com> - 0.99.14-7.fc5
+- fix bug #150888, log authenication failures with ip address
+
+* Fri Jul 22 2005 John Dennis <jdennis@redhat.com> - 0.99.14-6.fc5
+- fix bug #149673, add dummy PAM_TTY
+
+* Thu Apr 28 2005 John Dennis <jdennis@redhat.com> - 0.99.14-5.fc4
+- fix bug #156159 insecure location of restart flag file
+
+* Fri Apr 22 2005 John Dennis <jdennis@redhat.com> - 0.99.14-4.fc4
+- openssl moved its certs, CA, etc. from /usr/share/ssl to /etc/pki
+
+* Tue Apr 12 2005 Tom Lane <tgl@redhat.com> 0.99.14-3.fc4
+- Rebuild for Postgres 8.0.2 (new libpq major version).
+
+* Mon Mar  7 2005 John Dennis <jdennis@redhat.com> 0.99.14-2.fc4
+- bump rev for gcc4 build
+
+* Mon Feb 14 2005 John Dennis <jdennis@redhat.com> - 0.99.14-1.fc4
+- fix bug #147874, update to 0.99.14 release
+  v0.99.14 2005-02-11  Timo Sirainen <tss at iki.fi>
+  - Message address fields are now parsed differently, fixing some
+    issues with spaces. Affects only clients which use FETCH ENVELOPE
+    command.
+  - Message MIME parser was somewhat broken with missing MIME boundaries
+  - mbox: Don't allow X-UID headers in mails to override the UIDs we
+    would otherwise set. Too large values can break some clients and
+    cause other trouble.
+  - passwd-file userdb wasn't working
+  - PAM crashed with 64bit systems
+  - non-SSL inetd startup wasn't working
+  - If UID FETCH notices and skips an expunged message, don't return
+    a NO reply. It's not needed and only makes clients give error
+    messages.
+
+* Wed Feb  2 2005 John Dennis <jdennis@redhat.com> - 0.99.13-4.devel
+- fix bug #146198, clean up temp kerberos tickets
+
+* Mon Jan 17 2005 John Dennis <jdennis@redhat.com> 0.99.13-3.devel
+- fix bug #145214, force mbox_locks to fcntl only
+- fix bug #145241, remove prereq on postgres and mysql, allow rpm auto
+  dependency generator to pick up client lib dependency if needed.
+
+* Thu Jan 13 2005 John Dennis <jdennis@redhat.com> 0.99.13-2.devel
+- make postgres & mysql conditional build
+- remove execute bit on migration example scripts so rpm does not pull
+  in additional dependences on perl and perl modules that are not present
+  in dovecot proper.
+- add REDHAT-FAQ.txt to doc directory
+
+* Thu Jan  6 2005 John Dennis <jdennis@redhat.com> 0.99.13-1.devel
+- bring up to date with latest upstream, 0.99.13, bug #143707
+  also fix bug #14462, bad dovecot-uid macro name
+
+* Thu Jan  6 2005 John Dennis <jdennis@redhat.com> 0.99.11-10.devel
+- fix bug #133618, removed LITERAL+ capability from capability string
+
+* Wed Jan  5 2005 John Dennis <jdennis@redhat.com> 0.99.11-9.devel
+- fix bug #134325, stop dovecot during installation
+
+* Wed Jan  5 2005 John Dennis <jdennis@redhat.com> 0.99.11-8.devel
+- fix bug #129539, dovecot starts too early,
+  set chkconfig to 65 35 to match cyrus-imapd
+- also delete some old commented out code from SSL certificate creation
+
+* Thu Dec 23 2004 John Dennis <jdennis@redhat.com> 0.99.11-7.devel
+- add UW to Dovecot migration documentation and scripts, bug #139954
+  fix SSL documentation and scripts, add missing documentation, bug #139276
+
+* Mon Nov 15 2004 Warren Togami <wtogami@redhat.com> 0.99.11-2.FC4.1
+- rebuild against MySQL4
+
+* Thu Oct 21 2004 John Dennis <jdennis@redhat.com>
+- fix bug #136623
+  Change License field from GPL to LGPL to reflect actual license
+
+* Thu Sep 30 2004 John Dennis <jdennis@redhat.com> 0.99.11-1.FC3.3
+- fix bug #124786, listen to ipv6 as well as ipv4
+
+* Wed Sep  8 2004 John Dennis <jdennis@redhat.com> 0.99.11-1.FC3.1
+- bring up to latest upstream,
+  comments from Timo Sirainen <tss at iki.fi> on release v0.99.11 2004-09-04  
+  + 127.* and ::1 IP addresses are treated as secured with
+    disable_plaintext_auth = yes
+  + auth_debug setting for extra authentication debugging
+  + Some documentation and error message updates
+  + Create PID file in /var/run/dovecot/master.pid
+  + home setting is now optional in static userdb
+  + Added mail setting to static userdb
+  - After APPENDing to selected mailbox Dovecot didn't always notice the
+    new mail immediately which broke some clients
+  - THREAD and SORT commands crashed with some mails
+  - If APPENDed mail ended with CR character, Dovecot aborted the saving
+  - Output streams sometimes sent data duplicated and lost part of it.
+    This could have caused various strange problems, but looks like in
+    practise it rarely caused real problems.
+
+* Wed Aug  4 2004 John Dennis <jdennis@redhat.com>
+- change release field separator from comma to dot, bump build number
+
+* Mon Aug  2 2004 John Dennis <jdennis@redhat.com> 0.99.10.9-1,FC3,1
+- bring up to date with latest upstream, fixes include:
+- LDAP support compiles now with Solaris LDAP library
+- IMAP BODY and BODYSTRUCTURE replies were wrong for MIME parts which
+  didn't contain Content-Type header.
+- MySQL and PostgreSQL auth didn't reconnect if connection was lost
+  to SQL server
+- Linking fixes for dovecot-auth with some systems
+- Last fix for disconnecting client when downloading mail longer than
+  30 seconds actually made it never disconnect client. Now it works
+  properly: disconnect when client hasn't read _any_ data for 30
+  seconds.
+- MySQL compiling got broken in last release
+- More PostgreSQL reconnection fixing
+
+
+* Mon Jul 26 2004 John Dennis <jdennis@redhat.com> 0.99.10.7-1,FC3,1
+- enable postgres and mySQL in build
+- fix configure to look for mysql in alternate locations
+- nuke configure script in tar file, recreate from configure.in using autoconf
+
+- bring up to latest upstream, which included:
+- Added outlook-pop3-no-nuls workaround to fix Outlook hang in mails with NULs.
+- Config file lines can now contain quoted strings ("value ")
+- If client didn't finish downloading a single mail in 30 seconds,
+  Dovecot closed the connection. This was supposed to work so that
+  if client hasn't read data at all in 30 seconds, it's disconnected.
+- Maildir: LIST now doesn't skip symlinks
+
+
+* Wed Jun 30 2004 John Dennis <jdennis@redhat.com>
+- bump rev for build
+- change rev for FC3 build
+
+* Fri Jun 25 2004 John Dennis <jdennis@redhat.com> - 0.99.10.6-1
+- bring up to date with upstream,
+  recent change log comments from Timo Sirainen were:
+  SHA1 password support using OpenSSL crypto library
+  mail_extra_groups setting
+  maildir_stat_dirs setting
+  Added NAMESPACE capability and command
+  Autocreate missing maildirs (instead of crashing)
+  Fixed occational crash in maildir synchronization
+  Fixed occational assertion crash in ioloop.c
+  Fixed FreeBSD compiling issue
+  Fixed issues with 64bit Solaris binary
+
+* Tue Jun 15 2004 Elliot Lee <sopwith@redhat.com>
+- rebuilt
+
+* Thu May 27 2004 David Woodhouse <dwmw2@redhat.com> 0.99.10.5-1
+- Update to 0.99.10.5 to fix maildir segfaults (#123022)
+
+* Fri May 07 2004 Warren Togami <wtogami@redhat.com> 0.99.10.4-4
+- default auth config that is actually usable
+- Timo Sirainen (author) suggested functionality fixes
+  maildir, imap-fetch-body-section, customflags-fix
+
+* Mon Feb 23 2004 Tim Waugh <twaugh@redhat.com>
+- Use ':' instead of '.' as separator for chown.
+
+* Tue Feb 17 2004 Jeremy Katz <katzj@redhat.com> - 0.99.10.4-3
+- restart properly if it dies (#115594)
+
+* Fri Feb 13 2004 Elliot Lee <sopwith@redhat.com>
+- rebuilt
+
+* Mon Nov 24 2003 Jeremy Katz <katzj@redhat.com> 0.99.10.4-1
+- update to 0.99.10.4
+
+* Mon Oct  6 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-7
+- another patch from upstream to fix returning invalid data on partial 
+  BODY[part] fetches
+- patch to avoid confusion of draft/deleted in indexes
+
+* Tue Sep 23 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-6
+- add some patches from upstream (#104288)
+
+* Thu Sep  4 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-5
+- fix startup with 2.6 with patch from upstream (#103801)
+
+* Tue Sep  2 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-4
+- fix assert in search code (#103383)
+
+* Tue Jul 22 2003 Nalin Dahyabhai <nalin@redhat.com> 0.99.10-3
+- rebuild
+
+* Thu Jul 17 2003 Bill Nottingham <notting@redhat.com> 0.99.10-2
+- don't run by default
+
+* Thu Jun 26 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-1
+- 0.99.10
+
+* Mon Jun 23 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-0.2
+- 0.99.10-rc2 (includes ssl detection fix)
+- a few tweaks from fedora
+  - noreplace the config file
+  - configure --with-ldap to get LDAP enabled
+
+* Mon Jun 23 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-0.1
+- 0.99.10-rc1
+- add fix for ssl detection
+- add zlib-devel to BuildRequires
+- change pam service name to dovecot
+- include pam config
+
+* Thu May  8 2003 Jeremy Katz <katzj@redhat.com> 0.99.9.1-1
+- update to 0.99.9.1
+- add patch from upstream to fix potential bug when fetching with 
+  CR+LF linefeeds
+- tweak some things in the initscript and config file noticed by the 
+  fedora folks
+
+* Sun Mar 16 2003 Jeremy Katz <katzj@redhat.com> 0.99.8.1-2
+- fix ssl dir
+- own /var/run/dovecot/login with the correct perms
+- fix chmod/chown in post
+
+* Fri Mar 14 2003 Jeremy Katz <katzj@redhat.com> 0.99.8.1-1
+- update to 0.99.8.1
+
+* Tue Mar 11 2003 Jeremy Katz <katzj@redhat.com> 0.99.8-2
+- add a patch to fix quoting problem from CVS
+
+* Mon Mar 10 2003 Jeremy Katz <katzj@redhat.com> 0.99.8-1
+- 0.99.8
+- add some buildrequires
+- fixup to build with openssl 0.9.7
+- now includes a pop3 daemon (off by default)
+- clean up description and %%preun
+- add dovecot user (uid/gid of 97)
+- add some buildrequires
+- move the ssl cert to %%{_datadir}/ssl/certs
+- create a dummy ssl cert in %%post
+- own /var/run/dovecot
+- make the config file a source so we get default mbox locks of fcntl
+
+* Sun Dec  1 2002 Seth Vidal <skvidal@phy.duke.edu>
+- 0.99.4 and fix startup so it starts imap-master not vsftpd :)
+
+* Tue Nov 26 2002 Seth Vidal <skvidal@phy.duke.edu>
+- first build
diff --git a/rpmbuild/SOURCES/dovecot.sysconfig b/rpmbuild/SOURCES/dovecot.sysconfig
new file mode 100644
index 000000000..3cb4bd434
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot.sysconfig
@@ -0,0 +1,3 @@
+# Here you can specify your dovecot command line options.
+#
+#OPTIONS=""
diff --git a/rpmbuild/SOURCES/dovecot.tmpfilesd b/rpmbuild/SOURCES/dovecot.tmpfilesd
new file mode 100644
index 000000000..d96639a08
--- /dev/null
+++ b/rpmbuild/SOURCES/dovecot.tmpfilesd
@@ -0,0 +1,2 @@
+d /run/dovecot 0755 root dovecot -
+
diff --git a/rpmbuild/SOURCES/prestartscript b/rpmbuild/SOURCES/prestartscript
new file mode 100644
index 000000000..0c5492cba
--- /dev/null
+++ b/rpmbuild/SOURCES/prestartscript
@@ -0,0 +1,3 @@
+#!/bin/sh
+/bin/systemctl -q is-enabled NetworkManager.service >/dev/null 2>&1 && /usr/bin/nm-online -q --timeout 30 ||:
+
diff --git a/rpmbuild/SOURCES/sources b/rpmbuild/SOURCES/sources
new file mode 100644
index 000000000..05fd8408f
--- /dev/null
+++ b/rpmbuild/SOURCES/sources
@@ -0,0 +1,2 @@
+SHA512 (dovecot-2.3.8.tar.gz) = f62439e2ea77ffb544a7752c07085582c5653c64671cb42dd7a7e5aa69eb87059c677aa1fa071efa1ddd2287ab621e9a264ec115be2aeb2f43ab4c685411eae3
+SHA512 (dovecot-2.3-pigeonhole-0.5.8.tar.gz) = ddf009c755cc87c362ddf1c17ac1403b0f6a504b039efef3244f2d5bd4d3963fb25baaaa4d98c089b3e8bddd4675d131765fee5499d9aaf01015e44f7d631d2d
diff --git a/rpmbuild/SPECS/dovecot.spec b/rpmbuild/SPECS/dovecot.spec
new file mode 100644
index 000000000..151f06f94
--- /dev/null
+++ b/rpmbuild/SPECS/dovecot.spec
@@ -0,0 +1,1915 @@
+%global __provides_exclude_from %{_docdir}
+%global __requires_exclude_from %{_docdir}
+Summary: Secure imap and pop3 server
+Name: dovecot
+# for whatever reason hin is at epoch 2
+Epoch: 2
+Version: 2.2.36.4
+%global prever %{nil}
+#Release: 1%{?dist}
+Release: op01%{?dist}
+#dovecot itself is MIT, a few sources are PD, pigeonhole is LGPLv2
+License: MIT and LGPLv2
+Group: System Environment/Daemons
+
+URL: http://www.dovecot.org/
+Source: %{name}-%{version}%{?prever}.tar.gz
+Source1: dovecot.init
+Source2: dovecot.pam
+%global pigeonholever 0.4.24
+Source8: http://www.rename-it.nl/dovecot/2.2/dovecot-2.2-pigeonhole-%{pigeonholever}.tar.gz
+#wget http://hg.rename-it.nl/dovecot-2.2-pigeonhole/archive/%{pigeonholever}.tar.bz2 -O dovecot-2.2-pigeonhole-%{pigeonholever}.tar.bz2
+#Source8: dovecot-2.2-pigeonhole-%{pigeonholever}.tar.bz2
+Source9: dovecot.sysconfig
+Source10: dovecot.tmpfilesd
+
+#our own
+Source14: dovecot.conf.5
+
+# 3x Fedora/RHEL specific
+Patch1: dovecot-2.0-defaultconfig.patch
+Patch2: dovecot-1.0.beta2-mkcert-permissions.patch
+Patch3: dovecot-1.0.rc7-mkcert-paths.patch
+
+Patch5: dovecot-2.1-privatetmp.patch
+
+#wait for network
+Patch6: dovecot-2.1.10-waitonline.patch
+
+#workaround for chroot installation without /dev/random present, rhbz#1026790
+Patch7: dovecot-2.2.9-nodevrand.patch
+
+# sent upstream, rhbz#1630380
+Patch9: dovecot-2.2.36-aclfix.patch
+
+# dovecot < 2.3, rhbz#1280436
+Patch10: dovecot-2.2-gidcheck.patch
+
+
+Source15: prestartscript
+
+Buildroot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
+BuildRequires: openssl-devel, pam-devel, zlib-devel, bzip2-devel, xz-devel, libcap-devel
+BuildRequires: libtool, autoconf, automake, pkgconfig
+BuildRequires: sqlite-devel, tcp_wrappers-devel
+BuildRequires: postgresql-devel
+BuildRequires: mysql-devel
+BuildRequires: openldap-devel
+BuildRequires: krb5-devel
+BuildRequires: quota-devel
+
+# gettext-devel is needed for running autoconf because of the
+# presence of AM_ICONV
+BuildRequires: gettext-devel
+
+# Explicit Runtime Requirements for executalbe
+Requires: openssl >= 0.9.7f-4
+
+# Package includes an initscript service file, needs to require initscripts package
+Requires(pre): shadow-utils
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+Requires: systemd
+Requires(post): systemd-units
+Requires(preun): systemd-units
+Requires(postun): systemd-units
+%else
+Requires: initscripts
+Requires(post): chkconfig
+Requires(preun): chkconfig initscripts
+Requires(postun): initscripts
+%endif
+
+%if %{?fedora}0 > 150 || %{?rhel}0 >60
+#clucene in fedora <=15 and rhel<=6 is too old
+BuildRequires: clucene-core-devel
+%endif
+
+%define ssldir %{_sysconfdir}/pki/%{name}
+
+%if %{?fedora}00%{?rhel} < 6
+%define _initddir %{_initrddir}
+BuildRequires: curl-devel expat-devel
+%else
+BuildRequires: libcurl-devel expat-devel
+%endif
+
+%global restart_flag /var/run/%{name}/%{name}-restart-after-rpm-install
+
+%description
+Dovecot is an IMAP server for Linux/UNIX-like systems, written with security 
+primarily in mind.  It also contains a small POP3 server.  It supports mail 
+in either of maildir or mbox formats.
+
+The SQL drivers and authentication plug-ins are in their subpackages.
+
+%package pigeonhole
+Requires: %{name} = %{epoch}:%{version}-%{release}
+Obsoletes: dovecot-sieve < 1:1.2.10-3
+Obsoletes: dovecot-managesieve < 1:1.2.10-3
+Summary: Sieve and managesieve plug-in for dovecot
+Group: System Environment/Daemons
+License: MIT and LGPLv2
+
+%description pigeonhole
+This package provides sieve and managesieve plug-in for dovecot LDA.
+
+%package pgsql
+Requires: %{name} = %{epoch}:%{version}-%{release}
+Summary: Postgres SQL back end for dovecot
+Group: System Environment/Daemons
+%description pgsql
+This package provides the Postgres SQL back end for dovecot-auth etc.
+
+%package mysql
+Requires: %{name} = %{epoch}:%{version}-%{release}
+Summary: MySQL back end for dovecot
+Group: System Environment/Daemons
+%description mysql
+This package provides the MySQL back end for dovecot-auth etc.
+
+%package devel
+Requires: %{name} = %{epoch}:%{version}-%{release}
+Summary: Development files for dovecot
+Group: Development/Libraries
+%description devel
+This package provides the development files for dovecot.
+
+%prep
+%setup -q -n %{name}-%{version}%{?prever} -a 8
+%patch1 -p1 -b .default-settings
+%patch2 -p1 -b .mkcert-permissions
+%patch3 -p1 -b .mkcert-paths
+%patch6 -p1 -b .waitonline
+%patch7 -p1 -b .nodevrand
+%patch9 -p1 -b .aclfix
+%patch10 -p1 -b .gidcheck
+sed -i '/DEFAULT_INCLUDES *=/s|$| '"$(pkg-config --cflags libclucene-core)|" src/plugins/fts-lucene/Makefile.in
+#pigeonhole
+pushd dovecot-2*2-pigeonhole-%{pigeonholever}
+popd
+
+%build
+#required for fdpass.c line 125,190: dereferencing type-punned pointer will break strict-aliasing rules
+%global _hardened_build 1
+export CFLAGS="-fno-strict-aliasing"
+export LDFLAGS="-Wl,-z,now -Wl,-z,relro"
+#autoreconf -I . -fiv #required for aarch64 support
+%configure                       \
+    INSTALL_DATA="install -c -p -m644" \
+    --docdir=%{_docdir}/%{name}-%{version}     \
+    --disable-static             \
+    --disable-rpath              \
+    --with-nss                   \
+    --with-shadow                \
+    --with-pam                   \
+    --with-gssapi=plugin         \
+    --with-ldap=plugin           \
+    --with-sql=plugin            \
+    --with-pgsql                 \
+    --with-mysql                 \
+    --with-sqlite                \
+    --with-lzma                  \
+    --with-zlib                  \
+    --with-libcap                \
+%if %{?fedora}0 > 150 || %{?rhel}0 >60
+    --with-lucene                \
+%endif
+    --with-ssl=openssl           \
+    --with-ssldir=%{ssldir}      \
+    --with-solr                  \
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+    --with-systemdsystemunitdir=%{_unitdir}  \
+%endif
+    --with-docs                  \
+    --with-libwrap
+
+sed -i 's|/etc/ssl|/etc/pki/dovecot|' doc/mkcert.sh doc/example-config/conf.d/10-ssl.conf
+
+make %{?_smp_mflags}
+
+#pigeonhole
+pushd dovecot-2*2-pigeonhole-%{pigeonholever}
+
+# required for snapshot
+[ -f configure ] || autoreconf -fiv
+[ -f ChangeLog ] || echo "Pigeonhole ChangeLog is not available, yet" >ChangeLog
+
+%configure                             \
+    INSTALL_DATA="install -c -p -m644" \
+    --disable-static                   \
+    --with-dovecot=../                 \
+    --without-unfinished-features
+
+make %{?_smp_mflags}
+popd
+
+%install
+rm -rf $RPM_BUILD_ROOT
+
+make install DESTDIR=$RPM_BUILD_ROOT
+
+#move doc dir back to build dir so doc macro in files section can use it
+mv $RPM_BUILD_ROOT/%{_docdir}/%{name}-%{version} %{_builddir}/%{name}-%{version}%{?prever}/docinstall
+
+
+pushd dovecot-2*2-pigeonhole-%{pigeonholever}
+make install DESTDIR=$RPM_BUILD_ROOT
+
+mv $RPM_BUILD_ROOT/%{_docdir}/%{name}-%{version} $RPM_BUILD_ROOT/%{_docdir}/%{name}-pigeonhole
+
+install -m 644 AUTHORS ChangeLog COPYING COPYING.LGPL INSTALL NEWS README $RPM_BUILD_ROOT/%{_docdir}/%{name}-pigeonhole
+popd
+
+
+%if %{?fedora}00%{?rhel} < 6
+sed -i 's|password-auth|system-auth|' %{SOURCE2}
+%endif
+
+install -p -D -m 644 %{SOURCE2} $RPM_BUILD_ROOT%{_sysconfdir}/pam.d/dovecot
+
+#install man pages
+install -p -D -m 644 %{SOURCE14} $RPM_BUILD_ROOT%{_mandir}/man5/dovecot.conf.5
+
+#install waitonline script
+install -p -D -m 755 %{SOURCE15} $RPM_BUILD_ROOT%{_libexecdir}/dovecot/prestartscript
+
+# generate ghost .pem files
+mkdir -p $RPM_BUILD_ROOT%{ssldir}/certs
+mkdir -p $RPM_BUILD_ROOT%{ssldir}/private
+touch $RPM_BUILD_ROOT%{ssldir}/certs/dovecot.pem
+chmod 600 $RPM_BUILD_ROOT%{ssldir}/certs/dovecot.pem
+touch $RPM_BUILD_ROOT%{ssldir}/private/dovecot.pem
+chmod 600 $RPM_BUILD_ROOT%{ssldir}/private/dovecot.pem
+
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+install -p -D -m 644 %{SOURCE10} $RPM_BUILD_ROOT%{_tmpfilesdir}/dovecot.conf
+%else
+install -p -D -m 755 %{SOURCE1} $RPM_BUILD_ROOT%{_initddir}/dovecot
+install -p -D -m 600 %{SOURCE9} $RPM_BUILD_ROOT%{_sysconfdir}/sysconfig/dovecot
+%endif
+
+mkdir -p $RPM_BUILD_ROOT/var/run/dovecot/{login,empty}
+
+# Install dovecot configuration and dovecot-openssl.cnf
+mkdir -p $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/conf.d
+install -p -m 644 docinstall/example-config/dovecot.conf $RPM_BUILD_ROOT%{_sysconfdir}/dovecot
+install -p -m 644 docinstall/example-config/conf.d/*.conf $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/conf.d
+install -p -m 644 $RPM_BUILD_ROOT/%{_docdir}/%{name}-pigeonhole/example-config/conf.d/*.conf $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/conf.d
+install -p -m 644 docinstall/example-config/conf.d/*.conf.ext $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/conf.d
+install -p -m 644 $RPM_BUILD_ROOT/%{_docdir}/%{name}-pigeonhole/example-config/conf.d/*.conf.ext $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/conf.d ||:
+install -p -m 644 doc/dovecot-openssl.cnf $RPM_BUILD_ROOT%{ssldir}/dovecot-openssl.cnf
+
+install -p -m755 doc/mkcert.sh $RPM_BUILD_ROOT%{_libexecdir}/%{name}/mkcert.sh
+
+mkdir -p $RPM_BUILD_ROOT/var/lib/dovecot
+
+#remove the libtool archives
+find $RPM_BUILD_ROOT%{_libdir}/%{name}/ -name '*.la' | xargs rm -f
+
+#remove what we don't want
+rm -f $RPM_BUILD_ROOT%{_sysconfdir}/dovecot/README
+pushd docinstall
+rm -f securecoding.txt thread-refs.txt
+popd
+
+
+%clean
+rm -rf $RPM_BUILD_ROOT
+
+
+%pre
+#dovecot uid and gid are reserved, see /usr/share/doc/setup-*/uidgid 
+getent group dovecot >/dev/null || groupadd -r --gid 97 dovecot
+getent passwd dovecot >/dev/null || \
+useradd -r --uid 97 -g dovecot -d /usr/libexec/dovecot -s /sbin/nologin -c "Dovecot IMAP server" dovecot
+
+getent group dovenull >/dev/null || groupadd -r dovenull
+getent passwd dovenull >/dev/null || \
+useradd -r -g dovenull -d /usr/libexec/dovecot -s /sbin/nologin -c "Dovecot's unauthorized user" dovenull
+
+# do not let dovecot run during upgrade rhbz#134325
+if [ "$1" = "2" ]; then
+  rm -f %restart_flag
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+  /bin/systemctl is-active %{name}.service >/dev/null 2>&1 && touch %restart_flag ||:
+  /bin/systemctl stop %{name}.service >/dev/null 2>&1
+%else
+  /sbin/service %{name} status >/dev/null 2>&1 && touch %restart_flag ||:
+  /sbin/service %{name} stop >/dev/null 2>&1
+%endif
+fi
+
+%post
+if [ $1 -eq 1 ]
+then
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+  %systemd_post dovecot.service
+%else
+  /sbin/chkconfig --add %{name}
+%endif
+fi
+
+# generate the ssl certificates
+if [ ! -f %{ssldir}/certs/%{name}.pem ]; then
+    SSLDIR=%{ssldir} OPENSSLCONFIG=%{ssldir}/dovecot-openssl.cnf \
+         %{_libexecdir}/%{name}/mkcert.sh &> /dev/null
+fi
+
+if [ ! -f /var/lib/dovecot/ssl-parameters.dat ]; then
+    /usr/libexec/dovecot/ssl-params &>/dev/null
+fi
+
+install -d -m 0755 -g dovecot -d /var/run/dovecot
+install -d -m 0755 -d /var/run/dovecot/empty
+install -d -m 0750 -g dovenull /var/run/dovecot/login
+/sbin/restorecon -R /var/run/dovecot 2>/dev/null || :
+
+%preun
+if [ $1 = 0 ]; then
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+        /bin/systemctl disable dovecot.service dovecot.socket >/dev/null 2>&1 || :
+        /bin/systemctl stop dovecot.service dovecot.socket >/dev/null 2>&1 || :
+%else
+    /sbin/service %{name} stop > /dev/null 2>&1
+    /sbin/chkconfig --del %{name}
+%endif
+    rm -rf /var/run/dovecot
+fi
+
+%postun
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+/bin/systemctl daemon-reload >/dev/null 2>&1 || :
+%endif
+
+if [ "$1" -ge "1" -a -e %restart_flag ]; then
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+    /bin/systemctl start dovecot.service >/dev/null 2>&1 || :
+%else
+    /sbin/service %{name} start >/dev/null 2>&1 || :
+%endif
+rm -f %restart_flag
+fi
+
+%posttrans
+# dovecot should be started again in #postun, but it's not executed on reinstall
+# if it was already started, restart_flag won't be here, so it's ok to test it again
+if [ -e %restart_flag ]; then
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+    /bin/systemctl start dovecot.service >/dev/null 2>&1 || :
+%else
+    /sbin/service %{name} start >/dev/null 2>&1 || :
+%endif
+rm -f %restart_flag
+fi
+
+%check
+make check
+cd dovecot-2*2-pigeonhole-%{pigeonholever}
+make check
+
+%files
+%defattr(-,root,root,-)
+%doc docinstall/* AUTHORS ChangeLog COPYING COPYING.LGPL COPYING.MIT NEWS README
+%{_sbindir}/dovecot
+
+%{_bindir}/doveadm
+%{_bindir}/doveconf
+%{_bindir}/dsync
+
+
+%if %{?fedora}0 > 140 || %{?rhel}0 > 60
+%_tmpfilesdir/dovecot.conf
+%{_unitdir}/dovecot.service
+%{_unitdir}/dovecot.socket
+%else
+%{_initddir}/dovecot
+%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/dovecot
+%endif
+
+%dir %{_sysconfdir}/dovecot
+%dir %{_sysconfdir}/dovecot/conf.d
+%config(noreplace) %{_sysconfdir}/dovecot/dovecot.conf
+#list all so we'll be noticed if upstream changes anything
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-auth.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-director.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-logging.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-mail.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-master.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/10-ssl.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/15-lda.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/15-mailboxes.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/20-imap.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/20-lmtp.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/20-pop3.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/90-acl.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/90-quota.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/90-plugin.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-checkpassword.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-deny.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-dict.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-ldap.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-master.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-passwdfile.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-sql.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-static.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-system.conf.ext
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/auth-vpopmail.conf.ext
+
+%config(noreplace) %{_sysconfdir}/pam.d/dovecot
+%config(noreplace) %{ssldir}/dovecot-openssl.cnf
+
+%dir %{ssldir}
+%dir %{ssldir}/certs
+%dir %{ssldir}/private
+%attr(0600,root,root) %ghost %config(missingok,noreplace) %verify(not md5 size mtime) %{ssldir}/certs/dovecot.pem
+%attr(0600,root,root) %ghost %config(missingok,noreplace) %verify(not md5 size mtime) %{ssldir}/private/dovecot.pem
+
+%dir %{_libdir}/dovecot
+%dir %{_libdir}/dovecot/auth
+%dir %{_libdir}/dovecot/dict
+%dir %{_libdir}/dovecot/stats
+%{_libdir}/dovecot/doveadm
+%exclude %{_libdir}/dovecot/doveadm/*sieve*
+%{_libdir}/dovecot/*.so.*
+#these (*.so files) are plugins, not devel files
+%{_libdir}/dovecot/*_plugin.so
+%exclude %{_libdir}/dovecot/*_sieve_plugin.so
+%{_libdir}/dovecot/auth/lib20_auth_var_expand_crypt.so
+%{_libdir}/dovecot/auth/libauthdb_imap.so
+%{_libdir}/dovecot/auth/libauthdb_ldap.so
+%{_libdir}/dovecot/auth/libmech_gssapi.so
+%{_libdir}/dovecot/auth/libdriver_sqlite.so
+%{_libdir}/dovecot/dict/libdriver_sqlite.so
+%{_libdir}/dovecot/dict/libdict_ldap.so
+%{_libdir}/dovecot/stats/libstats_auth.so
+%{_libdir}/dovecot/stats/libstats_mail.so
+%{_libdir}/dovecot/libdriver_sqlite.so
+%{_libdir}/dovecot/libssl_iostream_openssl.so
+%{_libdir}/dovecot/libfs_compress.so
+%{_libdir}/dovecot/libfs_crypt.so
+%{_libdir}/dovecot/libfs_mail_crypt.so
+%{_libdir}/dovecot/libdcrypt_openssl.so
+%{_libdir}/dovecot/lib20_var_expand_crypt.so
+
+%dir %{_libdir}/dovecot/settings
+
+%{_libexecdir}/%{name}
+%exclude %{_libexecdir}/%{name}/managesieve*
+
+%attr(0755,root,dovecot) %ghost /var/run/dovecot
+%attr(0750,root,dovenull) %ghost /var/run/dovecot/login
+%attr(0755,root,root) %ghost /var/run/dovecot/empty
+%attr(0750,dovecot,dovecot) /var/lib/dovecot
+
+%{_datadir}/%{name}
+
+%{_mandir}/man1/deliver.1*
+%{_mandir}/man1/doveadm*.1*
+%{_mandir}/man1/doveconf.1*
+%{_mandir}/man1/dovecot*.1*
+%{_mandir}/man1/dsync.1*
+%{_mandir}/man5/dovecot.conf.5*
+%{_mandir}/man7/doveadm-search-query.7*
+
+%files pigeonhole
+%defattr(-,root,root,-)
+%{_bindir}/sieve-dump
+%{_bindir}/sieve-filter
+%{_bindir}/sieve-test
+%{_bindir}/sievec
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/20-managesieve.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/90-sieve.conf
+%config(noreplace) %{_sysconfdir}/dovecot/conf.d/90-sieve-extprograms.conf
+
+%{_docdir}/%{name}-pigeonhole
+
+%{_libexecdir}/%{name}/managesieve
+%{_libexecdir}/%{name}/managesieve-login
+
+%{_libdir}/dovecot/doveadm/*sieve*
+%{_libdir}/dovecot/*_sieve_plugin.so
+%{_libdir}/dovecot/settings/libmanagesieve_*.so
+%{_libdir}/dovecot/settings/libpigeonhole_*.so
+%{_libdir}/dovecot/sieve/
+
+%{_mandir}/man1/sieve-dump.1*
+%{_mandir}/man1/sieve-filter.1*
+%{_mandir}/man1/sieve-test.1*
+%{_mandir}/man1/sievec.1*
+%{_mandir}/man1/sieved.1*
+%{_mandir}/man7/pigeonhole.7*
+
+%files mysql
+%defattr(-,root,root,-)
+%{_libdir}/%{name}/libdriver_mysql.so
+%{_libdir}/%{name}/auth/libdriver_mysql.so
+%{_libdir}/%{name}/dict/libdriver_mysql.so
+
+%files pgsql
+%defattr(-,root,root,-)
+%{_libdir}/%{name}/libdriver_pgsql.so
+%{_libdir}/%{name}/auth/libdriver_pgsql.so
+%{_libdir}/%{name}/dict/libdriver_pgsql.so
+
+%files devel
+%{_includedir}/dovecot
+%{_datadir}/aclocal/dovecot*.m4
+%{_libdir}/dovecot/libdovecot*.so
+%{_libdir}/dovecot/dovecot-config
+
+
+%changelog
+* Wed Sep 19 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.36-3
+- fix global ACL directory configuration search path (#1630380)
+- update first/last_valid_gid range patch (#1630409)
+
+* Mon Jul 30 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.36-2
+- fix defaut permissions of gost run files
+
+* Tue Jun 12 2018 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.36-1
+- dovecot updated to 2.2.36, pigeonhole to 0.4.24
+- fixed dsync not replicating sieve scripts (#1419426)
+- fix plugins incorrectly reporting epipe errors(#1489943)
+
+* Tue Mar 21 2017 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.10-8
+- do not iterate over users outside of first/last_valid_gid range (#1280436)
+
+* Thu Jun 09 2016 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.10-7
+- prevent warning messages from %%post section if selinux-policy is
+  not installed (yet) (#1057522)
+- compile with xz compression support enabled (#1176214)
+- fix crash in sieve script compilation (#1177852)
+- wait with start after network-online target (#1209006)
+- build with tcp wrappers enabled (#1229164)
+- fixed userdb extra fields handling in passdb failure (#1234868)
+- fix valgrind option detection for make check (#1249625)
+- first valid regular user id is 1000 (#1280433)
+- fixed race condition when creating a new mailbox and another process getting its GUID (#1331478)
+- fixed header parsing when there were multiple same header names (#1224496)
+
+* Mon Jun 06 2016 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.10-6
+- add devel sub-package (#1122676)
+
+* Wed Jun 11 2014 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.10-5
+- fix CVE-2014-3430: denial of service through maxxing out SSL connections (#1108004)
+
+* Fri Jan 24 2014 Daniel Mach <dmach@redhat.com> - 1:2.2.10-4
+- Mass rebuild 2014-01-24
+
+* Wed Jan 15 2014 Honza Horak <hhorak@redhat.com> - 1:2.2.10-3
+- Rebuild for mariadb-libs
+  Related: #1045013
+
+* Wed Jan 08 2014 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.10-2
+- fix pigeonhole docdir name
+
+* Fri Jan 03 2014 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.10-1
+- dovecot updated to 2.2.10, pigeonhole updated to 0.4.2
+
+* Fri Dec 27 2013 Daniel Mach <dmach@redhat.com> - 1:2.2.5-3
+- Mass rebuild 2013-12-27
+
+* Fri Dec 06 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.5-2
+- fix chroot installation hang (#1026790)
+
+* Wed Aug 07 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.5-1
+- dovecot updated to 2.2.5
+
+* Tue Jul 30 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.4-2
+- dovecot pigeonhole updated to 0.4.1
+
+* Fri Jul 19 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.4-1
+- fix name conflict with cyrus-sasl
+- dovecot updated to 2.2.4
+- drop devel sub-package
+
+* Mon Jun 17 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.3-1
+- dovecot updated to 2.2.3
+- IMAP: If subject contained only whitespace, Dovecot returned an
+  ENVELOPE reply with a huge literal value, effectively causing the
+  IMAP client to wait for more data forever.
+- IMAP: Various URLAUTH fixes.
+- imapc: Various bugfixes and improvements
+- pop3c: Various fixes to make it work in dsync (without imapc)
+- dsync: Fixes to syncing subscriptions. Fixes to syncing mailbox
+  renames.
+
+* Tue May 21 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.2-2
+- fix location of tmpfiles configuration (#964448)
+
+* Mon May 20 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.2-1
+- dovecot updated to 2.2.2
+- IMAP: Various URLAUTH fixes.
+- IMAP: Fixed a hang with invalid APPEND parameters.
+- IMAP LIST-EXTENDED: INBOX was never listed with \Subscribed flag.
+- mailbox_list_index=yes still caused crashes.
+- maildir: Fixed a crash after dovecot-keywords file was re-read.
+- maildir: If files had reappeared unexpectedly to a Maildir, they
+  were ignored until index files were deleted.
+- Maildir: Fixed handling over 26 keywords in a mailbox. 
+- imap/pop3-login proxying: Fixed a crash if TCP connection succeeded,
+  but the remote login timed out.
+
+* Thu May 16 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.1-4
+- update pigeonhole to 0.4.0
+
+* Mon Apr 29 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.1-3
+- revert last change and use different fix
+
+* Wed Apr 24 2013 Kalev Lember <kalevlember@gmail.com> - 1:2.2.1-2
+- Filter out autogenerated perl deps (#956194)
+
+* Fri Apr 19 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.1-1
+- dovecot updated to 2.2.1
+- mailbox_list_index=yes was broken.
+- LAYOUT=index didn't list subscriptions.
+- auth: Multiple master passdbs didn't work.
+- Message parsing (e.g. during search) crashed when multipart message
+  didn't actually contain any parts.
+- dovecot updated to 2.2.1
+
+* Mon Apr 15 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2.0-1
+- dovecot updated to 2.2.0
+- Mailbox list indexes weren't using proper file permissions based
+  on the root directory.
+- replicator: doveadm commands and user list export may have skipped
+  some users.
+- Various fixes to mailbox_list_index=yes
+
+* Fri Apr 05 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2-0.4
+- dovecot updated to 2.2 RC4
+- various bugfixes to LDAP changes in rc3
+
+* Wed Mar 27 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2-0.3
+- dovecot updated to 2.2 RC3
+- Fixed a crash when decoding quoted-printable content.
+- dsync: Various bugfixes
+
+* Thu Feb 28 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2-0.2
+- do not print error when NetworkManager is not installed (#916456)
+
+* Wed Feb 27 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.2-0.1
+- major update to dovecot 2.2 RC2
+
+* Mon Feb 11 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.15-1
+- dovecot updated to 2.1.15
+- v2.1.14's dovecot.index.cache fixes caused Dovecot to use more disk I/O
+  and memory than was necessary.
+
+* Tue Feb 05 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.14-2
+- spec clean up
+
+* Thu Jan 31 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.14-1
+- dovecot updated to 2.1.14
+- v2.1.11+ had a race condition where it sometimes overwrote data in
+  dovecot.index.cache file. This could have caused Dovecot to return
+  the same cached data to two different messages.
+- mdbox: Fixes to handling duplicate GUIDs during index rebuild
+
+* Tue Jan 15 2013 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.13-1
+- dovecot updated to 2.1.13
+- Some fixes to cache file changes in v2.1.11.
+- virtual storage: Sorting mailbox by from/to/cc/bcc didn't work.
+
+* Mon Dec 03 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.12-1
+- dovecot updated to 2.1.12
+- lmtp proxy: Fixed hanging if remote server was down.
+- doveadm: Various fixes to handling doveadm-server connections.
+- auth: passdb imap was broken in v2.1.10.
+
+* Thu Nov 08 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.10-3
+- fix network still not ready race condition (#871623)
+
+* Fri Nov 02 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.10-2
+- add reload command to service file
+
+* Wed Sep 19 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.10-1
+- dovecot updated to 2.1.10, pigeonhole updated to 0.3.3
+- director: In some conditions director may have disconnected from
+  another director (without logging about it), thinking it was sending
+  invalid data.
+- imap: Various fixes to listing mailboxes.
+- login processes crashed if there were a lot of local {} or remote {}
+  settings blocks.
+
+* Fri Aug 24 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.9-2
+- use new systemd rpm macros (#851238)
+
+* Thu Aug 02 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.9-1
+- dovecot updated to 2.1.9
+- Full text search indexing might have failed for some messages,
+  always causing indexer-worker process to run out of memory.
+- fts-lucene: Fixed handling SEARCH HEADER FROM/TO/SUBJECT/CC/BCC when
+  the header wasn't lowercased.
+- fts-squat: Fixed crash when searching a virtual mailbox.
+- pop3: Fixed assert crash when doing UIDL on empty mailbox on some
+  setups. 
+- auth: GSSAPI RFC compliancy and error handling fixes.
+- Various fixes related to handling shared namespaces
+
+* Wed Jul 18 2012 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1:2.1.8-3
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_18_Mass_Rebuild
+
+* Tue Jul 03 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.8-2
+- pigeonhole updated to 0.3.1
+- Fixed several small issues, including a few potential segfault bugs, based
+  on static source code analysis.
+
+* Tue Jul 03 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.8-1
+- dovecot updated to 2.1.8
+- imap: Mailbox names were accidentally sent as UTF-8 instead of mUTF-7
+  in previous v2.1.x releases for STATUS, MYRIGHTS and GETQUOTAROOT commands.
+- lmtp proxy: Don't timeout connections too early when mail has a lot of RCPT TOs.
+- director: Don't crash if the director is working alone.
+- shared mailboxes: Avoid doing "@domain" userdb lookups.
+- doveadm: Fixed crash with proxying some commands.
+- fts-squat: Fixed handling multiple SEARCH parameters.
+- imapc: Fixed a crash when message had more than 8 keywords.
+- imapc: Don't crash on APPEND/COPY if server doesn't support UIDPLUS.
+
+
+* Mon Jul 02 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.7-5
+- make quota work with NFS mounted mailboxes
+
+* Fri Jun 22 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.7-4
+- posttrans argument is always zero
+
+* Fri Jun 15 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.7-3
+- do not let dovecot run during upgrade (#134325)
+
+* Wed May 30 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.7-2
+- fix changelog, 2.1.7-1 had copy-pasted upstream changelog, which was wrong
+- director: Don't crash with quickly disconnecting incoming director
+  connections.
+- mdbox: If mail was originally saved to non-INBOX, and namespace
+  prefix is non-empty, don't assert-crash when rebuilding indexes.
+- sdbox: Don't use more fds than necessary when copying mails.
+- auth: Fixed crash with DIGEST-MD5 when attempting to do master user
+  login without master passdbs. 
+- Several fixes to mail_shared_explicit_inbox=no
+- imapc: Use imapc_list_prefix also for listing subscriptions.
+
+* Wed May 30 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.7-1
+- updated to 2.1.7
+- v2.1.5: Using "~/" as mail_location or elsewhere failed to actually
+  expand it to home directory.
+- dbox: Fixed potential assert-crash when reading dbox files.
+- trash plugin: Fixed behavior when quota is already over limit.
+- mail_log plugin: Logging "copy" event didn't work.
+- Proxying to backend server with SSL: Verifying server certificate
+  name always failed, because it was compared to an IP address.
+
+* Wed May 09 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.6-2
+- fix socket activation again, fix in 2.1.6 is incomplete
+
+* Wed May 09 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.6-1
+- v2.1.5: Using "~/" as mail_location or elsewhere failed to actually
+  expand it to home directory.
+- dbox: Fixed potential assert-crash when reading dbox files.
+- trash plugin: Fixed behavior when quota is already over limit.
+- Proxying to backend server with SSL: Verifying server certificate
+  name always failed, because it was compared to an IP address.
+
+* Tue Apr 24 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.5-1
+- IMAP: Several fixes related to mailbox listing in some configs
+- director: A lot of fixes and performance improvements
+- mbox: Deleting a mailbox didn't delete its index files.
+- pop3c: TOP command was sent incorrectly
+- trash plugin didn't work properly
+- LMTP: Don't add a duplicate Return-Path: header when proxying.
+- listescape: Don't unescape namespace prefixes.
+
+* Tue Apr 24 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.4-2
+- close systemd extra sockets that are not configured
+
+* Tue Apr 10 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.4-1
+- dovecot updated to 2.1.4
+- Proxying SSL connections crashed in v2.1.[23]
+- fts-solr: Indexing mail bodies was broken.
+- director: Several changes to significantly improve error handling
+- doveadm import didn't import messages' flags
+- mail_full_filesystem_access=yes was broken
+- Make sure IMAP clients can't create directories when accessing
+  nonexistent users' mailboxes via shared namespace.
+- Dovecot auth clients authenticating via TCP socket could have failed
+  with bogus "PID already in use" errors.
+
+* Mon Mar 19 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.3-1
+- dovecot updated to 2.1.3
+- multi-dbox format in dovecot 2.1.2 was broken
+- temporarily disable check phase until bug #798968 is fixed
+
+* Fri Mar 16 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.2-1
+- dovecot updated to 2.1.2
+- doveadm sync: If mailbox was expunged empty, messages may have
+  become back instead of also being expunged in the other side.
+- imap_id_* settings were ignored before login.
+- Several fixes to mailbox_list_index=yes
+- Previous v2.1.x didn't log all messages at shutdown.
+
+* Thu Mar 01 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.1-2
+- enable fts_lucene plugin (#798661)
+
+* Fri Feb 24 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.1-1
+- dovecot updated to 2.1.1
+- acl plugin + autocreated mailboxes crashed when listing mailboxes
+- doveadm force-resync: Don't skip autocreated mailboxes (especially
+  INBOX). 
+- If process runs out of fds, stop listening for new connections only
+  temporarily, not permanently (avoids hangs with process_limit=1
+  services)
+- auth: passdb imap crashed for non-login authentication (e.g. smtp).
+
+
+* Mon Feb 20 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1.0-1
+- updated to 2.1.0 (no major changes since .rc6)
+- include pigeonhole doc files (NEWS, README, ...)
+
+* Tue Feb 14 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.7.rc6
+- updated to 2.1.rc6
+- dbox: Fixed error handling when saving failed or was aborted
+- IMAP: Using COMPRESS extension may have caused assert-crashes
+- IMAP: THREAD REFS sometimes returned invalid (0) nodes.
+- dsync: Fixed handling non-ASCII characters in mailbox names.
+
+* Tue Feb 07 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.6.rc5
+- use PrivateTmp in systemd unit file
+
+* Tue Feb 07 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.5.rc5
+- updated to 2.1.rc5
+- director: With >2 directors ring syncing might have stalled during
+  director connect/disconnect, causing logins to fail.
+- LMTP client/proxy: Fixed potential hanging when sending (big) mails
+- Compressed mails with external attachments (dbox + SIS + zlib) failed
+  sometimes with bogus "cached message size wrong" errors.
+
+* Mon Jan 09 2012 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.4.rc3
+- updated to 2.1.rc3
+- dsync was merged into doveadm
+- added pop3c (= POP3 client) storage backend
+
+* Wed Dec 14 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.3.rc1
+- allow imap+TLS and pop3+TLS by default
+
+* Fri Dec 02 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.2.rc1
+- call systemd reload in postun
+
+* Wed Nov 30 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.1-0.1.rc1
+- updated to 2.1.rc1
+- major changes since 2.0.x:
+- plugins now use UTF-8 mailbox names rather than mUTF-7
+- auth_username_format default changed to %Lu
+- solr full text search backend changed to use mailbox GUIDs instead of
+  mailbox names, requiring reindexing everything
+
+* Mon Nov 21 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.16-1
+- dovecot updated to 2.0.16
+
+* Mon Oct 24 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.15-2
+- do not use obsolete settings in default configuration (#743444)
+
+* Mon Sep 19 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.15-1
+- dovecot updated to 2.0.15
+- v2.0.14: Index reading could have eaten a lot of memory in some
+  situations
+- mbox: Fixed crash during mail delivery when mailbox didn't yet have
+  GUID assigned to it.
+- zlib+mbox: Fetching last message from compressed mailboxes crashed.
+
+* Tue Sep 13 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.14-2
+- do not enable insecure connections by default
+
+* Mon Aug 29 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.14-1
+- dovecot updated to 2.0.14
+- userdb extra fields can now return name+=value to append to an
+  existing name
+- script-login attempted an unnecessary config lookup, which usually
+  failed with "Permission denied".
+- lmtp: Fixed parsing quoted strings with spaces as local-part for
+  MAIL FROM and RCPT TO.
+- imap: FETCH BODY[HEADER.FIELDS (..)] may have crashed or not
+  returned all data sometimes.
+- ldap: Fixed random assert-crashing with with sasl_bind=yes.
+- Fixes to handling mail chroots
+- Fixed renaming mailboxes under different parent with FS layout when
+  using separate ALT, INDEX or CONTROL paths.
+- zlib: Fixed reading concatenated .gz files.
+
+* Fri Jul 15 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.13-2
+- do not include sysv init script
+
+* Thu May 12 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.13-1
+- dovecot updated to 2.0.13
+- mdbox purge: Fixed wrong warning about corrupted extrefs.
+- script-login binary wasn't actually dropping privileges to the
+  user/group/chroot specified by its service settings.
+- Fixed potential crashes and other problems when parsing header names
+  that contained NUL characters.
+
+* Fri Apr 15 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.12-2
+- pigeonhole updated to 0.2.3, which includes:
+- managesieve: fixed bug in UTF-8 checking of string values
+- sieve command line tools now avoid initializing the mail store unless necessary
+- removed header MIME-decoding to fix erroneous address parsing
+- fixed segfault bug in extension configuration, triggered when unknown
+  extension is mentioned in sieve_extensions setting.
+
+* Wed Apr 13 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.12-1
+- dbox: Fixes to handling external attachments
+- dsync: More fixes to avoid hanging with remote syncs
+- dsync: Many other syncing/correctness fixes
+- doveconf: v2.0.10 and v2.0.11 didn't output plugin {} section right
+
+* Mon Mar 28 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.11-5
+- rebuild with new patch
+
+* Mon Mar 28 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.11-4
+- fix regression in config file parsing (#690401)
+
+* Wed Mar 23 2011 Dan Hork <dan@danny.cz> - 1:2.0.11-3
+- rebuilt for mysql 5.5.10 (soname bump in libmysqlclient)
+
+* Wed Mar 23 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.11-2
+- rebuild because of updated dependencies
+
+* Mon Mar 07 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.11-1
+- IMAP: Fixed hangs with COMPRESS extension
+- IMAP: Fixed a hang when trying to COPY to a nonexistent mailbox. 
+- IMAP: Fixed hang/crash with SEARCHRES + pipelining $.
+- IMAP: Fixed assert-crash if IDLE+DONE is sent in same TCP packet.
+
+* Thu Feb 17 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.9-3
+- add missing section to dovecot's systemd service file
+
+* Tue Feb 08 2011 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1:2.0.9-2
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_15_Mass_Rebuild
+
+* Thu Jan 13 2011 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.9-1
+- dovecot updated to 2.0.9
+- fixed a high system CPU usage / high context switch count performance problem
+- lda: Fixed a crash when trying to send "out of quota" reply
+
+* Mon Dec 20 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.8-3
+- add full path and check to restorecon in post
+
+* Tue Dec 07 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.8-2
+- fix s/foobar/dovecot/ typo in post script
+
+* Tue Dec 07 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.8-1
+- dovecot updated to 2.0.8, pigeonhole updated to 0.2.2
+- services' default vsz_limits weren't being enforced correctly
+- added systemd support
+- dbox: Fixes to handling external mail attachments
+- imap, pop3: When service { client_count } was larger than 1, the
+  log messages didn't use the correct prefix
+- MySQL: Only the first specified host was ever used
+
+* Mon Nov 29 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.7-3
+- make it work with /var/run on tmpfs (#656577)
+
+* Tue Nov 23 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.7-2
+- fix regression with  valid_chroot_dirs being ignored (#654083)
+
+* Tue Nov 09 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.7-1
+- dovecot updated to 2.0.7
+- IMAP: Fixed LIST-STATUS when listing subscriptions with subscriptions=no namespaces.
+- IMAP: Fixed SELECT QRESYNC not to crash on mailbox close if a lot of changes were being sent. 
+- quota: Don't count virtual mailboxes in quota
+- doveadm expunge didn't always actually do the physical expunging
+- Fixed some index reading optimizations introduced by v2.0.5.
+- LMTP proxying fixes
+
+* Fri Oct 22 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.6-1
+- dovecot updated to 2.0.6
+- Pre-login CAPABILITY includes IDLE again. Mainly to make Blackberry
+  servers happy.
+- auth: auth_cache_negative_ttl default was 0 in earlier v2.0.x, but it
+  was supposed to be 1 hour as in v1.x. Changed it back to 1h.
+- doveadm: Added import command for importing mails from other storages.
+- Reduced NFS I/O operations for index file accesses
+- dbox, Maildir: When copying messages, copy also already cached fields
+  from dovecot.index.cache
+- Maildir: LDA/LMTP assert-crashed sometimes when saving a mail.
+- Fixed leaking fds when writing to dovecot.mailbox.log.
+- Fixed rare dovecot.index.cache corruption
+- IMAP: SEARCH YOUNGER/OLDER wasn't working correctly
+
+* Mon Oct 04 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.5-1
+- dovecot updated to 2.0.5
+- acl: Fixed the logic of merging multiple ACL entries
+- sdbox: Fixed memory leak when copying messages with hard links. 
+- zlib: Fixed several crashes, which mainly showed up with mbox.
+- quota: Don't crash if user has quota disabled, but plugin loaded.
+- acl: Fixed crashing when sometimes listing shared mailboxes via dict proxy.
+
+* Tue Sep 28 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.4-1
+- dovecot updated to 2.0.4
+- multi-dbox: If :INDEX=path is specified, keep storage/dovecot.map.index* 
+  files also in the index path rather than in the main storage directory.
+- dsync: POP3 UIDLs weren't copied with Maildir
+- dict file: Fixed fd leak (showed up easily with LMTP + quota)
+
+* Mon Sep 20 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.3-1
+- dovecot updated to 2.0.3
+- dovecot-lda: Removed use of non-standard Envelope-To: header as 
+  a default for -a
+- dsync: Fixed handling \Noselect mailboxes
+- Fixed an infinite loop introduced by v2.0.2's message parser changes.
+- Fixed a crash introduced by v2.0.2's istream-crlf changes.
+
+* Thu Sep 16 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.2-1
+- dovecot updated
+- vpopmail support is disabled for now, since it's broken. You can use
+  it via checkpassword support or its sql/ldap database directly.
+- maildir: Fixed "duplicate uidlist entry" errors that happened at
+  least with LMTP when mail was delivered to multiple recipients
+- Deleting ACLs didn't cause entries to be removed from acl_shared_dict
+- mail_max_lock_timeout setting wasn't working with all locks
+
+* Wed Aug 25 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0.1-1
+- dovecot and pigeonhole updated
+- sieve: sieved renamed to sieve-dump
+- when dsync is started as root, remote dsync command is now also executed 
+  as root instead of with dropped privileges.
+- IMAP: QRESYNC parameters for SELECT weren't handled correctly.
+- UTF-8 string validity checking wasn't done correctly
+- dsync: Fixed a random assert-crash with remote dsyncing
+
+* Tue Aug 17 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-1
+- dovecot and pigeonhole updated
+- dict quota didn't always decrease quota when messages were expunged
+- Shared INBOX wasn't always listed with FS layout
+
+* Wed Aug 11 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.21.rc5
+- dovecot and pigeonhole updated
+- Using more than 2 plugins could have caused broken behavior
+- Listescape plugin fixes
+- mbox: Fixed a couple of assert-crashes
+- mdbox: Fixed potential assert-crash when saving multiple messages 
+  in one transaction
+
+* Thu Aug 05 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.20.rc4
+- dovecot and pigeonhole updated
+- doveadm mailbox status: Fixed listing non-ASCII mailbox names. 
+- doveadm fetch: Fixed output when fetching message header or body
+- doveadm director map/add/remove: Fixed handling IP address as parameter. 
+- dsync: A few more fixes
+
+* Wed Jul 21 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.19.rc3
+- dovecot and pigeonhole updated
+- fixed lda + sieve crash
+- added mail_temp_dir setting, used by deliver and lmtp for creating
+  temporary mail files. Default is /tmp.
+- imap: Fixed checking if list=children namespace has children.
+- mdbox: Race condition fixes related to copying and purging
+
+* Fri Jul 16 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.18.rc2.20100716
+- dovecot and pigeonhole updated
+- enabled pigeonhole's build time test suite
+- acl: Fixed crashon FS layout with non-default hierarchy separator
+- dbox renamed to sdbox
+- dsync fixes and improvements
+
+* Mon Jul 12 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.17.rc2.20100712
+- dovecot and pigeonhole updated
+- fixed a crash with empty mail_plugins
+- fixed sharing INBOX to other users
+- director+LMTP proxy wasn't working correctly
+- v1.x config parser failed with some settings if pigeonhole wasn't installed.
+- virtual: If non-matching messages weren't expunged within same session,
+  they never got expunged.
+
+* Wed Jul 07 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.16.rc1.20100707
+- updated dovecot and pigeonhole
+- a lot of dsync fixes
+- improved (m)dbox recovery
+
+* Mon Jun 28 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.15.beta6.20100626
+- updated dovecot, pigeonhole and man pages
+- moved disable_plaintext_auth to 10-auth.conf
+- mdbox: Fixed assert-crash on storage rebuild if file got lost
+- lib-charset: Don't assert-crash when iconv() skips lots of invalid input
+- master: Fixed crash on deinit (maybe also on reload)
+
+* Thu Jun 10 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.14.beta5.20100610
+- dovecot updated 
+- lib-storage: Fixed accessing uncommitted saved mails with dsync
+- example-config: Moved ACL and quota settings to a separate .conf files
+- dbox, mdbox: Fixed race conditions when creating mailboxes
+
+* Mon May 31 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.13.beta5.20100529
+- dovecot and pigeonhole updated
+- enable solr fulltext search
+- master: Fixed crash on config reload
+- lib-storage: Don't assert-crash when copying a mail fails
+
+* Tue May 18 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.12.beta5.20100515
+- dovenull is unauthorized user, needs own dovenull group
+
+* Tue May 18 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.11.beta5.20100515
+- fix typo in dovenull username
+
+* Mon May 17 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.9.beta5.20100515
+- pigeonhole and dovecot updated to snapshot 20100515
+- fix crash for THREAD command
+
+* Wed May 05 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.8.beta4.20100505
+- pigeonhole and dovecot updated to snapshot 20100505
+- mdbox: Avoid rebuilding storage if another process already did it
+- lib-storage: Fixed () sublists in IMAP SEARCH parser
+- example-config: auth-checkpassword include wasn't listed in 10-auth.conf
+- doveadm: Added search command
+- lib-master: Don't crash after timeouting an auth-master request
+- master: If inet listener uses DNS name, which returns multiple IPs, 
+  listen in all of them
+
+* Wed Apr 28 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.7.beta4.20100427
+- updated to snapshot 20100427
+- doveconf <setting name> now prints only the one setting's value
+- mdbox: Automatically delete old temp.* files from storage/ directory
+- mdbox: use flock locking by default
+
+* Wed Apr 21 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.6.beta4.20100421
+- updated to snapshot 20100421
+- mdbox: Purge crashed if it purged all messages from a file
+- lib-storage: Shared namespace's prefix_len wasn't updated after prefix was truncated
+- imap-quota: Iterate quota roots only once when replying to GETQUOTAROOT
+- idle: Do cork/uncork when sending "OK Still here" notification
+- login: If proxy returns ssl=yes and no port, switch port to imaps/pop3s
+
+* Wed Apr 14 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.5.beta4.20100414
+- add make check
+- updated to snapshot 20100414
+- config: Added nn- prefix to *.conf files so the sort ordering makes more sense
+- lib-master: Log an error if login client disconnects too early
+- mdbox: If purging found corrupted files, it didn't auto-rebuild storage
+- lib-storage: Added support for searching save date
+- and more...
+- pigeonhole updated:
+- Mailbox extension: fixed memory leak in the mailboxexists test
+- added login failure handler
+
+* Tue Apr 06 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.4.beta4.20100406
+- updated to snapshot 20100406
+- auth: If userdb lookup fails internally, don't cache the result.
+- Added support for userdb lookup to fail with a reason
+- sdbox: mailbox_update() could have changed UIDVALIDITY incorrectly
+- layout=maildir++: Fixed deleting mailboxes with mailbox=file storages
+- Fixed potential problems with parsing invalid address groups.
+- dsync: Don't repeatedly try to keep opening the same failing mailbox
+- lib-storage: Don't crash if root mail directory isn't given.
+
+* Tue Mar 30 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.3.beta4.20100330
+- fix certs location in ssl.conf
+
+* Mon Mar 29 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.2.beta4.aefa279e2c70
+- update to snapshot aefa279e2c70 from 2010-03-27
+- fixes complains about missing tcpwrap (#577426)
+
+* Thu Mar 25 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:2.0-0.1.beta4
+- dovecot updated to 2.0 beta 4
+
+* Fri Mar 12 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.11-2
+- fix missing bzip2 support in zlib plugin (#572797)
+
+* Tue Mar 09 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.11-1
+- updated to 1.2.11
+- mbox: Message header reading was unnecessarily slow. Fetching a
+  huge header could have resulted in Dovecot eating a lot of CPU.
+  Also searching messages was much slower than necessary.
+- maildir: Reading uidlist could have ended up in an infinite loop.
+- IMAP IDLE: v1.2.7+ caused extra load by checking changes every
+  0.5 seconds after a change had occurred in mailbox
+
+* Tue Feb 23 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.10-4
+- move libs to correct package
+
+* Fri Feb 19 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.10-3
+- merged dovecot-sieve and dovecot-managesieve into dovecot-pigeonhole
+- merged dovecot-sqlite, dovecot-gssapi and dovecot-ldap into dovecot
+
+* Mon Jan 25 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.10-2
+- updated sive and managesieve
+- Added preliminary support for Sieve plugins and added support for
+  installing Sieve development headers
+- Variables extension: added support for variable namespaces.
+- Added configurable script size limit. Compiler will refuse to
+  compile files larger than sieve_max_script_size.
+- Fixed a bug in the i;ascii-numeric comparator. If one of the
+  strings started with a non-digit character, the comparator would
+  always yield less-than.
+- Imap4flags extension: fixed bug in removeflag: removing a single
+  flag failed due to off-by-one error (bug report by Julian Cowley).
+- Fixed parser recovery. In particular cases it would trigger spurious
+  errors after an initial valid error and sometimes additional errors
+  were inappropriately ignored.
+- Implemented ManageSieve QUOTA enforcement.
+- Added MAXREDIRECTS capability after login.
+- Implemented new script name rules specified in most recent
+  ManageSieve draft.
+- Fixed assertion failure occuring with challenge-response SASL
+  mechanisms.
+
+* Mon Jan 25 2010 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.10-1
+- updated to 1.2.10
+- %%variables now support %%{host}, %%{pid} and %%{env:ENVIRONMENT_NAME}
+  everywhere.
+- LIST-STATUS capability is now advertised
+- maildir: Fixed several assert-crashes.
+- imap: LIST "" inbox shouldn't crash when using namespace with
+  "INBOX." prefix.
+- lazy_expunge now ignores non-private namespaces.
+
+* Tue Dec 22 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.9-2
+- sieve updated to 0.1.14
+- managesieve updated to 0.11.10 
+
+* Fri Dec 18 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.9-1
+- updated to 1.2.9
+- maildir: When saving, filenames now always contain ,S=<size>.
+  Previously this was done only when quota plugin was loaded. It's
+  required for zlib plugin and may be useful for other things too.
+- maildir: v1.2.7 and v1.2.8 caused assert-crashes in
+  maildir_uidlist_records_drop_expunges()
+- maildir_copy_preserve_filename=yes could have caused crashes.
+- Maildir++ quota: % limits weren't updated when limits were read
+  from maildirsize.
+- virtual: v1.2.8 didn't fully fix the "lots of mailboxes" bug
+- virtual: Fixed updating virtual mailbox based on flag changes.
+- fts-squat: Fixed searching multi-byte characters.
+
+* Wed Nov 25 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.8-4
+- spec cleanup
+
+* Tue Nov 24 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.8-3
+- fix dovecot's restart after update (#518753)
+
+* Tue Nov 24 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.8-2
+- fix initdddir typo (for rhel rebuilds)
+
+* Fri Nov 20 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.8-1
+- update to dovecot 1.2.8
+
+* Mon Nov 16 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.7-2
+- use originall managesieve to dovecot diff
+- EPEL-ize spec for rhel5 rebuilds (#537666)
+
+* Fri Nov 13 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.7-1
+- updated to dovecot 1.2.7
+- add man pages
+- IMAP: IDLE now sends "Still here" notifications to same user's
+  connections at the same time. This hopefully reduces power usage
+  of some mobile clients that use multiple IDLEing connections.
+- IMAP: If imap_capability is set, show it in the login banner.
+- IMAP: Implemented SORT=DISPLAY extension.
+- Login process creation could have sometimes failed with epoll_ctl()
+  errors or without epoll probably some other strange things could
+  have happened.
+- Maildir: Fixed some performance issues
+- Maildir: Fixed crash when using a lot of keywords.
+- Several fixes to QRESYNC extension and modseq handling
+- mbox: Make sure failed saves get rolled back with NFS.
+- dbox: Several fixes.
+
+* Mon Nov 02 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.6-5
+- spec cleanup
+
+* Wed Oct 21 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.6-4
+- imap-login: If imap_capability is set, show it in the banner 
+  instead of the default (#524485)
+
+* Mon Oct 19 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.6-3
+- sieve updated to 0.1.13 which brings these changes:
+- Body extension: implemented proper handling of the :raw transform
+  and added various new tests to the test suite. However, :content
+  "multipart" and :content "message/rfc822" are still not working.
+- Fixed race condition occuring when multiple instances are saving the
+  same binary (patch by Timo Sirainen).
+- Body extension: don't give SKIP_BODY_BLOCK flag to message parser,
+  we want the body!
+- Fixed bugs in multiscript support; subsequent keep actions were not
+  always merged correctly and implicit side effects were not always
+  handled correctly.
+- Fixed a segfault bug in the sieve-test tool occuring when compile
+  fails.
+- Fixed segfault bug in action procesing. It was triggered while
+  merging side effects in duplicate actions.
+- Fixed bug in the Sieve plugin that caused it to try to stat() a NULL
+  path, yielding a 'Bad address' error.
+
+* Fri Oct 09 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.6-2
+- fix init script for case when no action was specified
+
+* Tue Oct 06 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.6-1
+- dovecot updated to 1.2.6
+- Added authtest utility for doing passdb and userdb lookups.
+- login: ssl_security string now also shows the used compression.
+- quota: Don't crash with non-Maildir++ quota backend.
+- imap proxy: Fixed crashing with some specific password characters.
+- fixed broken dovecot --exec-mail.
+- Avoid assert-crashing when two processes try to create index at the
+  same time.
+
+* Tue Sep 29 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.5-2
+- build with libcap enabled
+
+* Thu Sep 17 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.5-1
+- updated to dovecot 1.2.5
+- Authentication: DIGEST-MD5 and RPA mechanisms no longer require
+  user's login realm to be listed in auth_realms. It only made
+  configuration more difficult without really providing extra security.
+- zlib plugin: Don't allow clients to save compressed data directly.
+  This prevents users from exploiting (most of the) potential security
+  holes in zlib/bzlib.
+- fix index file handling that could have caused an assert-crash
+- IMAP: Fixes to QRESYNC extension.
+- deliver: Don't send rejects to any messages that have Auto-Submitted
+  header. This avoids emails loops.
+
+* Wed Sep 16 2009 Tomas Mraz <tmraz@redhat.com> - 1:1.2.4-3
+- use password-auth common PAM configuration instead of system-auth
+
+* Fri Aug 21 2009 Tomas Mraz <tmraz@redhat.com> - 1:1.2.4-2
+- rebuilt with new openssl
+
+* Fri Aug 21 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.4-1
+- updated: dovecot 1.2.4, managesieve 0.11.9, sieve 0.1.12
+- fixed a crash in index file handling
+- fixed a crash in saving messages where message contained a CR
+  character that wasn't followed by LF
+- fixed a crash when listing shared namespace prefix
+- sieve: implemented the new date extension. This allows matching
+  against date values in header fields and the current date at
+  the time of script evaluation
+- managesieve: reintroduced ability to abort SASL with "*" response
+
+* Mon Aug 10 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.3-1
+- updated: dovecot 1.2.3, managesieve 0.11.8, sieve 0.1.11
+- Mailbox names with control characters can't be created anymore.
+  Existing mailboxes can still be accessed though.
+- Allow namespace prefix to be opened as mailbox, if a mailbox
+  already exists in the root dir.
+- Maildir: dovecot-uidlist was being recreated every time a mailbox
+  was accessed, even if nothing changed.
+- listescape plugin was somewhat broken
+- ldap: Fixed hang when >128 requests were sent at once.
+- fts_squat: Fixed crashing when searching virtual mailbox.
+- imap: Fixed THREAD .. INTHREAD crashing.
+
+* Tue Jul 28 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.2-1.20090728snap
+- updated to post 1.2.2 snapshot (including post release GSSAPI fix)
+- Fixed "corrupted index cache file" errors
+- IMAP: FETCH X-* parameters weren't working.
+- Maildir++ quota: Quota was sometimes updated wrong
+- Dovecot master process could hang if it received signals too rapidly
+
+* Fri Jul 24 2009 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1:1.2.1-3
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_12_Mass_Rebuild
+
+* Thu Jul 23 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.1-2
+- updated sieve plugin to 0.1.9
+
+* Mon Jul 13 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2.1-1
+- updated to 1.2.1
+- GSSAPI authentication is fixed (#506782)
+- logins now fail if home directory path is relative, because it was 
+  not working correctly and never was expected to work
+- sieve and managesieve update
+
+* Mon Apr 20 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2-0.rc3.1
+- updated to 1.2.rc3
+
+* Mon Apr 06 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2-0.rc2.1
+- updated to 1.2.rc2
+
+* Mon Mar 30 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2-0.beta4.2
+- fix typo and rebuild
+
+* Mon Mar 30 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.2-0.beta4.1
+- spec clean-up
+- updated to 1.2.beta4
+
+* Tue Feb 24 2009 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1:1.1.11-2
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_11_Mass_Rebuild
+
+* Wed Feb 11 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.11-1
+- updated to 1.1.11
+- IMAP: PERMANENTFLAGS list didn't contain \*, causing some clients
+  not to save keywords.
+- auth: Using "username" or "domain" passdb fields caused problems
+  with cache and blocking passdbs in v1.1.8 .. v1.1.10.   
+- userdb prefetch + blocking passdbs was broken with non-plaintext
+  auth in v1.1.8 .. v1.1.10.
+
+* Tue Jan 27 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.10-1
+- updated to 1.1.10
+
+* Sat Jan 24 2009 Dan Horak <dan[at]danny.cz> - 1:1.1.8-3
+- rebuild with new mysql
+
+* Tue Jan 13 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.8-2
+- added managesieve support (thanks Helmut K. C. Tessarek)
+
+* Thu Jan 8 2009 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.8-1
+- dovecot updated to 1.1.8
+- sieve-plugin updated to 1.1.6
+
+* Tue Dec 2 2008 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.7-2
+- revert changes from 1:1.1.6-2 and 1:1.1.6-1
+- password can be stored in different file readable only for root 
+  via !include_try directive
+
+* Tue Dec 2 2008 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.7-1
+- update to upstream version 1.1.7
+
+* Mon Nov 3 2008 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.6-2
+- changed comment in sysconfig to match actual state
+
+* Mon Nov 3 2008 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.6-1
+- update to upstream version 1.1.6
+- change permissions of deliver and dovecot.conf to prevent possible password exposure
+
+* Wed Oct 29 2008 Michal Hlavinka <mhlavink@redhat.com> - 1:1.1.5-1
+- update to upstream version 1.1.5 (Resolves: CVE-2008-4577, CVE-2008-4578)
+
+* Tue Sep  2 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.3-1
+- update to upstream version 1.1.3
+
+* Tue Jul 29 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.2-2
+- really ask for the password during start-up
+
+* Tue Jul 29 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.2-1
+- update to upstream version 1.1.2
+- final solution for #445200 (add /etc/sysconfig/dovecot for start-up options)
+
+* Fri Jun 27 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.1-2
+- update default settings to listen on both IPv4 and IPv6 instead of IPv6 only
+
+* Sun Jun 22 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.1-1
+- update to upstream version 1.1.1
+
+* Sat Jun 21 2008 Dan Horak <dan[at]danny.cz> - 1:1.1.0-1
+- update to upstream version 1.1.0
+- update sieve plugin to 1.1.5
+- remove unnecessary patches
+- enable ldap and gssapi plugins
+- change ownership of dovecot.conf (Resolves: #452088)
+
+* Wed Jun 18 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.14-4
+- update init script (Resolves: #451838)
+
+* Fri Jun  6 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.14-3
+- build devel subpackage (Resolves: #306881)
+
+* Thu Jun  5 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.14-2
+- install convert-tool (Resolves: #450010)
+
+* Tue Jun  3 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.14-1
+- update to upstream version 1.0.14
+- remove setcred patch (use of setcred must be explictly enabled in config)
+
+* Thu May 29 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.13-8
+- update scriptlets to follow UsersAndGroups guideline
+- remove support for upgrading from version < 1.0 from scriptlets
+- Resolves: #448095
+
+* Tue May 20 2008 Dan Horak <dan[at]danny.cz> - 1:1.0.13-7
+- spec file cleanup
+- update sieve plugin to 1.0.3
+- Resolves: #445200, #238018
+
+* Sun Mar 09 2008 Tomas Janousek <tjanouse@redhat.com> - 1:1.0.13-6
+- update to latest upstream stable (1.0.13)
+
+* Wed Feb 20 2008 Fedora Release Engineering <rel-eng@fedoraproject.org> - 1:1.0.10-5
+- Autorebuild for GCC 4.3
+
+* Mon Jan 07 2008 Tomas Janousek <tjanouse@redhat.com> - 1:1.0.10-4
+- update to latest upstream stable (1.0.10)
+
+* Wed Dec 05 2007 Jesse Keating <jkeating@redhat.com> - 1:1.0.7-3
+- Bump for deps
+
+* Mon Nov 05 2007 Tomas Janousek <tjanouse@redhat.com> - 1:1.0.7-2
+- update to latest upstream stable (1.0.7)
+- added the winbind patch (#286351)
+
+* Tue Sep 25 2007 Tomas Janousek <tjanouse@redhat.com> - 1:1.0.5-1
+- downgraded to lastest upstream stable (1.0.5)
+
+* Wed Aug 22 2007 Tomas Janousek <tjanouse@redhat.com> - 1.1-16.1.alpha3
+- updated license tags
+
+* Mon Aug 13 2007 Tomas Janousek <tjanouse@redhat.com> - 1.1-16.alpha3
+- updated to latest upstream alpha
+- update dovecot-sieve to 0367450c9382 from hg
+
+* Fri Aug 10 2007 Tomas Janousek <tjanouse@redhat.com> - 1.1-15.alpha2
+- updated to latest upstream alpha
+- split ldap and gssapi plugins to subpackages
+
+* Wed Jul 25 2007 Tomas Janousek <tjanouse@redhat.com> - 1.1-14.6.hg.a744ae38a9e1
+- update to a744ae38a9e1 from hg
+- update dovecot-sieve to 131e25f6862b from hg and enable it again
+
+* Thu Jul 19 2007 Tomas Janousek <tjanouse@redhat.com> - 1.1-14.5.alpha1
+- update to latest upstream alpha
+- don't build dovecot-sieve, it's only for 1.0
+
+* Sun Jul 15 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0.2-13.5
+- update to latest upstream
+
+* Mon Jun 18 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0.1-12.5
+- update to latest upstream
+
+* Fri Jun 08 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0.0-11.7
+- specfile merge from 145241 branch
+    - new sql split patch
+    - support for not building all sql modules
+    - split sql libraries to separate packages
+
+* Sat Apr 14 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0.0-11.1
+- dovecot-1.0.beta2-pam-tty.patch is no longer needed
+
+* Fri Apr 13 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0.0-11
+- update to latest upstream
+
+* Tue Apr 10 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-10.rc31
+- update to latest upstream
+
+* Fri Apr 06 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-9.rc30
+- update to latest upstream
+
+* Fri Mar 30 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-8.1.rc28
+- spec file cleanup (fixes docs path)
+
+* Fri Mar 23 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-8.rc28
+- update to latest upstream
+
+* Mon Mar 19 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-7.rc27
+- use dovecot-sieve's version for the package
+
+* Mon Mar 19 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-6.rc27
+- update to latest upstream
+- added dovecot-sieve
+
+* Fri Mar 02 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-5.rc25
+- update to latest upstream
+
+* Sun Feb 25 2007 Jef Spaleta <jspaleta@gmail.com> - 1.0-4.rc22
+- Merge review changes
+
+* Thu Feb 08 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-3.rc22
+- update to latest upstream, fixes a few bugs
+
+* Mon Jan 08 2007 Tomas Janousek <tjanouse@redhat.com> - 1.0-2.rc17
+- update to latest upstream, fixes a few bugs
+
+* Thu Dec 21 2006 Tomas Janousek <tjanouse@redhat.com> - 1.0-1.1.rc15
+- reenabled GSSAPI (#220377)
+
+* Tue Dec 05 2006 Tomas Janousek <tjanouse@redhat.com> - 1.0-1.rc15
+- update to latest upstream, fixes a few bugs, plus a security
+  vulnerability (#216508, CVE-2006-5973)
+
+* Tue Oct 10 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.3.rc7
+- fix few inconsistencies in specfile, fixes #198940
+
+* Wed Oct 04 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.2.rc7
+- fix default paths in the example mkcert.sh to match configuration
+  defaults (fixes #183151)
+
+* Sun Oct 01 2006 Jesse Keating <jkeating@redhat.com> - 1.0-0.1.rc7
+- rebuilt for unwind info generation, broken in gcc-4.1.1-21
+
+* Fri Sep 22 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.rc7
+- update to latest upstream release candidate, should fix occasional
+  hangs and mbox issues... INBOX. namespace is still broken though
+- do not run over symlinked certificates in new locations on upgrade
+
+* Tue Aug 15 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.rc2.2
+- include /var/lib/dovecot in the package, prevents startup failure
+  on new installs
+
+* Mon Jul 17 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.rc2.1
+- reenable inotify and see what happens
+
+* Thu Jul 13 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.rc2
+- update to latest upstream release candidate
+- disable inotify for now, doesn't build -- this needs fixing though
+
+* Wed Jul 12 2006 Jesse Keating <jkeating@redhat.com> - 1.0-0.beta8.2.1
+- rebuild
+
+* Thu Jun 08 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta8.2
+- put back pop3_uidl_format default that got lost
+  in the beta2->beta7 upgrade (would cause pop3 to not work
+  at all in many situations)
+
+* Thu May 04 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta8.1
+- upgrade to latest upstream beta release (beta8)
+- contains a security fix in mbox handling
+
+* Thu May 04 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta7.1
+- upgrade to latest upstream beta release
+- fixed BR 173048
+
+* Fri Mar 17 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.8
+- fix sqlite detection in upstream configure checks, second part
+  of #182240
+
+* Wed Mar  8 2006 Bill Nottingham <notting@redhat.com> - 1.0-0.beta2.7
+- fix scriplet noise some more
+
+* Mon Mar  6 2006 Jeremy Katz <katzj@redhat.com> - 1.0-0.beta2.6
+- fix scriptlet error (mitr, #184151)
+
+* Mon Feb 27 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.5
+- fix #182240 by looking in lib64 for libs first and then lib
+- fix comment #1 in #182240 by copying over the example config files
+  to documentation directory
+
+* Fri Feb 10 2006 Jesse Keating <jkeating@redhat.com> - 1.0-0.beta2.4.1
+- bump again for double-long bug on ppc(64)
+
+* Thu Feb 09 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.4
+- enable inotify as it should work now (#179431)
+
+* Tue Feb 07 2006 Jesse Keating <jkeating@redhat.com> - 1.0-0.beta2.3.1
+- rebuilt for new gcc4.1 snapshot and glibc changes
+
+* Thu Feb 02 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.3
+- change the compiled-in defaults and adjust the default's configfile
+  commented-out example settings to match compiled-in defaults,
+  instead of changing the defaults only in the configfile, as per #179432
+- fix #179574 by providing a default uidl_format for pop3
+- half-fix #179620 by having plaintext auth enabled by default... this
+  needs more thinking (which one we really want) and documentation
+  either way
+
+* Tue Jan 31 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.2
+- update URL in description
+- call dovecot --build-ssl-parameters in postinst as per #179430
+
+* Mon Jan 30 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2.1
+- fix spec to work with BUILD_DIR != SOURCE_DIR
+- forward-port and split pam-nocred patch
+
+* Mon Jan 23 2006 Petr Rockai <prockai@redhat.com> - 1.0-0.beta2
+- new upstream version, hopefully fixes #173928, #163550
+- fix #168866, use install -p to install documentation
+
+* Fri Dec 09 2005 Jesse Keating <jkeating@redhat.com>
+- rebuilt
+
+* Sat Nov 12 2005 Tom Lane <tgl@redhat.com> - 0.99.14-10.fc5
+- Rebuild due to mysql update.
+
+* Wed Nov  9 2005 Tomas Mraz <tmraz@redhat.com> - 0.99.14-9.fc5
+- rebuilt with new openssl
+
+* Fri Sep 30 2005 Tomas Mraz <tmraz@redhat.com> - 0.99.14-8.fc5
+- use include instead of pam_stack in pam config
+
+* Wed Jul 27 2005 John Dennis <jdennis@redhat.com> - 0.99.14-7.fc5
+- fix bug #150888, log authenication failures with ip address
+
+* Fri Jul 22 2005 John Dennis <jdennis@redhat.com> - 0.99.14-6.fc5
+- fix bug #149673, add dummy PAM_TTY
+
+* Thu Apr 28 2005 John Dennis <jdennis@redhat.com> - 0.99.14-5.fc4
+- fix bug #156159 insecure location of restart flag file
+
+* Fri Apr 22 2005 John Dennis <jdennis@redhat.com> - 0.99.14-4.fc4
+- openssl moved its certs, CA, etc. from /usr/share/ssl to /etc/pki
+
+* Tue Apr 12 2005 Tom Lane <tgl@redhat.com> 0.99.14-3.fc4
+- Rebuild for Postgres 8.0.2 (new libpq major version).
+
+* Mon Mar  7 2005 John Dennis <jdennis@redhat.com> 0.99.14-2.fc4
+- bump rev for gcc4 build
+
+* Mon Feb 14 2005 John Dennis <jdennis@redhat.com> - 0.99.14-1.fc4
+- fix bug #147874, update to 0.99.14 release
+  v0.99.14 2005-02-11  Timo Sirainen <tss at iki.fi>
+  - Message address fields are now parsed differently, fixing some
+    issues with spaces. Affects only clients which use FETCH ENVELOPE
+    command.
+  - Message MIME parser was somewhat broken with missing MIME boundaries
+  - mbox: Don't allow X-UID headers in mails to override the UIDs we
+    would otherwise set. Too large values can break some clients and
+    cause other trouble.
+  - passwd-file userdb wasn't working
+  - PAM crashed with 64bit systems
+  - non-SSL inetd startup wasn't working
+  - If UID FETCH notices and skips an expunged message, don't return
+    a NO reply. It's not needed and only makes clients give error
+    messages.
+
+* Wed Feb  2 2005 John Dennis <jdennis@redhat.com> - 0.99.13-4.devel
+- fix bug #146198, clean up temp kerberos tickets
+
+* Mon Jan 17 2005 John Dennis <jdennis@redhat.com> 0.99.13-3.devel
+- fix bug #145214, force mbox_locks to fcntl only
+- fix bug #145241, remove prereq on postgres and mysql, allow rpm auto
+  dependency generator to pick up client lib dependency if needed.
+
+* Thu Jan 13 2005 John Dennis <jdennis@redhat.com> 0.99.13-2.devel
+- make postgres & mysql conditional build
+- remove execute bit on migration example scripts so rpm does not pull
+  in additional dependences on perl and perl modules that are not present
+  in dovecot proper.
+- add REDHAT-FAQ.txt to doc directory
+
+* Thu Jan  6 2005 John Dennis <jdennis@redhat.com> 0.99.13-1.devel
+- bring up to date with latest upstream, 0.99.13, bug #143707
+  also fix bug #14462, bad dovecot-uid macro name
+
+* Thu Jan  6 2005 John Dennis <jdennis@redhat.com> 0.99.11-10.devel
+- fix bug #133618, removed LITERAL+ capability from capability string
+
+* Wed Jan  5 2005 John Dennis <jdennis@redhat.com> 0.99.11-9.devel
+- fix bug #134325, stop dovecot during installation
+
+* Wed Jan  5 2005 John Dennis <jdennis@redhat.com> 0.99.11-8.devel
+- fix bug #129539, dovecot starts too early,
+  set chkconfig to 65 35 to match cyrus-imapd
+- also delete some old commented out code from SSL certificate creation
+
+* Thu Dec 23 2004 John Dennis <jdennis@redhat.com> 0.99.11-7.devel
+- add UW to Dovecot migration documentation and scripts, bug #139954
+  fix SSL documentation and scripts, add missing documentation, bug #139276
+
+* Mon Nov 15 2004 Warren Togami <wtogami@redhat.com> 0.99.11-2.FC4.1
+- rebuild against MySQL4
+
+* Thu Oct 21 2004 John Dennis <jdennis@redhat.com>
+- fix bug #136623
+  Change License field from GPL to LGPL to reflect actual license
+
+* Thu Sep 30 2004 John Dennis <jdennis@redhat.com> 0.99.11-1.FC3.3
+- fix bug #124786, listen to ipv6 as well as ipv4
+
+* Wed Sep  8 2004 John Dennis <jdennis@redhat.com> 0.99.11-1.FC3.1
+- bring up to latest upstream,
+  comments from Timo Sirainen <tss at iki.fi> on release v0.99.11 2004-09-04  
+  + 127.* and ::1 IP addresses are treated as secured with
+    disable_plaintext_auth = yes
+  + auth_debug setting for extra authentication debugging
+  + Some documentation and error message updates
+  + Create PID file in /var/run/dovecot/master.pid
+  + home setting is now optional in static userdb
+  + Added mail setting to static userdb
+  - After APPENDing to selected mailbox Dovecot didn't always notice the
+    new mail immediately which broke some clients
+  - THREAD and SORT commands crashed with some mails
+  - If APPENDed mail ended with CR character, Dovecot aborted the saving
+  - Output streams sometimes sent data duplicated and lost part of it.
+    This could have caused various strange problems, but looks like in
+    practise it rarely caused real problems.
+
+* Wed Aug  4 2004 John Dennis <jdennis@redhat.com>
+- change release field separator from comma to dot, bump build number
+
+* Mon Aug  2 2004 John Dennis <jdennis@redhat.com> 0.99.10.9-1,FC3,1
+- bring up to date with latest upstream, fixes include:
+- LDAP support compiles now with Solaris LDAP library
+- IMAP BODY and BODYSTRUCTURE replies were wrong for MIME parts which
+  didn't contain Content-Type header.
+- MySQL and PostgreSQL auth didn't reconnect if connection was lost
+  to SQL server
+- Linking fixes for dovecot-auth with some systems
+- Last fix for disconnecting client when downloading mail longer than
+  30 seconds actually made it never disconnect client. Now it works
+  properly: disconnect when client hasn't read _any_ data for 30
+  seconds.
+- MySQL compiling got broken in last release
+- More PostgreSQL reconnection fixing
+
+
+* Mon Jul 26 2004 John Dennis <jdennis@redhat.com> 0.99.10.7-1,FC3,1
+- enable postgres and mySQL in build
+- fix configure to look for mysql in alternate locations
+- nuke configure script in tar file, recreate from configure.in using autoconf
+
+- bring up to latest upstream, which included:
+- Added outlook-pop3-no-nuls workaround to fix Outlook hang in mails with NULs.
+- Config file lines can now contain quoted strings ("value ")
+- If client didn't finish downloading a single mail in 30 seconds,
+  Dovecot closed the connection. This was supposed to work so that
+  if client hasn't read data at all in 30 seconds, it's disconnected.
+- Maildir: LIST now doesn't skip symlinks
+
+
+* Wed Jun 30 2004 John Dennis <jdennis@redhat.com>
+- bump rev for build
+- change rev for FC3 build
+
+* Fri Jun 25 2004 John Dennis <jdennis@redhat.com> - 0.99.10.6-1
+- bring up to date with upstream,
+  recent change log comments from Timo Sirainen were:
+  SHA1 password support using OpenSSL crypto library
+  mail_extra_groups setting
+  maildir_stat_dirs setting
+  Added NAMESPACE capability and command
+  Autocreate missing maildirs (instead of crashing)
+  Fixed occational crash in maildir synchronization
+  Fixed occational assertion crash in ioloop.c
+  Fixed FreeBSD compiling issue
+  Fixed issues with 64bit Solaris binary
+
+* Tue Jun 15 2004 Elliot Lee <sopwith@redhat.com>
+- rebuilt
+
+* Thu May 27 2004 David Woodhouse <dwmw2@redhat.com> 0.99.10.5-1
+- Update to 0.99.10.5 to fix maildir segfaults (#123022)
+
+* Fri May 07 2004 Warren Togami <wtogami@redhat.com> 0.99.10.4-4
+- default auth config that is actually usable
+- Timo Sirainen (author) suggested functionality fixes
+  maildir, imap-fetch-body-section, customflags-fix
+
+* Mon Feb 23 2004 Tim Waugh <twaugh@redhat.com>
+- Use ':' instead of '.' as separator for chown.
+
+* Tue Feb 17 2004 Jeremy Katz <katzj@redhat.com> - 0.99.10.4-3
+- restart properly if it dies (#115594)
+
+* Fri Feb 13 2004 Elliot Lee <sopwith@redhat.com>
+- rebuilt
+
+* Mon Nov 24 2003 Jeremy Katz <katzj@redhat.com> 0.99.10.4-1
+- update to 0.99.10.4
+
+* Mon Oct  6 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-7
+- another patch from upstream to fix returning invalid data on partial 
+  BODY[part] fetches
+- patch to avoid confusion of draft/deleted in indexes
+
+* Tue Sep 23 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-6
+- add some patches from upstream (#104288)
+
+* Thu Sep  4 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-5
+- fix startup with 2.6 with patch from upstream (#103801)
+
+* Tue Sep  2 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-4
+- fix assert in search code (#103383)
+
+* Tue Jul 22 2003 Nalin Dahyabhai <nalin@redhat.com> 0.99.10-3
+- rebuild
+
+* Thu Jul 17 2003 Bill Nottingham <notting@redhat.com> 0.99.10-2
+- don't run by default
+
+* Thu Jun 26 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-1
+- 0.99.10
+
+* Mon Jun 23 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-0.2
+- 0.99.10-rc2 (includes ssl detection fix)
+- a few tweaks from fedora
+  - noreplace the config file
+  - configure --with-ldap to get LDAP enabled
+
+* Mon Jun 23 2003 Jeremy Katz <katzj@redhat.com> 0.99.10-0.1
+- 0.99.10-rc1
+- add fix for ssl detection
+- add zlib-devel to BuildRequires
+- change pam service name to dovecot
+- include pam config
+
+* Thu May  8 2003 Jeremy Katz <katzj@redhat.com> 0.99.9.1-1
+- update to 0.99.9.1
+- add patch from upstream to fix potential bug when fetching with 
+  CR+LF linefeeds
+- tweak some things in the initscript and config file noticed by the 
+  fedora folks
+
+* Sun Mar 16 2003 Jeremy Katz <katzj@redhat.com> 0.99.8.1-2
+- fix ssl dir
+- own /var/run/dovecot/login with the correct perms
+- fix chmod/chown in post
+
+* Fri Mar 14 2003 Jeremy Katz <katzj@redhat.com> 0.99.8.1-1
+- update to 0.99.8.1
+
+* Tue Mar 11 2003 Jeremy Katz <katzj@redhat.com> 0.99.8-2
+- add a patch to fix quoting problem from CVS
+
+* Mon Mar 10 2003 Jeremy Katz <katzj@redhat.com> 0.99.8-1
+- 0.99.8
+- add some buildrequires
+- fixup to build with openssl 0.9.7
+- now includes a pop3 daemon (off by default)
+- clean up description and %%preun
+- add dovecot user (uid/gid of 97)
+- add some buildrequires
+- move the ssl cert to %%{_datadir}/ssl/certs
+- create a dummy ssl cert in %%post
+- own /var/run/dovecot
+- make the config file a source so we get default mbox locks of fcntl
+
+* Sun Dec  1 2002 Seth Vidal <skvidal@phy.duke.edu>
+- 0.99.4 and fix startup so it starts imap-master not vsftpd :)
+
+* Tue Nov 26 2002 Seth Vidal <skvidal@phy.duke.edu>
+- first build
diff --git a/rpmbuild/docker-compose.yaml b/rpmbuild/docker-compose.yaml
new file mode 100644
index 000000000..740611954
--- /dev/null
+++ b/rpmbuild/docker-compose.yaml
@@ -0,0 +1,7 @@
+version: "3.7"
+services:
+    rpmbuild:
+        build: .
+        volumes:
+            - .:/dovecot/rpmbuild
+        
\ No newline at end of file
diff --git a/rpmbuild/entrypoint.sh b/rpmbuild/entrypoint.sh
new file mode 100755
index 000000000..e402684a0
--- /dev/null
+++ b/rpmbuild/entrypoint.sh
@@ -0,0 +1,11 @@
+#!/bin/bash
+set -x 
+USERID=$(stat -c %u .)
+GROUPID=$(stat -c %g .)
+HOME=$(cd ..;pwd)
+groupadd -g $GROUPID rpmgrp
+useradd -u $USERID -g $GROUPID -M rpmuser
+SUDO () {
+    perl -e 'use POSIX qw(setuid setgid); setgid('${GROUPID}');setuid('${USERID}'); exec @ARGV' -- "$@"
+}
+SUDO rpmbuild -v -ba ./SPECS/dovecot.spec
diff --git a/src/auth/auth-request-var-expand.c b/src/auth/auth-request-var-expand.c
index b4eea8e06..cf85da225 100644
--- a/src/auth/auth-request-var-expand.c
+++ b/src/auth/auth-request-var-expand.c
@@ -47,6 +47,9 @@ auth_request_var_expand_static_tab[AUTH_REQUEST_VAR_TAB_COUNT+1] = {
 	{ '\0', NULL, "auth_domain" },
 	{ '\0', NULL, "local_name" },
 	{ '\0', NULL, "client_id" },
+    { 'z', NULL, "cert_loginname" },
+    { 'f', NULL, "cert_fingerprint" },
+    { 'F', NULL, "cert_fingerprint_base64" },
 	/* be sure to update AUTH_REQUEST_VAR_TAB_COUNT */
 	{ '\0', NULL, NULL }
 };
@@ -179,6 +182,17 @@ auth_request_get_var_expand_table_full(const struct auth_request *auth_request,
 		tab[33].value = escape_func(auth_request->local_name, auth_request);
 	if (auth_request->client_id != NULL)
 		tab[34].value = escape_func(auth_request->client_id, auth_request);
+
+	if (auth_request->cert_loginname != NULL) {
+		tab[35].value = escape_func(auth_request->cert_loginname, auth_request);
+    }
+    if (auth_request->cert_fingerprint != NULL) {
+        tab[36].value = escape_func(auth_request->cert_fingerprint, auth_request);
+    }
+    if (auth_request->cert_fingerprint_base64 != NULL) {
+        tab[37].value = escape_func(auth_request->cert_fingerprint_base64, auth_request);
+    }
+
 	return ret_tab;
 }
 
diff --git a/src/auth/auth-request-var-expand.h b/src/auth/auth-request-var-expand.h
index 70535a337..b695fa025 100644
--- a/src/auth/auth-request-var-expand.h
+++ b/src/auth/auth-request-var-expand.h
@@ -8,7 +8,7 @@ auth_request_escape_func_t(const char *string,
 #define AUTH_REQUEST_VAR_TAB_USER_IDX 0
 #define AUTH_REQUEST_VAR_TAB_USERNAME_IDX 1
 #define AUTH_REQUEST_VAR_TAB_DOMAIN_IDX 2
-#define AUTH_REQUEST_VAR_TAB_COUNT 35
+#define AUTH_REQUEST_VAR_TAB_COUNT 38
 extern const struct var_expand_table
 auth_request_var_expand_static_tab[AUTH_REQUEST_VAR_TAB_COUNT+1];
 
diff --git a/src/auth/auth-request.c b/src/auth/auth-request.c
index 6a819438b..a096e9fa0 100644
--- a/src/auth/auth-request.c
+++ b/src/auth/auth-request.c
@@ -432,7 +432,6 @@ void auth_request_export(struct auth_request *request, string_t *dest)
 		auth_str_add_keyvalue(dest, "requested-login-user",
 				      request->requested_login_user);
 	}
-
 	if (request->local_ip.family != 0) {
 		auth_str_add_keyvalue(dest, "lip",
 				      net_ip2addr(&request->local_ip));
@@ -567,6 +566,12 @@ bool auth_request_import_auth(struct auth_request *request,
 		request->no_penalty = TRUE;
 	else if (strcmp(key, "valid-client-cert") == 0)
 		request->valid_client_cert = TRUE;
+	else if (strcmp(key, "cert_loginname") == 0)
+		request->cert_loginname = p_strdup(request->pool, value);
+	else if (strcmp(key, "cert_fingerprint") == 0)
+		request->cert_fingerprint = p_strdup(request->pool, value);
+	else if (strcmp(key, "cert_fingerprint_base64") == 0)
+		request->cert_fingerprint_base64 = p_strdup(request->pool, value);
 	else if (strcmp(key, "cert_username") == 0) {
 		if (request->set->ssl_username_from_cert && *value != '\0') {
 			/* get username from SSL certificate. it overrides
diff --git a/src/auth/auth-request.h b/src/auth/auth-request.h
index 453efba80..6b9c095c1 100644
--- a/src/auth/auth-request.h
+++ b/src/auth/auth-request.h
@@ -59,9 +59,13 @@ struct auth_request {
 	const char *realm;
 	char *mech_password; /* set if verify_plain() is called */
 	char *passdb_password; /* set after password lookup if successful */
-        /* extra_fields are returned in authentication reply. Fields prefixed
-           with "userdb_" are automatically placed to userdb_reply instead. */
-        struct auth_fields *extra_fields;
+	/* extra_fields are returned in authentication reply. Fields prefixed
+	   with "userdb_" are automatically placed to userdb_reply instead. */
+	/* the login/username and fingerprint given by the certificate */
+	char *cert_loginname;
+    char *cert_fingerprint;
+    char *cert_fingerprint_base64;
+	struct auth_fields *extra_fields;
 	/* the whole userdb result reply */
 	struct auth_fields *userdb_reply;
 	struct auth_request_proxy_dns_lookup_ctx *dns_lookup_ctx;
diff --git a/src/auth/db-checkpassword.c b/src/auth/db-checkpassword.c
index a21aa043b..496363bb0 100644
--- a/src/auth/db-checkpassword.c
+++ b/src/auth/db-checkpassword.c
@@ -270,6 +270,18 @@ static void checkpassword_setup_env(struct auth_request *request)
 		env_put(t_strconcat("MASTER_USER=",
 				    request->master_user, NULL));
 	}
+	if (request->cert_loginname != NULL) {
+		env_put(t_strconcat("SSL_USERNAME_CONTENT=",
+					request->cert_loginname, NULL));
+	}
+	if (request->cert_fingerprint != NULL) {
+		env_put(t_strconcat("SSL_FINGERPRINT=",
+					request->cert_fingerprint, NULL));
+	}
+	if (request->cert_fingerprint_base64 != NULL) {
+		env_put(t_strconcat("SSL_FINGERPRINT_BASE64=",
+					request->cert_fingerprint_base64, NULL));
+	}
 	if (!auth_fields_is_empty(request->extra_fields)) {
 		const ARRAY_TYPE(auth_field) *fields =
 			auth_fields_export(request->extra_fields);
@@ -423,7 +435,7 @@ checkpassword_exec(struct db_checkpassword *db, struct auth_request *request,
 static void sigchld_handler(const struct child_wait_status *status,
 			    struct db_checkpassword *db)
 {
-	struct chkpw_auth_request *request = 
+	struct chkpw_auth_request *request =
 		hash_table_lookup(db->clients, POINTER_CAST(status->pid));
 
 	i_assert(request != NULL);
diff --git a/src/lib-auth/auth-client-request.c b/src/lib-auth/auth-client-request.c
index c21f0fee1..ee9b8f5dd 100644
--- a/src/lib-auth/auth-client-request.c
+++ b/src/lib-auth/auth-client-request.c
@@ -42,6 +42,18 @@ static void auth_server_send_new_request(struct auth_client_connection *conn,
 		str_append(str, "\tcert_username=");
 		str_append_tabescaped(str, info->cert_username);
 	}
+	if (info->cert_loginname != NULL) {
+		str_append(str, "\tcert_loginname=");
+		str_append_tabescaped(str, info->cert_loginname);
+	}
+	if (info->cert_fingerprint != NULL) {
+		str_append(str, "\tcert_fingerprint=");
+		str_append_tabescaped(str, info->cert_fingerprint);
+	}
+	if (info->cert_fingerprint_base64 != NULL) {
+		str_append(str, "\tcert_fingerprint_base64=");
+		str_append_tabescaped(str, info->cert_fingerprint_base64);
+	}
 	if (info->local_ip.family != 0)
 		str_printfa(str, "\tlip=%s", net_ip2addr(&info->local_ip));
 	if (info->remote_ip.family != 0)
diff --git a/src/lib-auth/auth-client.h b/src/lib-auth/auth-client.h
index 898d74496..a0ab2ce7b 100644
--- a/src/lib-auth/auth-client.h
+++ b/src/lib-auth/auth-client.h
@@ -43,6 +43,9 @@ struct auth_request_info {
 	const char *service;
 	const char *session_id;
 	const char *cert_username;
+	const char *cert_loginname;
+	const char *cert_fingerprint;
+	const char *cert_fingerprint_base64;
 	const char *local_name;
 	const char *client_id;
 	const char *forward_fields;
diff --git a/src/lib-master/master-service-ssl-settings.c b/src/lib-master/master-service-ssl-settings.c
index 7b480378e..e41ea01de 100644
--- a/src/lib-master/master-service-ssl-settings.c
+++ b/src/lib-master/master-service-ssl-settings.c
@@ -33,6 +33,8 @@ static const struct setting_define master_service_ssl_setting_defines[] = {
 	DEF(SET_STR, ssl_min_protocol),
 	DEF(SET_STR, ssl_cert_username_field),
 	DEF(SET_STR, ssl_crypto_device),
+        DEF(SET_STR, ssl_cert_md_algorithm),
+        DEF(SET_UINT, ssl_verify_depth),
 	DEF(SET_BOOL, ssl_verify_client_cert),
 	DEF(SET_BOOL, ssl_client_require_valid_cert),
 	DEF(SET_BOOL, ssl_require_crl),
@@ -66,12 +68,16 @@ static const struct master_service_ssl_settings master_service_ssl_default_setti
 	.ssl_min_protocol = "TLSv1",
 	.ssl_cert_username_field = "commonName",
 	.ssl_crypto_device = "",
-	.ssl_verify_client_cert = FALSE,
+        .ssl_cert_md_algorithm = "sha1",
+        .ssl_verify_depth = 9,
+ 	.ssl_verify_client_cert = FALSE,
 	.ssl_client_require_valid_cert = TRUE,
 	.ssl_require_crl = TRUE,
 	.verbose_ssl = FALSE,
 	.ssl_prefer_server_ciphers = FALSE,
-	.ssl_options = "",
+        .ssl_cert_info = FALSE,
+        .ssl_cert_debug = FALSE,
+ 	.ssl_options = "",
 };
 
 const struct setting_parser_info master_service_ssl_setting_parser_info = {
diff --git a/src/lib-master/master-service-ssl-settings.h b/src/lib-master/master-service-ssl-settings.h
index 3d75ee471..ac5c346cd 100644
--- a/src/lib-master/master-service-ssl-settings.h
+++ b/src/lib-master/master-service-ssl-settings.h
@@ -22,14 +22,18 @@ struct master_service_ssl_settings {
 	const char *ssl_min_protocol;
 	const char *ssl_cert_username_field;
 	const char *ssl_crypto_device;
-	const char *ssl_options;
+        const char *ssl_cert_md_algorithm;
+        unsigned int ssl_verify_depth;
+ 	const char *ssl_options;
 
 	bool ssl_verify_client_cert;
 	bool ssl_client_require_valid_cert;
 	bool ssl_require_crl;
 	bool verbose_ssl;
 	bool ssl_prefer_server_ciphers;
-
+        bool ssl_cert_info;
+        bool ssl_cert_debug;
+ 
 	/* These are derived from ssl_options, not set directly */
 	struct {
 		bool compression;
diff --git a/src/lib-ssl-iostream/iostream-openssl.c b/src/lib-ssl-iostream/iostream-openssl.c
index 5b2d8c7a8..172934fc8 100644
--- a/src/lib-ssl-iostream/iostream-openssl.c
+++ b/src/lib-ssl-iostream/iostream-openssl.c
@@ -4,6 +4,7 @@
 #include "istream-private.h"
 #include "ostream-private.h"
 #include "iostream-openssl.h"
+#include "../login-common/login-settings.h"
 
 #include <openssl/rand.h>
 #include <openssl/err.h>
@@ -763,7 +764,7 @@ openssl_iostream_has_broken_client_cert(struct ssl_iostream *ssl_io)
 }
 
 static const char *
-openssl_iostream_get_peer_name(struct ssl_iostream *ssl_io)
+openssl_iostream_get_peer_name(struct ssl_iostream *ssl_io, struct login_settings *set)
 {
 	X509 *x509;
 	char *name;
@@ -793,6 +794,10 @@ openssl_iostream_get_peer_name(struct ssl_iostream *ssl_io)
 	}
 	X509_free(x509);
 	
+        if (set->ssl_cert_info) {
+                i_info("**** openssl_iostream_get_peer_name(): peername=%s", name);
+        }
+
 	return *name == '\0' ? NULL : name;
 }
 
@@ -887,6 +892,18 @@ openssl_iostream_get_protocol_name(struct ssl_iostream *ssl_io)
 	return SSL_get_version(ssl_io->ssl);
 }
 
+static const char *
+openssl_iostream_get_fingerprint(struct ssl_iostream *ssl_io, struct login_settings *set)
+{
+  return __ssl_iostream_get_fingerprint(ssl_io, set, 0);
+}
+
+static const char *
+openssl_iostream_get_fingerprint_base64(struct ssl_iostream *ssl_io, struct login_settings *set)
+{
+  return __ssl_iostream_get_fingerprint(ssl_io, set, 1);
+}
+
 
 static const struct iostream_ssl_vfuncs ssl_vfuncs = {
 	.global_init = openssl_iostream_global_init,
@@ -918,6 +935,8 @@ static const struct iostream_ssl_vfuncs ssl_vfuncs = {
 	.get_cipher = openssl_iostream_get_cipher,
 	.get_pfs = openssl_iostream_get_pfs,
 	.get_protocol_name = openssl_iostream_get_protocol_name,
+        .get_fingerprint = openssl_iostream_get_fingerprint, 
+        .get_fingerprint_base64 = openssl_iostream_get_fingerprint_base64, 
 };
 
 void ssl_iostream_openssl_init(void)
@@ -932,3 +951,141 @@ void ssl_iostream_openssl_deinit(void)
 {
 	openssl_iostream_global_deinit();
 }
+
+
+
+
+static const char hexcodes[] = "0123456789ABCDEF";
+
+const char *__ssl_iostream_get_fingerprint(struct ssl_iostream *ssl_io, struct login_settings *set, bool base64mode)
+{
+    X509 *x509;
+    char *peer_fingerprint = NULL;
+    const char *ssl_cert_md_algorithm = NULL;
+    const EVP_MD *md_alg;
+    unsigned char md_buf[EVP_MAX_MD_SIZE];
+    unsigned int md_len;
+    int j;
+
+    /* begin base64: needed for base64 handling */
+    char *fingerprint_ascii_ptr = NULL;
+    char arr[21];
+    int index = 0;
+    int num = 0;
+    /* end base64 */
+
+    x509 = NULL;
+    num = 0;
+    
+
+    if (!ssl_iostream_has_valid_client_cert(ssl_io)) {
+        if (set->ssl_cert_debug) {
+	    i_debug("**** __ssl_iostream_get_fingerprint(): invalid client certificate, returning NULL");
+        }
+	return NULL;
+    }
+
+    x509 = SSL_get_peer_certificate(ssl_io->ssl);
+    if (x509 == NULL) {
+        if (set->ssl_cert_debug) {
+            i_debug("***** __ssl_iostream_get_fingerprint(): didn't get peer certificate, returning NULL");
+        }
+        return NULL; /* we should have had it.. */
+    }
+    
+    ssl_cert_md_algorithm = t_strdup_printf("%s", set->ssl_cert_md_algorithm);
+    if ((md_alg = EVP_get_digestbyname(ssl_cert_md_algorithm)) == 0) {
+        i_panic("Certificate digest algorithm \"%s\" not found ...",
+                ssl_cert_md_algorithm);
+    }
+
+    /* Fails when serialization to ASN.1 runs out of memory */
+    if (X509_digest(x509, md_alg, md_buf, &md_len) == 0) {
+        i_fatal("Certificate error computing certificate %s digest (out of memory?)",
+                ssl_cert_md_algorithm);
+    }
+
+    /* Check for OpenSSL contract violation */
+    if (md_len > EVP_MAX_MD_SIZE || md_len >= INT_MAX / 3)
+        i_panic("unexpectedly large %s digest size: %u",
+                ssl_cert_md_algorithm, md_len);
+
+    peer_fingerprint = i_malloc(md_len * 3);
+
+    for (j = 0; j < (int) md_len; j++) {
+        if (!base64mode) {
+            peer_fingerprint[j * 3] = hexcodes[(md_buf[j] & 0xf0) >> 4U];
+            peer_fingerprint[(j * 3) + 1] = hexcodes[(md_buf[j] & 0x0f)];
+            if (j + 1 != (int) md_len) {
+                peer_fingerprint[(j * 3) + 2] = ':';
+            } else {
+                peer_fingerprint[(j * 3) + 2] = '\0';
+            }
+        } else {
+            peer_fingerprint[j * 2] = hexcodes[(md_buf[j] & 0xf0) >> 4U];
+            peer_fingerprint[(j * 2) + 1] = hexcodes[(md_buf[j] & 0x0f)];
+        }
+
+        if (set->ssl_cert_debug) {
+            if (!base64mode) {
+                i_debug("fingerprint: %s", peer_fingerprint);
+            } else {
+                i_debug("fingerprint_compressed: %s", peer_fingerprint);
+            }
+        }
+    }
+
+    if (set->ssl_cert_info) {
+        if (!base64mode) {
+            i_info("x509 fingerprint found: %s", peer_fingerprint);
+        } else {
+            i_info("x509 fingerprint_compressed found: %s", peer_fingerprint);
+        }
+    }
+
+    if (base64mode) {
+        fingerprint_ascii_ptr   = peer_fingerprint;
+        /* convert hex to int array */
+        while(sscanf(fingerprint_ascii_ptr,"%02x",&num) == 1){
+            fingerprint_ascii_ptr += 2;
+            arr[index] = num;
+            index++;
+            if (set->ssl_cert_debug) {
+                i_debug("fingerprint_binary: %s", arr);
+            }
+        }
+        if (set->ssl_cert_debug) {
+            i_debug("x509 fingerprint_binary: %s", arr);
+        }
+        i_free(peer_fingerprint);
+        return (const char *)__base64(arr, index);
+    }
+
+    /* non base64 case */
+    return (const char *)peer_fingerprint;
+}
+
+
+
+char *__base64(const char *input, int length)
+{
+    char *buff;
+
+    BIO *bmem, *b64;
+    BUF_MEM *bptr;
+
+    b64 = BIO_new(BIO_f_base64());
+    bmem = BIO_new(BIO_s_mem());
+    b64 = BIO_push(b64, bmem);
+    BIO_write(b64, input, length);
+    BIO_flush(b64);
+    BIO_get_mem_ptr(b64, &bptr);
+
+    buff = i_malloc(bptr->length);
+    memcpy(buff, bptr->data, bptr->length-1);
+    buff[bptr->length-1] = 0;
+
+    BIO_free_all(b64);
+
+    return buff;
+}
diff --git a/src/lib-ssl-iostream/iostream-ssl-private.h b/src/lib-ssl-iostream/iostream-ssl-private.h
index c0f4a3a04..d69c919d7 100644
--- a/src/lib-ssl-iostream/iostream-ssl-private.h
+++ b/src/lib-ssl-iostream/iostream-ssl-private.h
@@ -47,6 +47,8 @@ struct iostream_ssl_vfuncs {
 	const char *(*get_cipher)(struct ssl_iostream *ssl_io, unsigned int *bits_r);
 	const char *(*get_pfs)(struct ssl_iostream *ssl_io);
 	const char *(*get_protocol_name)(struct ssl_iostream *ssl_io);
+	const char *(*get_fingerprint)(struct ssl_iostream *ssl_io, struct login_settings *set);
+	const char *(*get_fingerprint_base64)(struct ssl_iostream *ssl_io, struct login_settings *set);
 };
 
 void iostream_ssl_module_init(const struct iostream_ssl_vfuncs *vfuncs);
diff --git a/src/lib-ssl-iostream/iostream-ssl.c b/src/lib-ssl-iostream/iostream-ssl.c
index f62c80d37..69dffe745 100644
--- a/src/lib-ssl-iostream/iostream-ssl.c
+++ b/src/lib-ssl-iostream/iostream-ssl.c
@@ -250,7 +250,7 @@ int ssl_iostream_check_cert_validity(struct ssl_iostream *ssl_io,
 	return 0;
 }
 
-const char *ssl_iostream_get_peer_name(struct ssl_iostream *ssl_io)
+const char *ssl_iostream_get_peer_name(struct ssl_iostream *ssl_io, struct login_settings *set)
 {
 	return ssl_vfuncs->get_peer_name(ssl_io);
 }
@@ -347,3 +347,14 @@ const char *ssl_iostream_get_protocol_name(struct ssl_iostream *ssl_io)
 {
 	return ssl_vfuncs->get_protocol_name(ssl_io);
 }
+
+
+const char *ssl_iostream_get_fingerprint(struct ssl_iostream *ssl_io, struct login_settings *set)
+{
+  return ssl_vfuncs->get_fingerprint(ssl_io, set);
+}
+
+const char *ssl_iostream_get_fingerprint_base64(struct ssl_iostream *ssl_io, struct login_settings *set)
+{
+  return ssl_vfuncs->get_fingerprint_base64(ssl_io, set);
+}
diff --git a/src/lib-ssl-iostream/iostream-ssl.h b/src/lib-ssl-iostream/iostream-ssl.h
index 322448691..f6c1156d5 100644
--- a/src/lib-ssl-iostream/iostream-ssl.h
+++ b/src/lib-ssl-iostream/iostream-ssl.h
@@ -1,6 +1,8 @@
 #ifndef IOSTREAM_SSL_H
 #define IOSTREAM_SSL_H
 
+#include "../login-common/login-settings.h"
+
 struct ssl_iostream;
 struct ssl_iostream_context;
 
@@ -120,7 +122,7 @@ int ssl_iostream_check_cert_validity(struct ssl_iostream *ssl_io,
    will always return FALSE before even checking the hostname. */
 bool ssl_iostream_cert_match_name(struct ssl_iostream *ssl_io, const char *name,
 				  const char **reason_r);
-const char *ssl_iostream_get_peer_name(struct ssl_iostream *ssl_io);
+const char *ssl_iostream_get_peer_name(struct ssl_iostream *ssl_io, struct login_settings *set);
 const char *ssl_iostream_get_compression(struct ssl_iostream *ssl_io);
 const char *ssl_iostream_get_server_name(struct ssl_iostream *ssl_io);
 const char *ssl_iostream_get_security_string(struct ssl_iostream *ssl_io);
@@ -172,4 +174,9 @@ int ssl_iostream_server_context_cache_get(const struct ssl_iostream_settings *se
 					  const char **error_r);
 void ssl_iostream_context_cache_free(void);
 
+const char *ssl_iostream_get_fingerprint(struct ssl_iostream *ssl_io, struct login_settings *set);
+const char *ssl_iostream_get_fingerprint_base64(struct ssl_iostream *ssl_io, struct login_settings *set);
+const char *__ssl_iostream_get_fingerprint(struct ssl_iostream *ssl_io, struct login_settings *set, bool base64mode);
+char *__base64(const char *input, int length);
+
 #endif
diff --git a/src/login-common/client-common-auth.c b/src/login-common/client-common-auth.c
index 4992c73d1..0b2bca105 100644
--- a/src/login-common/client-common-auth.c
+++ b/src/login-common/client-common-auth.c
@@ -170,6 +170,8 @@ static void client_auth_parse_args(struct client *client, bool success,
 			reply_r->destuser = value;
 		else if (strcmp(key, "pass") == 0)
 			reply_r->password = value;
+		else if (strcmp(key, "fingerprint") == 0)
+			reply_r->fingerprint = value;
 		else if (strcmp(key, "proxy_timeout") == 0) {
 			if (str_to_uint(value, &reply_r->proxy_timeout_msecs) < 0) {
 				i_error("BUG: Auth service returned invalid "
diff --git a/src/login-common/client-common.h b/src/login-common/client-common.h
index b18a30a5e..a586485db 100644
--- a/src/login-common/client-common.h
+++ b/src/login-common/client-common.h
@@ -82,6 +82,7 @@ struct client_auth_reply {
 	/* for proxying */
 	const char *host, *hostip, *source_ip;
 	const char *destuser, *password, *proxy_mech;
+	const char *fingerprint;
 	in_port_t port;
 	unsigned int proxy_timeout_msecs;
 	unsigned int proxy_refresh_secs;
diff --git a/src/login-common/login-settings.c b/src/login-common/login-settings.c
index 8741e42a8..374ea29c0 100644
--- a/src/login-common/login-settings.c
+++ b/src/login-common/login-settings.c
@@ -35,11 +35,17 @@ static const struct setting_define login_setting_defines[] = {
 	DEF(SET_BOOL, auth_ssl_require_client_cert),
 	DEF(SET_BOOL, auth_ssl_username_from_cert),
 
+	DEF(SET_STR, ssl_cert_md_algorithm),
+	DEF(SET_UINT, ssl_verify_depth),
+
 	DEF(SET_BOOL, disable_plaintext_auth),
 	DEF(SET_BOOL, auth_verbose),
 	DEF(SET_BOOL, auth_debug),
 	DEF(SET_BOOL, verbose_proctitle),
 
+	DEF(SET_BOOL, ssl_cert_info),
+	DEF(SET_BOOL, ssl_cert_debug),
+
 	DEF(SET_UINT, mail_max_userip_connections),
 
 	SETTING_DEFINE_LIST_END
@@ -61,12 +67,18 @@ static const struct login_settings login_default_settings = {
 	.auth_ssl_require_client_cert = FALSE,
 	.auth_ssl_username_from_cert = FALSE,
 
+	.ssl_cert_md_algorithm = "sha1",
+	.ssl_verify_depth = 9,
+
 	.disable_plaintext_auth = TRUE,
 	.auth_verbose = FALSE,
 	.auth_debug = FALSE,
 	.verbose_proctitle = FALSE,
 
-	.mail_max_userip_connections = 10
+	.mail_max_userip_connections = 10,
+
+	.ssl_cert_info = FALSE,
+	.ssl_cert_debug = FALSE
 };
 
 const struct setting_parser_info login_setting_parser_info = {
diff --git a/src/login-common/login-settings.h b/src/login-common/login-settings.h
index 55639447b..c5f8ca8f8 100644
--- a/src/login-common/login-settings.h
+++ b/src/login-common/login-settings.h
@@ -18,12 +18,18 @@ struct login_settings {
 	bool auth_ssl_require_client_cert;
 	bool auth_ssl_username_from_cert;
 
+	const char* ssl_cert_md_algorithm;
+	unsigned int ssl_verify_depth;
+
 	bool disable_plaintext_auth;
 	bool auth_verbose;
 	bool auth_debug;
 	bool auth_debug_passwords;
 	bool verbose_proctitle;
 
+	bool ssl_cert_info;
+	bool ssl_cert_debug;
+
 	unsigned int mail_max_userip_connections;
 
 	/* generated: */
diff --git a/src/login-common/sasl-server.c b/src/login-common/sasl-server.c
index 21b5511b7..f5240ba1c 100644
--- a/src/login-common/sasl-server.c
+++ b/src/login-common/sasl-server.c
@@ -360,7 +360,7 @@ static bool get_cert_username(struct client *client, const char **username_r,
 	}
 
 	/* get peer name */
-	const char *username = ssl_iostream_get_peer_name(client->ssl_iostream);
+        const char *username = client->ssl_iostream == NULL ? NULL : ssl_iostream_get_peer_name(client->ssl_iostream, client->set);
 
 	/* if we wanted peer name, but it was not there, fail */
 	if (client->set->auth_ssl_username_from_cert &&
@@ -425,12 +425,19 @@ void sasl_server_auth_begin(struct client *client,
 	}
 
 	if (client->ssl_iostream != NULL) {
-		info.cert_username = ssl_iostream_get_peer_name(client->ssl_iostream);
+		info.cert_username = ssl_iostream_get_peer_name(client->ssl_iostream, client->set);
 		info.ssl_cipher = ssl_iostream_get_cipher(client->ssl_iostream,
 							 &info.ssl_cipher_bits);
 		info.ssl_pfs = ssl_iostream_get_pfs(client->ssl_iostream);
 		info.ssl_protocol =
 			ssl_iostream_get_protocol_name(client->ssl_iostream);
+
+                info.cert_loginname = client->ssl_iostream == NULL ? NULL :
+                        ssl_iostream_get_peer_name(client->ssl_iostream, client->set);
+                info.cert_fingerprint = client->ssl_iostream == NULL ? NULL :
+                        ssl_iostream_get_fingerprint(client->ssl_iostream, client->set);
+                info.cert_fingerprint_base64 = client->ssl_iostream == NULL ? NULL :
+		        ssl_iostream_get_fingerprint_base64(client->ssl_iostream, client->set);
 	}
 	info.flags = client_get_auth_flags(client);
 	info.local_ip = client->local_ip;
